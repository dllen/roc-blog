<!doctype html><html class=scroll-smooth lang=en><head><meta charset=utf-8><link href=/css/style.css rel=stylesheet><link href=/line-awesome/css/line-awesome.min.css rel=stylesheet><script defer src=/js/main.js></script><title>HDFS æºç é˜…è¯»ï¼š00. é˜…è¯»å¤§çº²ä¸å­¦ä¹ è·¯çº¿ | ç å†œçš„è‡ªç•™åœ°</title><body class="bg-white dark:bg-slate-900 transition ease-in-out"><section><div class="sticky top-0 bg-slate-100 dark:bg-slate-800"><div class="container mx-auto px-auto xl:px-0 w-full xl:w-1/2 flex place-content-between py-16 xl:py-8 font-sans text-6xl xl:text-2xl text-slate-900 dark:text-slate-300"><div class=flex><a class="m-0 p-0 text-slate-900 hover:text-slate-700 dark:text-slate-300 dark:hover:text-slate-200" href=/blog/> /blog </a><a class="m-0 p-0 text-slate-900 hover:text-slate-700 dark:text-slate-300 dark:hover:text-slate-200" href=/blog/hdfs/> /hdfs </a></div><div class="flex gap-4"><div class="hidden cursor-pointer" id=back-to-top><i class="las la-level-up-alt"></i></div><a href=/><i class="las la-home"></i></a><div class=cursor-pointer id=darkmode-toggle><div class="hidden dark:inline"><i class="las la-sun"></i></div><div class="inline dark:hidden"><i class="las la-moon"></i></div></div></div></div></div><div class="container mx-auto w-full xl:w-1/2 mb-16"><div class="mt-4 font-serif text-slate-600 dark:text-slate-500 text-4xl xl:text-base">2026-01-12</div><h1 class="w-full xl:w-2/3 mt-4 mb-8 font-serif text-8xl xl:text-4xl text-slate-900 dark:text-slate-300">HDFS æºç é˜…è¯»ï¼š00. é˜…è¯»å¤§çº²ä¸å­¦ä¹ è·¯çº¿</h1><div class="mt-2 mb-6 flex flex-wrap gap-2"></div><div class="w-100 border-t mb-8 border-slate-300 dark:border-slate-700"></div><div class="prose dark:prose-invert prose-pre:rounded-none prose-headings:bg-amber-100 prose-headings:text-slate-800 dark:prose-headings:bg-indigo-900 prose-headings:font-normal dark:prose-headings:text-slate-300 prose-headings:p-2 prose-headings:w-max prose-headings:font-serif prose-2xl xl:prose-base"><p>Hadoop Distributed File System (HDFS) æ˜¯å¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿçš„åŸºçŸ³ã€‚å°½ç®¡å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ S3ï¼‰æ—¥ç›Šæµè¡Œï¼Œä½† HDFS ä¾ç„¶æ˜¯ç†è§£åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿè®¾è®¡æ€æƒ³çš„æœ€ä½³èŒƒæœ¬ã€‚<p>æœ¬ç³»åˆ—å°†åŸºäº <strong>Hadoop 3.3+</strong> æºç ï¼Œæ·±å…¥å‰–æå…¶åº•å±‚åŸç†ã€‚<h2 id=map-zheng-ti-lan-tu>ğŸ—ºï¸ æ•´ä½“è“å›¾</h2><p>æˆ‘ä»¬å°† HDFS æºç é˜…è¯»åˆ†ä¸ºäº”ä¸ªé˜¶æ®µï¼š<ol><li><strong>åŸºç¡€ç¯‡</strong>ï¼šäº†è§£ HDFS çš„æ ¸å¿ƒæ¶æ„ã€è®¾è®¡ç›®æ ‡ä¸é¡¹ç›®ç»“æ„ã€‚<li><strong>NameNode ç¯‡</strong>ï¼šæ·±å…¥â€œå¤§è„‘â€ï¼Œæ¢ç´¢å…ƒæ•°æ®ç®¡ç†ã€RPC å¤„ç†ä¸å—ç®¡ç†ã€‚<li><strong>DataNode ç¯‡</strong>ï¼šæ·±å…¥â€œå››è‚¢â€ï¼Œç ”ç©¶å­˜å‚¨ç®¡ç†ã€å¿ƒè·³æ±‡æŠ¥ä¸æ•°æ®ä¼ è¾“ã€‚<li><strong>Client ç¯‡</strong>ï¼šæ·±å…¥â€œç”¨æˆ·æ¥å£â€ï¼Œå‰–ææ–‡ä»¶è¯»å†™æµç¨‹ä¸æµå¼æ¥å£ã€‚<li><strong>é«˜å¯ç”¨ä¸è¿›é˜¶ç¯‡</strong>ï¼šæ¢ç©¶ HAã€Federationã€EC (Erasure Coding) ç­‰é«˜çº§ç‰¹æ€§ã€‚</ol><hr><h2 id=books-xiang-xi-da-gang-chi-xu-geng-xin>ğŸ“š è¯¦ç»†å¤§çº² (æŒç»­æ›´æ–°)</h2><h3 id=phase-1-zhun-bei-yu-jia-gou-preparation-architecture>Phase 1: å‡†å¤‡ä¸æ¶æ„ (Preparation & Architecture)</h3><ul><li><strong>[01. æºç ç¼–è¯‘ä¸ç¯å¢ƒæ­å»º]({{< ref â€œ01-hdfs-source-code-map.mdâ€ >}})</strong> <ul><li>Hadoop æºç ç›®å½•ç»“æ„è§£æ<li>ä½¿ç”¨ Maven ç¼–è¯‘ Hadoop<li>IDEA è¿œç¨‹è°ƒè¯•ç¯å¢ƒé…ç½®</ul><li><strong>02. HDFS æ ¸å¿ƒæ¶æ„è®¾è®¡</strong> <ul><li>Master/Slave æ¶æ„å›é¡¾<li>Block çš„è®¾è®¡ç†å¿µ<li>é€šä¿¡åè®® (Hadoop RPC) æ¦‚è§ˆ</ul></ul><h3 id=phase-2-namenode-xi-tong-de-he-xin-the-brain>Phase 2: NameNode - ç³»ç»Ÿçš„æ ¸å¿ƒ (The Brain)</h3><p>NameNode ç®¡ç†ç€æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å‘½åç©ºé—´å’Œ Block æ˜ å°„ä¿¡æ¯ã€‚<ul><li><strong>03. NameNode å¯åŠ¨æµç¨‹</strong> <ul><li><code>NameNode</code> ç±»å…¥å£åˆ†æ<li>ç»„ä»¶åˆå§‹åŒ–é¡ºåº<li>å®‰å…¨æ¨¡å¼ (SafeMode) çš„è¿›å…¥ä¸é€€å‡º</ul><li><strong>04. å…ƒæ•°æ®ç®¡ç† (FSDirectory)</strong> <ul><li>å†…å­˜ç›®å½•æ ‘ç»“æ„ (<code>INode</code>, <code>INodeFile</code>, <code>INodeDirectory</code>)<li>å¿«ç…§ (Snapshot) çš„å®ç°åŸºç¡€</ul><li><strong>05. æŒä¹…åŒ–æœºåˆ¶ (FsImage & EditLog)</strong> <ul><li><code>FSEditLog</code> çš„åŒç¼“å†²æœºåˆ¶ (Double Buffer)<li><code>FSImage</code> çš„åŠ è½½ä¸å­˜å‚¨<li>Checkpoint æµç¨‹ (SecondaryNameNode/Checkpointer)</ul><li><strong>06. å—ç®¡ç† (BlockManager)</strong> <ul><li>Block çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†<li>å‰¯æœ¬å¤åˆ¶ (Replication Monitor)<li>Corrupt Block å¤„ç†</ul><li><strong>07. ç§Ÿçº¦ç®¡ç† (LeaseManager)</strong> <ul><li>æ–‡ä»¶å†™å…¥é”æœºåˆ¶<li>ç§Ÿçº¦æ¢å¤ä¸è½¯ç¡¬é™æµ</ul></ul><h3 id=phase-3-datanode-shu-ju-de-cun-chu-the-worker>Phase 3: DataNode - æ•°æ®çš„å­˜å‚¨ (The Worker)</h3><p>DataNode è´Ÿè´£å®é™…çš„æ•°æ®å—å­˜å‚¨ä¸è¯»å†™ã€‚<ul><li><strong>08. DataNode å¯åŠ¨ä¸æ³¨å†Œ</strong> <ul><li><code>DataNode</code> ç±»å…¥å£<li>å‘ NameNode æ³¨å†Œä¸æ¡æ‰‹<li>BPServiceActor çº¿ç¨‹æ¨¡å‹</ul><li><strong>09. å­˜å‚¨ç®¡ç† (FsDatasetImpl)</strong> <ul><li>ç£ç›˜å·ç®¡ç† (<code>FsVolumeImpl</code>)<li>Block æ–‡ä»¶åœ¨æœ¬åœ°ç£ç›˜çš„å¸ƒå±€<li>RAM Disk ä¸ å¼‚æ„å­˜å‚¨æ”¯æŒ</ul><li><strong>10. å¿ƒè·³ä¸å—æ±‡æŠ¥ (Heartbeat & BlockReport)</strong> <ul><li>å¢é‡æ±‡æŠ¥ vs å…¨é‡æ±‡æŠ¥<li>IBR (Incremental Block Report) ä¼˜åŒ–</ul><li><strong>11. æ•°æ®ä¼ è¾“åè®® (DataTransferProtocol)</strong> <ul><li>åŸºäº Netty çš„æ•°æ®ä¼ è¾“æœåŠ¡ç«¯<li><code>DataXceiver</code> ä¸ <code>BlockReceiver</code></ul></ul><h3 id=phase-4-client-du-xie-liu-cheng-io-path>Phase 4: Client - è¯»å†™æµç¨‹ (IO Path)</h3><p>æœ€å¤æ‚çš„äº¤äº’é€»è¾‘å¾€å¾€å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ã€‚<ul><li><strong>12. DFSClient åˆå§‹åŒ–</strong> <ul><li>ä»£ç†å¯¹è±¡çš„åˆ›å»º</ul><li><strong>13. æ–‡ä»¶å†™å…¥æµç¨‹ (Write Path)</strong> <ul><li><code>DFSOutputStream</code> å†…éƒ¨åŸç†<li>DataStreamer çº¿ç¨‹ä¸ AckQueue<li>Packet çš„æ„é€ ä¸å‘é€<li>Pipeline å»ºç«‹ä¸æ¢å¤ (Pipeline Recovery)</ul><li><strong>14. æ–‡ä»¶è¯»å–æµç¨‹ (Read Path)</strong> <ul><li><code>DFSInputStream</code> å†…éƒ¨åŸç†<li>BlockReader çš„é€‰æ‹© (çŸ­è·¯è¯» Short Circuit Read)<li>Checksum æ ¡éªŒæœºåˆ¶</ul></ul><h3 id=phase-5-gao-ji-te-xing-advanced>Phase 5: é«˜çº§ç‰¹æ€§ (Advanced)</h3><ul><li><strong>15. HDFS HA (High Availability)</strong> <ul><li>QJM (Quorum Journal Manager) åŸç†<li>ZKFC (ZooKeeper Failover Controller) é€‰ä¸¾æœºåˆ¶</ul><li><strong>16. HDFS Federation</strong> <ul><li>ViewFileSystem ä¸ RBF (Router-based Federation)</ul><li><strong>17. Erasure Coding (çº åˆ ç )</strong> <ul><li>åŸç†ä¸ Striped Block å®ç°</ul></ul><h2 id=bulb-xue-xi-jian-yi>ğŸ’¡ å­¦ä¹ å»ºè®®</h2><p>Hadoop ä»£ç åº“å†å²æ‚ ä¹…ï¼Œé£æ ¼æ··åˆã€‚å»ºè®®ï¼š<ol><li><strong>å…³æ³¨æ ¸å¿ƒç±»</strong>ï¼šå¦‚ <code>FSNamesystem</code>, <code>FSDirectory</code>, <code>BlockManager</code>, <code>DFSOutputStream</code>ã€‚<li><strong>ç†è§£ RPC</strong>ï¼šHadoop çš„é€»è¾‘å‡ ä¹éƒ½æ˜¯é€šè¿‡ RPC ä¸²è”çš„ï¼Œç†è§£ Protocol å®šä¹‰æ˜¯å…³é”®ã€‚<li><strong>ä¸è¦é™·å…¥ç»†èŠ‚</strong>ï¼šMetricsã€Web UIã€Audit Log ç­‰éæ ¸å¿ƒé€»è¾‘å¯å…ˆè·³è¿‡ã€‚</ol></div></div></section>