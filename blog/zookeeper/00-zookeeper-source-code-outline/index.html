<!doctype html><html class=scroll-smooth lang=en><head><meta charset=utf-8><link href=/css/style.css rel=stylesheet><link href=/line-awesome/css/line-awesome.min.css rel=stylesheet><script defer src=/js/main.js></script><title>ZooKeeper 源码阅读：00. 阅读大纲与学习路线 | 码农的自留地</title><body class="bg-white dark:bg-slate-900 transition ease-in-out"><section><div class="sticky top-0 bg-slate-100 dark:bg-slate-800"><div class="container mx-auto px-auto xl:px-0 w-full xl:w-1/2 flex place-content-between py-16 xl:py-8 font-sans text-6xl xl:text-2xl text-slate-900 dark:text-slate-300"><div class=flex><a class="m-0 p-0 text-slate-900 hover:text-slate-700 dark:text-slate-300 dark:hover:text-slate-200" href=/blog/> /blog </a><a class="m-0 p-0 text-slate-900 hover:text-slate-700 dark:text-slate-300 dark:hover:text-slate-200" href=/blog/zookeeper/> /zookeeper </a></div><div class="flex gap-4"><div class="hidden cursor-pointer" id=back-to-top><i class="las la-level-up-alt"></i></div><a href=/><i class="las la-home"></i></a><div class=cursor-pointer id=darkmode-toggle><div class="hidden dark:inline"><i class="las la-sun"></i></div><div class="inline dark:hidden"><i class="las la-moon"></i></div></div></div></div></div><div class="container mx-auto w-full xl:w-1/2 mb-16"><div class="mt-4 font-serif text-slate-600 dark:text-slate-500 text-4xl xl:text-base">2026-01-13</div><h1 class="w-full xl:w-2/3 mt-4 mb-8 font-serif text-8xl xl:text-4xl text-slate-900 dark:text-slate-300">ZooKeeper 源码阅读：00. 阅读大纲与学习路线</h1><div class="mt-2 mb-6 flex flex-wrap gap-2"></div><div class="w-100 border-t mb-8 border-slate-300 dark:border-slate-700"></div><div class="prose dark:prose-invert prose-pre:rounded-none prose-headings:bg-amber-100 prose-headings:text-slate-800 dark:prose-headings:bg-indigo-900 prose-headings:font-normal dark:prose-headings:text-slate-300 prose-headings:p-2 prose-headings:w-max prose-headings:font-serif prose-2xl xl:prose-base"><p>Apache ZooKeeper 是 Hadoop 生态系统中至关重要的分布式协调服务。本系列将基于 ZooKeeper 3.7+ 源码，深入剖析其底层原理。<h2 id=phase-1-ji-chu-yu-jia-gou-basics-architecture>Phase 1: 基础与架构 (Basics & Architecture)</h2><ul><li><strong>01. 源码编译与环境搭建</strong>: 如何构建 ZooKeeper 源码，IntelliJ IDEA 调试环境配置。<li><strong>02. 核心架构与模块概览</strong>: Client-Server 架构，核心类 (<code>QuorumPeer</code>, <code>ZooKeeperServer</code>) 介绍。<li><strong>03. 启动流程详解</strong>: <code>QuorumPeerMain</code> 启动流程，单机与集群模式的初始化差异。</ul><h2 id=phase-2-cun-chu-yu-tong-xin-storage-networking>Phase 2: 存储与通信 (Storage & Networking)</h2><ul><li><strong>04. 数据模型 (DataTree)</strong>: 内存数据库 <code>DataTree</code> 与 <code>ZKDatabase</code> 的结构。<li><strong>05. 持久化机制</strong>: Transaction Log (WAL) 与 Snapshot 的写入与恢复 (<code>FileTxnSnapLog</code>)。<li><strong>06. 网络通信</strong>: 基于 NIO 的 <code>NIOServerCnxnFactory</code> 与 Client/Server 通信协议。</ul><h2 id=phase-3-he-xin-ji-zhi-core-mechanisms>Phase 3: 核心机制 (Core Mechanisms)</h2><ul><li><strong>07. Session 管理</strong>: Session 的创建、心跳保活、超时检测与分桶策略。<li><strong>08. Watcher 监听机制</strong>: 客户端注册、服务端触发与通知回调流程。<li><strong>09. 请求处理链 (RequestProcessor)</strong>: 责任链模式在 ZK 中的应用 (Prep -> Proposal -> Commit -> Final)。</ul><h2 id=phase-4-yi-zhi-xing-yu-gong-shi-consistency-zab>Phase 4: 一致性与共识 (Consistency & ZAB)</h2><ul><li><strong>10. Leader 选举 (FastLeaderElection)</strong>: 选举算法详解，服务器状态转换 (LOOKING -> LEADING/FOLLOWING)。<li><strong>11. ZAB 协议：发现与同步</strong>: Leader 选举后的数据同步流程 (Diff, Trunc, Snap)。<li><strong>12. ZAB 协议：原子广播</strong>: 两阶段提交 (Proposal -> Commit) 实现强一致性。</ul><h2 id=xue-xi-jian-yi>学习建议</h2><p>ZooKeeper 代码量相对较少（相比 Hadoop/HBase），是学习分布式一致性协议（Paxos/Raft 变种）的绝佳样本。<ol><li><strong>抓住 ZAB</strong>: ZAB 协议是 ZK 的灵魂，理解了 ZAB 就理解了 ZK 的 80%。<li><strong>关注状态机</strong>: ZK 本质上是一个复制状态机，关注 <code>TxnHeader</code> 和 <code>zxid</code> 的流转。<li><strong>调试选举</strong>: 启动 3 个 ZK 实例，断点调试 Leader 选举过程，非常有趣。</ol></div></div></section>