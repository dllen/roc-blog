<!doctype html><html class=scroll-smooth lang=en><head><meta charset=utf-8><link href=/css/style.css rel=stylesheet><link href=/line-awesome/css/line-awesome.min.css rel=stylesheet><script defer src=/js/main.js></script><title>Redis vs. Valkey：2025年技术选型深度指南 | 码农的自留地</title><body class="bg-white dark:bg-slate-900 transition ease-in-out"><section><div class="sticky top-0 bg-slate-100 dark:bg-slate-800"><div class="container mx-auto px-auto xl:px-0 w-full xl:w-1/2 flex place-content-between py-16 xl:py-8 font-sans text-6xl xl:text-2xl text-slate-900 dark:text-slate-300"><div class=flex><a class="m-0 p-0 text-slate-900 hover:text-slate-700 dark:text-slate-300 dark:hover:text-slate-200" href=/blog/> /blog </a></div><div class="flex gap-4"><div class="hidden cursor-pointer" id=back-to-top><i class="las la-level-up-alt"></i></div><a href=/><i class="las la-home"></i></a><div class=cursor-pointer id=darkmode-toggle><div class="hidden dark:inline"><i class="las la-sun"></i></div><div class="inline dark:hidden"><i class="las la-moon"></i></div></div></div></div></div><div class="container mx-auto w-full xl:w-1/2 mb-16"><div class="mt-4 font-serif text-slate-600 dark:text-slate-500 text-4xl xl:text-base">2025-12-07</div><h1 class="w-full xl:w-2/3 mt-4 mb-8 font-serif text-8xl xl:text-4xl text-slate-900 dark:text-slate-300">Redis vs. Valkey：2025年技术选型深度指南</h1><div class="mt-2 mb-6 flex flex-wrap gap-2"></div><div class="w-100 border-t mb-8 border-slate-300 dark:border-slate-700"></div><div class="prose dark:prose-invert prose-pre:rounded-none prose-headings:bg-amber-100 prose-headings:text-slate-800 dark:prose-headings:bg-indigo-900 prose-headings:font-normal dark:prose-headings:text-slate-300 prose-headings:p-2 prose-headings:w-max prose-headings:font-serif prose-2xl xl:prose-base"><p>2024年初，Redis 宣布修改其开源协议，这一举动在开源社区引发了巨大的震动，也直接促成了 Valkey 的诞生。如今一年过去，随着 Redis 8.0 和 Valkey 8.0/8.1 的相继发布，这场“分叉“已经不仅仅是关于许可证的争论，更演变成了两种不同技术理念和架构路线的较量。<p>本文将基于最新的技术资料，深入对比这两个项目的现状，帮助开发者在 2025 年做出明智的技术选型。<h2 id=1-he-xin-chai-yi-gai-lan-cong-dna-dao-fen-dao-yang-biao>1. 核心差异概览：从 DNA 到分道扬镳</h2><p>Valkey 最初是作为 Redis 7.2.4 的直接 Fork 诞生的，因此它们共享着相同的 DNA：基于内存的键值存储、支持丰富的数据结构、Lua 脚本以及主从复制架构。然而，随着时间的推移，两者在发展方向上展现出了明显的差异。<table><thead><tr><th style=text-align:left>特性<th style=text-align:left>Redis (8.0+)<th style=text-align:left>Valkey (8.0/8.1+)<tbody><tr><td style=text-align:left><strong>许可证</strong><td style=text-align:left>RSALv2 / SSPLv1 (非 OSI 认可开源)<td style=text-align:left>BSD 3-Clause (完全开源，Linux 基金会托管)<tr><td style=text-align:left><strong>治理模式</strong><td style=text-align:left>商业公司主导 (Redis Inc.)<td style=text-align:left>社区驱动 (AWS, Google, Oracle, Snap 等支持)<tr><td style=text-align:left><strong>核心架构</strong><td style=text-align:left>保守改进，集成 Stack 模块<td style=text-align:left>激进优化，重构核心 I/O 和内存管理<tr><td style=text-align:left><strong>生态定位</strong><td style=text-align:left>更加封闭的商业生态，强调集成体验<td style=text-align:left>坚持开放标准，兼容现有 Redis 生态</table><h2 id=2-jia-gou-yu-xing-neng-duo-xian-cheng-de-jiao-liang>2. 架构与性能：多线程的较量</h2><p>线程模型的演进是本次对比的重头戏。长期以来，Redis 的单线程模型既是其简单高效的秘诀，也是其在大核服务器上的性能瓶颈。<h3 id=redis-8-0-wen-jian-de-duo-xian-cheng-i-o>Redis 8.0：稳健的多线程 I/O</h3><p>Redis 在 6.0 引入了多线程 I/O，但核心命令执行依然是单线程的。Redis 8.0 进一步优化了这一模型。<ul><li><strong>改进点</strong>：Redis 8.0 的新 I/O 线程模型允许将更多网络读写和协议解析工作卸载给辅助线程。<li><strong>性能表现</strong>：在多核 Intel CPU 上，开启 <code>io-threads</code> 后，吞吐量相比旧版本提升了约 <strong>112%</strong>。但其核心依然受到主线程处理能力的限制。</ul><h3 id=valkey-8-0-ji-jin-de-yi-bu-i-o-jia-gou>Valkey 8.0：激进的异步 I/O 架构</h3><p>Valkey 采取了更为激进的策略。虽然为了保持原子性，命令执行仍为单线程，但 Valkey 8.0 引入了<strong>增强型异步 I/O 线程</strong>。<ul><li><strong>架构革新</strong>：Valkey 现在可以并行处理网络读取、解析以及响应写入，同时还能基于实时负载智能地将 I/O 任务分发到多个核心。<li><strong>百万级 RPS</strong>：Benchmark 显示，在 AWS c7g.4xlarge (16 vCPU) 实例上，Valkey 8.0 达到了惊人的 <strong>119 万 RPS</strong> (Requests Per Second)，相比 7.2 版本提升了 <strong>230%</strong>。<li><strong>实战反馈</strong>：Linux 内核开发者 Dirk Hohndel 报告称，在处理大规模数据流时，Valkey 带来了约 3 倍的性能提升。</ul><p><strong>结论</strong>：在现代多核服务器上，Valkey 展现出了更高的垂直扩展能力（Scale-up），能够更榨干硬件性能。<h2 id=3-nei-cun-xiao-lu-mei-zi-jie-du-suan-shu>3. 内存效率：每字节都算数</h2><p>对于内存数据库而言，内存效率直接等同于金钱。<ul><li><strong>Valkey 的 Swiss Tables 优化</strong>：Valkey 8.1 受 Google Abseil “Swiss Tables” 的启发，彻底重写了底层的哈希表实现。这一改变使得每个键值对的内存开销减少了约 20 字节。<li><strong>实际收益</strong>：对于包含数亿个小 Key 的大规模数据集，这意味着最高可达 <strong>20% 的内存节省</strong>。在大规模集群中，这直接转化为显著的成本降低。<li><strong>Redis</strong>：虽然也有内存驱逐策略的优化，但在核心数据结构的内存紧凑性上，近期未见如此幅度的底层重构。</ul><h2 id=4-ke-kao-xing-yu-fu-zhi-gao-bie-fork-feng-bao>4. 可靠性与复制：告别 Fork 风暴</h2><p>Redis 的持久化（RDB/AOF）和全量复制一直依赖 <code>fork()</code> 系统调用。在拥有大内存（如 >50GB）的实例上，<code>fork()</code> 不仅耗时，还会通过 Copy-on-Write (COW) 机制消耗大量额外内存，甚至导致性能抖动。<ul><li><strong>Redis 8.0 的双流复制</strong>：引入了双流机制，一个流传 RDB，另一个流传增量数据，使得同步速度提升了约 18%。<li><strong>Valkey 的双通道复制</strong>：Valkey 同样实现了类似的双通道复制架构。更重要的是，Valkey 针对 <code>fork()</code> 的开销进行了深度优化，在重读场景下的全量同步时间最高减少了 <strong>50%</strong>，极大缓解了节点故障恢复时的集群压力。</ul><h2 id=5-gong-neng-ji-da-er-quan-vs-zhuan-er-jing>5. 功能集：大而全 vs 专而精</h2><p><strong>Redis</strong> 的策略是“开箱即用“的丰富度。Redis 8.0 将之前的 Redis Stack 模块及其功能直接吸收到核心发行版中：<ul><li><strong>原生 JSON 支持</strong>：无需插件，直接操作 JSON 文档。<li><strong>向量搜索 (Vector Search)</strong>：面向 AI 应用，支持高维向量相似度搜索。<li><strong>时间序列 & 概率数据结构</strong>：内置 Bloom Filter 等。</ul><p><strong>Valkey</strong> 则专注于核心数据库的能力，但追赶速度极快：<ul><li><strong>JSON 支持</strong>：Valkey 8.1 已经引入了 JSON 数据类型支持。<li><strong>Bloom Filter</strong>：同样在 8.1 中加入。<li><strong>缺失项</strong>：目前 Valkey 在向量搜索（Vector Search）方面尚未原生集成，这对于需要构建 RAG（检索增强生成）应用的开发者来说是一个重要的考量点。</ul><h2 id=zong-jie-ru-he-xuan-ze>总结：如何选择？</h2><p>2025年的选择逻辑比以往清晰：<ol><li><p><strong>选择 Redis 8.0 如果…</strong></p> <ul><li>你需要<strong>官方企业级支持</strong>和商业合规背书。<li>你的应用深度依赖 <strong>Redis Stack</strong> 的高级功能，特别是 <strong>Vector Search</strong> 进行 AI 开发。<li>你更看重全家桶式的集成体验（如 Redis Insight, Redis Copilot）。</ul><li><p><strong>选择 Valkey 8.1 如果…</strong></p> <ul><li>你坚定支持<strong>完全开源 (Open Source)</strong> 协议，避免许可证风险。<li>你的场景是<strong>极致的高并发</strong>，需要单节点承载百万级 QPS。<li>你拥有<strong>海量小数据</strong>，20% 的内存节省对成本至关重要。<li>你希望紧跟 Linux 基金会及 AWS/Google 等大厂主导的开放技术栈。</ul></ol><p>Valkey 已经证明了它不仅仅是一个“抗议的 Fork“，而是一个在性能和架构上敢于革新的强大竞争者。对于大多数纯缓存和基础 KV 存储场景，Valkey 如今无疑是更具吸引力的选择。</div></div></section>