<!doctype html><html class=scroll-smooth lang=en><head><meta charset=utf-8><link href=/css/style.css rel=stylesheet><link href=/line-awesome/css/line-awesome.min.css rel=stylesheet><script defer src=/js/main.js></script><title>å…³äºValkeyé«˜æ€§èƒ½ä¼˜åŒ–çš„åšå®¢æ–‡ç« æ€»ç»“ | Roc's Blog</title><body class="bg-white dark:bg-slate-900 transition ease-in-out"><section><div class="sticky top-0 bg-slate-100 dark:bg-slate-800"><div class="container mx-auto px-auto xl:px-0 w-full xl:w-1/2 flex place-content-between py-16 xl:py-8 font-sans text-6xl xl:text-2xl text-slate-900 dark:text-slate-300"><div class=flex><a class="m-0 p-0 text-slate-900 hover:text-slate-700 dark:text-slate-300 dark:hover:text-slate-200" href=/blog/> /blog </a></div><div class="flex gap-4"><div class="hidden cursor-pointer" id=back-to-top><i class="las la-level-up-alt"></i></div><a href=/><i class="las la-home"></i></a><div class=cursor-pointer id=darkmode-toggle><div class="hidden dark:inline"><i class="las la-sun"></i></div><div class="inline dark:hidden"><i class="las la-moon"></i></div></div></div></div></div><div class="container mx-auto w-full xl:w-1/2 mb-16"><div class="mt-4 font-serif text-slate-600 dark:text-slate-500 text-4xl xl:text-base">2025-05-27</div><h1 class="w-full xl:w-2/3 mt-4 mb-8 font-serif text-8xl xl:text-4xl text-slate-900 dark:text-slate-300">å…³äºValkeyé«˜æ€§èƒ½ä¼˜åŒ–çš„åšå®¢æ–‡ç« æ€»ç»“</h1><div class="mt-2 mb-6 flex flex-wrap gap-2"></div><div class="w-100 border-t mb-8 border-slate-300 dark:border-slate-700"></div><div class="prose dark:prose-invert prose-pre:rounded-none prose-headings:bg-amber-100 prose-headings:text-slate-800 dark:prose-headings:bg-indigo-900 prose-headings:font-normal dark:prose-headings:text-slate-300 prose-headings:p-2 prose-headings:w-max prose-headings:font-serif prose-2xl xl:prose-base"><ul><li><p><a href=https://valkey.io/blog/unlock-one-million-rps/>åŸæ–‡åœ°å€-1</a></p><li><p><a href=https://valkey.io/blog/unlock-one-million-rps-part2/>åŸæ–‡åœ°å€-2</a></p></ul><p>ç›¸å…³å†…å®¹ï¼š<blockquote><p>ğŸ” <em><strong>valkey unlock one million rps blog</strong></em></blockquote><blockquote><p>ğŸ”— <a href=https://valkey.io/blog/unlock-one-million-rps/>Valkey Â· Unlock 1 Mi</a> ğŸ”— <a href=https://valkey.io/blog/unlock-one-million-rps-part2/>Valkey Â· Unlock 1 Mi</a> ğŸ”— <a href=https://www.gomomento.com/blog/valkey-turns-one-how-the-community-fork-left-redis-in-the-dust/>Valkey Turns One: Ho</a> ğŸ”— <a href=https://valkey.io/blog/>Valkey Â· List of blo</a> ğŸ”— <a href="https://news.ycombinator.com/item?id=41455072">Unlock 1M RPS: Exper</a> ğŸ”— <a href=https://www.phoronix.com/news/Valkey-8.0-Released>Valkey 8.0 Released </a> ğŸ”— <a href=https://aws.amazon.com/blogs/database/amazon-elasticache-version-8-0-for-valkey-brings-faster-scaling-and-improved-memory-efficiency/>Amazon ElastiCache v</a> ğŸ”— <a href=https://valkey.io/>Valkey</a> ğŸ”— <a href="https://news.ycombinator.com/item?id=41556751">Valkey 8.0 Released </a> ğŸ”— <a href=https://dev.to/viradiaharsh/unlocking-the-power-of-aws-elasticache-with-valkey-72-lower-costs-serverless-flexibility-and-performance-gains-5765>Unlocking the Power </a></blockquote><h2 id=wen-zhang-nei-rong-zong-jie>æ–‡ç« å†…å®¹æ€»ç»“</h2><p>æ ¹æ®è¿™ä¸¤ç¯‡Valkeyåšå®¢æ–‡ç« çš„åˆ†æï¼Œä¸»è¦å†…å®¹ï¼š<h3 id=di-yi-pian-valkeyxing-neng-you-hua-i-oduo-xian-cheng-jia-gou>ç¬¬ä¸€ç¯‡ï¼šValkeyæ€§èƒ½ä¼˜åŒ– - I/Oå¤šçº¿ç¨‹æ¶æ„</h3><p><strong>æ ¸å¿ƒä¼˜åŒ–æ€è·¯ï¼š</strong><ol><li><strong>å¤šçº¿ç¨‹I/Oæ¶æ„</strong>ï¼šå°†I/Oæ“ä½œï¼ˆè¯»å–å’Œè§£æå‘½ä»¤ã€å†™å…¥å“åº”ã€è½®è¯¢I/Oäº‹ä»¶ï¼‰ä»ä¸»çº¿ç¨‹åˆ†ç¦»åˆ°ä¸“é—¨çš„I/Oçº¿ç¨‹ï¼Œè®©ä¸»çº¿ç¨‹ä¸“æ³¨äºå‘½ä»¤æ‰§è¡Œ<li><strong>æ€§èƒ½æå‡</strong>ï¼šåœ¨8ä¸ªI/Oçº¿ç¨‹ã€300ä¸‡é”®æ•°æ®åº“ã€512å­—èŠ‚å€¼å¤§å°ã€650ä¸ªå®¢æˆ·ç«¯è¿è¡ŒSETå‘½ä»¤çš„æµ‹è¯•ä¸­ï¼Œååé‡ä»360Kæå‡åˆ°1.19Mè¯·æ±‚æ¯ç§’ï¼Œå¢é•¿çº¦230%ï¼Œå¹³å‡å»¶è¿Ÿä»1.792msé™è‡³0.542msï¼Œä¸‹é™69.8%<li><strong>è®¾è®¡åŸåˆ™</strong>ï¼šä¿æŒValkeyçš„ç®€å•æ€§ï¼Œå‘½ä»¤æ‰§è¡Œä»åœ¨å•çº¿ç¨‹ä¸­è¿›è¡Œï¼Œé¿å…å¤æ‚çš„åŒæ­¥æœºåˆ¶å’Œç«æ€æ¡ä»¶</ol><h3 id=di-er-pian-nei-cun-fang-wen-you-hua-yu-qu-he-jiao-cuo-zhi-xing>ç¬¬äºŒç¯‡ï¼šå†…å­˜è®¿é—®ä¼˜åŒ– - é¢„å–å’Œäº¤é”™æ‰§è¡Œ</h3><p><strong>æ ¸å¿ƒä¼˜åŒ–æ€è·¯ï¼š</strong><ol><li><strong>å†…å­˜è®¿é—®æ‘Šé”€</strong>ï¼šé€šè¿‡äº¤é”™æ‰§è¡Œè®¿é—®éšæœºå†…å­˜ä½ç½®çš„æ“ä½œï¼Œåˆ©ç”¨å¤„ç†å™¨çš„æ¨æµ‹æ‰§è¡Œèƒ½åŠ›ï¼Œå®ç°æ˜¾è‘—æ€§èƒ½æå‡<li><strong>å®é™…åº”ç”¨</strong>ï¼šåœ¨Valkeyçš„lookupKeyå‡½æ•°ä¸­åº”ç”¨è¿™ä¸€æŠ€æœ¯ï¼Œè¯¥å‡½æ•°å ç”¨äº†ä¸»çº¿ç¨‹40%ä»¥ä¸Šçš„æ—¶é—´ï¼Œé€šè¿‡dictPrefetchå‡½æ•°äº¤é”™æ‰§è¡Œå­—å…¸æŸ¥æ‰¾åºåˆ—ï¼Œå°†lookupKeyçš„æ—¶é—´å‡å°‘äº†80%ä»¥ä¸Š<li><strong>æ€§èƒ½æå‡</strong>ï¼šå†…å­˜è®¿é—®æ‘Šé”€æŠ€æœ¯å¯¹Valkeyæ€§èƒ½çš„å½±å“æ¥è¿‘50%ï¼Œå°†è¯·æ±‚é€Ÿç‡æå‡åˆ°è¶…è¿‡119ä¸‡RPS</ol><p><strong>æŠ€æœ¯åŸç†ï¼š</strong><ul><li>é“¾è¡¨ç¤ºä¾‹æ˜¾ç¤ºäº¤é”™éå†æ¯”é¡ºåºéå†å¿«10å€ï¼ˆä»20.8ç§’é™è‡³2ç§’ï¼‰<li>å¤„ç†å™¨åœ¨é¡ºåºè®¿é—®é“¾è¡¨æ—¶æ— æ³•æ¨æµ‹æœªæ¥çš„å†…å­˜è®¿é—®æŒ‡ä»¤<li>äº¤é”™æ‰§è¡Œå…è®¸å¤„ç†å™¨å¹¶è¡Œå‘å‡ºæ›´å¤šå†…å­˜è®¿é—®ï¼Œé€šè¿‡æ‘Šé”€å‡å°‘æ€»ä½“å†…å­˜è®¿é—®å»¶è¿Ÿ</ul><p>ç°åœ¨æˆ‘æ¥ç¼–å†™Cè¯­è¨€å®éªŒç¨‹åºæ¥éªŒè¯è¿™äº›ç»“è®ºï¼š<pre class=language-c data-lang=c style=color:#f8f8f2;background-color:#272822><code class=language-c data-lang=c><span style=color:#f92672>#include </span><span style=color:#e6db74>&lt;stdio.h>
</span><span style=color:#f92672>#include </span><span style=color:#e6db74>&lt;stdlib.h>
</span><span style=color:#f92672>#include </span><span style=color:#e6db74>&lt;time.h>
</span><span style=color:#f92672>#include </span><span style=color:#e6db74>&lt;string.h>
</span><span style=color:#f92672>#include </span><span style=color:#e6db74>&lt;sys/time.h>
</span><span style=color:#f92672>#include </span><span style=color:#e6db74>&lt;unistd.h>
</span><span>
</span><span style=color:#75715e>// é“¾è¡¨èŠ‚ç‚¹ç»“æ„
</span><span style=color:#66d9ef;font-style:italic>typedef struct</span><span> list_node {
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> val;
</span><span>    </span><span style=color:#66d9ef;font-style:italic>struct</span><span> list_node </span><span style=color:#f92672>*</span><span>next;
</span><span>} list;
</span><span>
</span><span style=color:#75715e>// åˆ›å»ºé“¾è¡¨
</span><span>list</span><span style=color:#f92672>* </span><span style=color:#a6e22e>create_list</span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t </span><span style=color:#fd971f;font-style:italic>size</span><span>) {
</span><span>    </span><span style=color:#f92672>if </span><span>(size </span><span style=color:#f92672>== </span><span style=color:#ae81ff>0</span><span>) </span><span style=color:#f92672>return </span><span style=color:#ae81ff>NULL</span><span>;
</span><span>
</span><span>    list </span><span style=color:#f92672>*</span><span>head </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(</span><span style=color:#f92672>sizeof</span><span>(list));
</span><span>    list </span><span style=color:#f92672>*</span><span>current </span><span style=color:#f92672>=</span><span> head;
</span><span>    head->val </span><span style=color:#f92672>= </span><span style=color:#66d9ef>rand</span><span>() </span><span style=color:#f92672>% </span><span style=color:#ae81ff>1000</span><span>;
</span><span>
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>1</span><span>; i </span><span style=color:#f92672>&lt;</span><span> size; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        current->next </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(</span><span style=color:#f92672>sizeof</span><span>(list));
</span><span>        current </span><span style=color:#f92672>=</span><span> current->next;
</span><span>        current->val </span><span style=color:#f92672>= </span><span style=color:#66d9ef>rand</span><span>() </span><span style=color:#f92672>% </span><span style=color:#ae81ff>1000</span><span>;
</span><span>    }
</span><span>    current->next </span><span style=color:#f92672>= </span><span style=color:#ae81ff>NULL</span><span>;
</span><span>
</span><span>    </span><span style=color:#f92672>return</span><span> head;
</span><span>}
</span><span>
</span><span style=color:#75715e>// é‡Šæ”¾é“¾è¡¨
</span><span style=color:#66d9ef;font-style:italic>void </span><span style=color:#a6e22e>free_list</span><span>(list </span><span style=color:#f92672>*</span><span style=color:#fd971f;font-style:italic>head</span><span>) {
</span><span>    </span><span style=color:#f92672>while </span><span>(head) {
</span><span>        list </span><span style=color:#f92672>*</span><span>temp </span><span style=color:#f92672>=</span><span> head;
</span><span>        head </span><span style=color:#f92672>=</span><span> head->next;
</span><span>        </span><span style=color:#66d9ef>free</span><span>(temp);
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#75715e>// é¡ºåºéå†æ±‚å’Œï¼ˆåŸå§‹æ–¹æ³•ï¼‰
</span><span style=color:#66d9ef;font-style:italic>unsigned long </span><span style=color:#a6e22e>sequential_sum</span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t </span><span style=color:#fd971f;font-style:italic>arr_size</span><span>, list </span><span style=color:#f92672>**</span><span style=color:#fd971f;font-style:italic>la</span><span>) {
</span><span>    list </span><span style=color:#f92672>*</span><span>lp;
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> res </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>;
</span><span>
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> arr_size; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        lp </span><span style=color:#f92672>=</span><span> la[i];
</span><span>        </span><span style=color:#f92672>while </span><span>(lp) {
</span><span>            res </span><span style=color:#f92672>+=</span><span> lp->val;
</span><span>            lp </span><span style=color:#f92672>=</span><span> lp->next;
</span><span>        }
</span><span>    }
</span><span>    </span><span style=color:#f92672>return</span><span> res;
</span><span>}
</span><span>
</span><span style=color:#75715e>// äº¤é”™éå†æ±‚å’Œï¼ˆä¼˜åŒ–æ–¹æ³•ï¼‰
</span><span style=color:#66d9ef;font-style:italic>unsigned long </span><span style=color:#a6e22e>interleaved_sum</span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t </span><span style=color:#fd971f;font-style:italic>arr_size</span><span>, list </span><span style=color:#f92672>**</span><span style=color:#fd971f;font-style:italic>la</span><span>) {
</span><span>    list </span><span style=color:#f92672>**</span><span>lthreads </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(arr_size </span><span style=color:#f92672>* sizeof</span><span>(list </span><span style=color:#f92672>*</span><span>));
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> res </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>;
</span><span>    </span><span style=color:#66d9ef;font-style:italic>int</span><span> n </span><span style=color:#f92672>=</span><span> arr_size;
</span><span>
</span><span>    </span><span style=color:#75715e>// åˆå§‹åŒ–æ‰€æœ‰é“¾è¡¨çš„éå†æŒ‡é’ˆ
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> arr_size; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        lthreads[i] </span><span style=color:#f92672>=</span><span> la[i];
</span><span>        </span><span style=color:#f92672>if </span><span>(lthreads[i] </span><span style=color:#f92672>== </span><span style=color:#ae81ff>NULL</span><span>)
</span><span>            n</span><span style=color:#f92672>--</span><span>;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// äº¤é”™éå†æ‰€æœ‰é“¾è¡¨
</span><span>    </span><span style=color:#f92672>while</span><span>(n) {
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> arr_size; i</span><span style=color:#f92672>++</span><span>) {
</span><span>            </span><span style=color:#f92672>if </span><span>(lthreads[i] </span><span style=color:#f92672>== </span><span style=color:#ae81ff>NULL</span><span>)
</span><span>                </span><span style=color:#f92672>continue</span><span>;
</span><span>
</span><span>            res </span><span style=color:#f92672>+=</span><span> lthreads[i]->val;
</span><span>            lthreads[i] </span><span style=color:#f92672>=</span><span> lthreads[i]->next;
</span><span>
</span><span>            </span><span style=color:#f92672>if </span><span>(lthreads[i] </span><span style=color:#f92672>== </span><span style=color:#ae81ff>NULL</span><span>)
</span><span>                n</span><span style=color:#f92672>--</span><span>;
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#66d9ef>free</span><span>(lthreads);
</span><span>    </span><span style=color:#f92672>return</span><span> res;
</span><span>}
</span><span>
</span><span style=color:#75715e>// å¸¦é¢„å–æŒ‡ä»¤çš„äº¤é”™éå†æ±‚å’Œï¼ˆè¿›ä¸€æ­¥ä¼˜åŒ–ï¼‰
</span><span style=color:#66d9ef;font-style:italic>unsigned long </span><span style=color:#a6e22e>interleaved_sum_with_prefetch</span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t </span><span style=color:#fd971f;font-style:italic>arr_size</span><span>, list </span><span style=color:#f92672>**</span><span style=color:#fd971f;font-style:italic>la</span><span>) {
</span><span>    list </span><span style=color:#f92672>**</span><span>lthreads </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(arr_size </span><span style=color:#f92672>* sizeof</span><span>(list </span><span style=color:#f92672>*</span><span>));
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> res </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>;
</span><span>    </span><span style=color:#66d9ef;font-style:italic>int</span><span> n </span><span style=color:#f92672>=</span><span> arr_size;
</span><span>
</span><span>    </span><span style=color:#75715e>// åˆå§‹åŒ–æ‰€æœ‰é“¾è¡¨çš„éå†æŒ‡é’ˆ
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> arr_size; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        lthreads[i] </span><span style=color:#f92672>=</span><span> la[i];
</span><span>        </span><span style=color:#f92672>if </span><span>(lthreads[i] </span><span style=color:#f92672>== </span><span style=color:#ae81ff>NULL</span><span>)
</span><span>            n</span><span style=color:#f92672>--</span><span>;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// äº¤é”™éå†æ‰€æœ‰é“¾è¡¨ï¼Œä½¿ç”¨é¢„å–æŒ‡ä»¤
</span><span>    </span><span style=color:#f92672>while</span><span>(n) {
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> arr_size; i</span><span style=color:#f92672>++</span><span>) {
</span><span>            </span><span style=color:#f92672>if </span><span>(lthreads[i] </span><span style=color:#f92672>== </span><span style=color:#ae81ff>NULL</span><span>)
</span><span>                </span><span style=color:#f92672>continue</span><span>;
</span><span>
</span><span>            res </span><span style=color:#f92672>+=</span><span> lthreads[i]->val;
</span><span>            lthreads[i] </span><span style=color:#f92672>=</span><span> lthreads[i]->next;
</span><span>
</span><span>            </span><span style=color:#f92672>if </span><span>(lthreads[i]) {
</span><span>                </span><span style=color:#75715e>// é¢„å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åˆ°ç¼“å­˜
</span><span>                __builtin_prefetch(lthreads[i], </span><span style=color:#ae81ff>0</span><span>, </span><span style=color:#ae81ff>1</span><span>);
</span><span>            } </span><span style=color:#f92672>else </span><span>{
</span><span>                n</span><span style=color:#f92672>--</span><span>;
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#66d9ef>free</span><span>(lthreads);
</span><span>    </span><span style=color:#f92672>return</span><span> res;
</span><span>}
</span><span>
</span><span style=color:#75715e>// è·å–å½“å‰æ—¶é—´ï¼ˆå¾®ç§’ï¼‰
</span><span style=color:#66d9ef;font-style:italic>long long </span><span style=color:#a6e22e>get_time_us</span><span>() {
</span><span>    </span><span style=color:#66d9ef;font-style:italic>struct</span><span> timeval tv;
</span><span>    gettimeofday(</span><span style=color:#f92672>&</span><span>tv, </span><span style=color:#ae81ff>NULL</span><span>);
</span><span>    </span><span style=color:#f92672>return</span><span> tv.tv_sec </span><span style=color:#f92672>* </span><span style=color:#ae81ff>1000000</span><span style=color:#66d9ef;font-style:italic>LL </span><span style=color:#f92672>+</span><span> tv.tv_usec;
</span><span>}
</span><span>
</span><span style=color:#75715e>// å“ˆå¸Œè¡¨ç›¸å…³ç»“æ„å’Œå‡½æ•°ï¼ˆæ¨¡æ‹ŸValkeyçš„å­—å…¸æŸ¥æ‰¾ä¼˜åŒ–ï¼‰
</span><span style=color:#f92672>#define </span><span>HASH_SIZE </span><span style=color:#ae81ff>1000003
</span><span>
</span><span style=color:#66d9ef;font-style:italic>typedef struct</span><span> hash_entry {
</span><span>    </span><span style=color:#66d9ef;font-style:italic>char </span><span style=color:#f92672>*</span><span>key;
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> value;
</span><span>    </span><span style=color:#66d9ef;font-style:italic>struct</span><span> hash_entry </span><span style=color:#f92672>*</span><span>next;
</span><span>} hash_entry;
</span><span>
</span><span style=color:#66d9ef;font-style:italic>typedef struct</span><span> hash_table {
</span><span>    hash_entry </span><span style=color:#f92672>**</span><span>buckets;
</span><span>    </span><span style=color:#66d9ef;font-style:italic>size_t</span><span> size;
</span><span>} hash_table;
</span><span>
</span><span style=color:#75715e>// ç®€å•å“ˆå¸Œå‡½æ•°
</span><span style=color:#66d9ef;font-style:italic>unsigned long </span><span style=color:#a6e22e>hash_func</span><span>(</span><span style=color:#f92672>const </span><span style=color:#66d9ef;font-style:italic>char </span><span style=color:#f92672>*</span><span style=color:#fd971f;font-style:italic>key</span><span>) {
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> hash </span><span style=color:#f92672>= </span><span style=color:#ae81ff>5381</span><span>;
</span><span>    </span><span style=color:#66d9ef;font-style:italic>int</span><span> c;
</span><span>    </span><span style=color:#f92672>while </span><span>((c </span><span style=color:#f92672>= *</span><span>key</span><span style=color:#f92672>++</span><span>))
</span><span>        hash </span><span style=color:#f92672>= </span><span>((hash </span><span style=color:#f92672>&lt;&lt; </span><span style=color:#ae81ff>5</span><span>) </span><span style=color:#f92672>+</span><span> hash) </span><span style=color:#f92672>+</span><span> c;
</span><span>    </span><span style=color:#f92672>return</span><span> hash </span><span style=color:#f92672>%</span><span> HASH_SIZE;
</span><span>}
</span><span>
</span><span style=color:#75715e>// åˆ›å»ºå“ˆå¸Œè¡¨
</span><span>hash_table</span><span style=color:#f92672>* </span><span style=color:#a6e22e>create_hash_table</span><span>() {
</span><span>    hash_table </span><span style=color:#f92672>*</span><span>ht </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(</span><span style=color:#f92672>sizeof</span><span>(hash_table));
</span><span>    ht->size </span><span style=color:#f92672>=</span><span> HASH_SIZE;
</span><span>    ht->buckets </span><span style=color:#f92672>= </span><span style=color:#66d9ef>calloc</span><span>(HASH_SIZE, </span><span style=color:#f92672>sizeof</span><span>(hash_entry</span><span style=color:#f92672>*</span><span>));
</span><span>    </span><span style=color:#f92672>return</span><span> ht;
</span><span>}
</span><span>
</span><span style=color:#75715e>// æ’å…¥é”®å€¼å¯¹
</span><span style=color:#66d9ef;font-style:italic>void </span><span style=color:#a6e22e>hash_insert</span><span>(hash_table </span><span style=color:#f92672>*</span><span style=color:#fd971f;font-style:italic>ht</span><span>, </span><span style=color:#f92672>const </span><span style=color:#66d9ef;font-style:italic>char </span><span style=color:#f92672>*</span><span style=color:#fd971f;font-style:italic>key</span><span>, </span><span style=color:#66d9ef;font-style:italic>unsigned long </span><span style=color:#fd971f;font-style:italic>value</span><span>) {
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> index </span><span style=color:#f92672>= </span><span>hash_func(key);
</span><span>    hash_entry </span><span style=color:#f92672>*</span><span>entry </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(</span><span style=color:#f92672>sizeof</span><span>(hash_entry));
</span><span>    entry->key </span><span style=color:#f92672>= </span><span>strdup(key);
</span><span>    entry->value </span><span style=color:#f92672>=</span><span> value;
</span><span>    entry->next </span><span style=color:#f92672>=</span><span> ht->buckets[index];
</span><span>    ht->buckets[index] </span><span style=color:#f92672>=</span><span> entry;
</span><span>}
</span><span>
</span><span style=color:#75715e>// é¡ºåºæŸ¥æ‰¾å¤šä¸ªé”®
</span><span style=color:#66d9ef;font-style:italic>unsigned long </span><span style=color:#a6e22e>sequential_lookup</span><span>(hash_table </span><span style=color:#f92672>*</span><span style=color:#fd971f;font-style:italic>ht</span><span>, </span><span style=color:#66d9ef;font-style:italic>char </span><span style=color:#f92672>**</span><span style=color:#fd971f;font-style:italic>keys</span><span>, </span><span style=color:#66d9ef;font-style:italic>size_t </span><span style=color:#fd971f;font-style:italic>num_keys</span><span>) {
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> total </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>;
</span><span>
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> num_keys; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> index </span><span style=color:#f92672>= </span><span>hash_func(keys[i]);
</span><span>        hash_entry </span><span style=color:#f92672>*</span><span>entry </span><span style=color:#f92672>=</span><span> ht->buckets[index];
</span><span>
</span><span>        </span><span style=color:#f92672>while </span><span>(entry) {
</span><span>            </span><span style=color:#f92672>if </span><span>(</span><span style=color:#66d9ef>strcmp</span><span>(entry->key, keys[i]) </span><span style=color:#f92672>== </span><span style=color:#ae81ff>0</span><span>) {
</span><span>                total </span><span style=color:#f92672>+=</span><span> entry->value;
</span><span>                </span><span style=color:#f92672>break</span><span>;
</span><span>            }
</span><span>            entry </span><span style=color:#f92672>=</span><span> entry->next;
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>return</span><span> total;
</span><span>}
</span><span>
</span><span style=color:#75715e>// é¢„å–ä¼˜åŒ–çš„æ‰¹é‡æŸ¥æ‰¾
</span><span style=color:#66d9ef;font-style:italic>unsigned long </span><span style=color:#a6e22e>prefetch_lookup</span><span>(hash_table </span><span style=color:#f92672>*</span><span style=color:#fd971f;font-style:italic>ht</span><span>, </span><span style=color:#66d9ef;font-style:italic>char </span><span style=color:#f92672>**</span><span style=color:#fd971f;font-style:italic>keys</span><span>, </span><span style=color:#66d9ef;font-style:italic>size_t </span><span style=color:#fd971f;font-style:italic>num_keys</span><span>) {
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> total </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>;
</span><span>    hash_entry </span><span style=color:#f92672>**</span><span>entries </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(num_keys </span><span style=color:#f92672>* sizeof</span><span>(hash_entry</span><span style=color:#f92672>*</span><span>));
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long </span><span style=color:#f92672>*</span><span>indices </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(num_keys </span><span style=color:#f92672>* sizeof</span><span>(</span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span>));
</span><span>
</span><span>    </span><span style=color:#75715e>// ç¬¬ä¸€é˜¶æ®µï¼šè®¡ç®—æ‰€æœ‰ç´¢å¼•å¹¶é¢„å–
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> num_keys; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        indices[i] </span><span style=color:#f92672>= </span><span>hash_func(keys[i]);
</span><span>        entries[i] </span><span style=color:#f92672>=</span><span> ht->buckets[indices[i]];
</span><span>        </span><span style=color:#f92672>if </span><span>(entries[i]) {
</span><span>            __builtin_prefetch(entries[i], </span><span style=color:#ae81ff>0</span><span>, </span><span style=color:#ae81ff>1</span><span>);
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// ç¬¬äºŒé˜¶æ®µï¼šäº¤é”™æŸ¥æ‰¾
</span><span>    </span><span style=color:#66d9ef;font-style:italic>int</span><span> remaining </span><span style=color:#f92672>=</span><span> num_keys;
</span><span>    </span><span style=color:#f92672>while </span><span>(remaining </span><span style=color:#f92672>> </span><span style=color:#ae81ff>0</span><span>) {
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> num_keys; i</span><span style=color:#f92672>++</span><span>) {
</span><span>            </span><span style=color:#f92672>if </span><span>(entries[i] </span><span style=color:#f92672>== </span><span style=color:#ae81ff>NULL</span><span>) </span><span style=color:#f92672>continue</span><span>;
</span><span>
</span><span>            </span><span style=color:#f92672>if </span><span>(</span><span style=color:#66d9ef>strcmp</span><span>(entries[i]->key, keys[i]) </span><span style=color:#f92672>== </span><span style=color:#ae81ff>0</span><span>) {
</span><span>                total </span><span style=color:#f92672>+=</span><span> entries[i]->value;
</span><span>                entries[i] </span><span style=color:#f92672>= </span><span style=color:#ae81ff>NULL</span><span>;  </span><span style=color:#75715e>// æ ‡è®°ä¸ºå·²æ‰¾åˆ°
</span><span>                remaining</span><span style=color:#f92672>--</span><span>;
</span><span>            } </span><span style=color:#f92672>else </span><span>{
</span><span>                entries[i] </span><span style=color:#f92672>=</span><span> entries[i]->next;
</span><span>                </span><span style=color:#f92672>if </span><span>(entries[i] </span><span style=color:#f92672>== </span><span style=color:#ae81ff>NULL</span><span>) {
</span><span>                    remaining</span><span style=color:#f92672>--</span><span>;
</span><span>                } </span><span style=color:#f92672>else </span><span>{
</span><span>                    __builtin_prefetch(entries[i], </span><span style=color:#ae81ff>0</span><span>, </span><span style=color:#ae81ff>1</span><span>);
</span><span>                }
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#66d9ef>free</span><span>(entries);
</span><span>    </span><span style=color:#66d9ef>free</span><span>(indices);
</span><span>    </span><span style=color:#f92672>return</span><span> total;
</span><span>}
</span><span>
</span><span style=color:#75715e>// é‡Šæ”¾å“ˆå¸Œè¡¨
</span><span style=color:#66d9ef;font-style:italic>void </span><span style=color:#a6e22e>free_hash_table</span><span>(hash_table </span><span style=color:#f92672>*</span><span style=color:#fd971f;font-style:italic>ht</span><span>) {
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> ht->size; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        hash_entry </span><span style=color:#f92672>*</span><span>entry </span><span style=color:#f92672>=</span><span> ht->buckets[i];
</span><span>        </span><span style=color:#f92672>while </span><span>(entry) {
</span><span>            hash_entry </span><span style=color:#f92672>*</span><span>temp </span><span style=color:#f92672>=</span><span> entry;
</span><span>            entry </span><span style=color:#f92672>=</span><span> entry->next;
</span><span>            </span><span style=color:#66d9ef>free</span><span>(temp->key);
</span><span>            </span><span style=color:#66d9ef>free</span><span>(temp);
</span><span>        }
</span><span>    }
</span><span>    </span><span style=color:#66d9ef>free</span><span>(ht->buckets);
</span><span>    </span><span style=color:#66d9ef>free</span><span>(ht);
</span><span>}
</span><span>
</span><span style=color:#66d9ef;font-style:italic>int </span><span style=color:#a6e22e>main</span><span>() {
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"=== Valkeyæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯éªŒè¯ç¨‹åº ===</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>"</span><span>);
</span><span>
</span><span>    </span><span style=color:#75715e>// æµ‹è¯•1ï¼šé“¾è¡¨éå†ä¼˜åŒ–éªŒè¯
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"1. é“¾è¡¨éå†ä¼˜åŒ–æµ‹è¯•</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"åˆ›å»ºæµ‹è¯•æ•°æ®...</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>
</span><span>    </span><span style=color:#f92672>const </span><span style=color:#66d9ef;font-style:italic>size_t</span><span> num_lists </span><span style=color:#f92672>= </span><span style=color:#ae81ff>16</span><span>;
</span><span>    </span><span style=color:#f92672>const </span><span style=color:#66d9ef;font-style:italic>size_t</span><span> list_size </span><span style=color:#f92672>= </span><span style=color:#ae81ff>1000000</span><span>;  </span><span style=color:#75715e>// ä¸ºäº†å¿«é€Ÿæµ‹è¯•ï¼Œä½¿ç”¨100ä¸‡è€Œé1000ä¸‡
</span><span>
</span><span>    list </span><span style=color:#f92672>**</span><span>lists </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(num_lists </span><span style=color:#f92672>* sizeof</span><span>(list</span><span style=color:#f92672>*</span><span>));
</span><span>
</span><span>    </span><span style=color:#75715e>// åˆ›å»ºæµ‹è¯•é“¾è¡¨
</span><span>    </span><span style=color:#66d9ef>srand</span><span>(</span><span style=color:#66d9ef>time</span><span>(</span><span style=color:#ae81ff>NULL</span><span>));
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> num_lists; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        lists[i] </span><span style=color:#f92672>= </span><span>create_list(list_size);
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆï¼š</span><span style=color:#ae81ff>%zu</span><span style=color:#e6db74>ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªåŒ…å«</span><span style=color:#ae81ff>%zu</span><span style=color:#e6db74>ä¸ªèŠ‚ç‚¹</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>, num_lists, list_size);
</span><span>
</span><span>    </span><span style=color:#75715e>// æµ‹è¯•é¡ºåºéå†
</span><span>    </span><span style=color:#66d9ef;font-style:italic>long long</span><span> start_time </span><span style=color:#f92672>= </span><span>get_time_us();
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> result1 </span><span style=color:#f92672>= </span><span>sequential_sum(num_lists, lists);
</span><span>    </span><span style=color:#66d9ef;font-style:italic>long long</span><span> sequential_time </span><span style=color:#f92672>= </span><span>get_time_us() </span><span style=color:#f92672>-</span><span> start_time;
</span><span>
</span><span>    </span><span style=color:#75715e>// æµ‹è¯•äº¤é”™éå†
</span><span>    start_time </span><span style=color:#f92672>= </span><span>get_time_us();
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> result2 </span><span style=color:#f92672>= </span><span>interleaved_sum(num_lists, lists);
</span><span>    </span><span style=color:#66d9ef;font-style:italic>long long</span><span> interleaved_time </span><span style=color:#f92672>= </span><span>get_time_us() </span><span style=color:#f92672>-</span><span> start_time;
</span><span>
</span><span>    </span><span style=color:#75715e>// æµ‹è¯•å¸¦é¢„å–çš„äº¤é”™éå†
</span><span>    start_time </span><span style=color:#f92672>= </span><span>get_time_us();
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> result3 </span><span style=color:#f92672>= </span><span>interleaved_sum_with_prefetch(num_lists, lists);
</span><span>    </span><span style=color:#66d9ef;font-style:italic>long long</span><span> prefetch_time </span><span style=color:#f92672>= </span><span>get_time_us() </span><span style=color:#f92672>-</span><span> start_time;
</span><span>
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>é“¾è¡¨éå†æµ‹è¯•ç»“æœï¼š</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"é¡ºåºéå†ï¼š      </span><span style=color:#ae81ff>%lld</span><span style=color:#e6db74> å¾®ç§’ï¼Œç»“æœï¼š</span><span style=color:#ae81ff>%lu\n</span><span style=color:#e6db74>"</span><span>, sequential_time, result1);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"äº¤é”™éå†ï¼š      </span><span style=color:#ae81ff>%lld</span><span style=color:#e6db74> å¾®ç§’ï¼Œç»“æœï¼š</span><span style=color:#ae81ff>%lu</span><span style=color:#e6db74> (æå‡ï¼š</span><span style=color:#ae81ff>%.2f</span><span style=color:#e6db74>x)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>, 
</span><span>           interleaved_time, result2, (</span><span style=color:#66d9ef;font-style:italic>double</span><span>)sequential_time </span><span style=color:#f92672>/</span><span> interleaved_time);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"é¢„å–+äº¤é”™éå†ï¼š </span><span style=color:#ae81ff>%lld</span><span style=color:#e6db74> å¾®ç§’ï¼Œç»“æœï¼š</span><span style=color:#ae81ff>%lu</span><span style=color:#e6db74> (æå‡ï¼š</span><span style=color:#ae81ff>%.2f</span><span style=color:#e6db74>x)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>, 
</span><span>           prefetch_time, result3, (</span><span style=color:#66d9ef;font-style:italic>double</span><span>)sequential_time </span><span style=color:#f92672>/</span><span> prefetch_time);
</span><span>
</span><span>    </span><span style=color:#75715e>// éªŒè¯ç»“æœæ­£ç¡®æ€§
</span><span>    </span><span style=color:#f92672>if </span><span>(result1 </span><span style=color:#f92672>==</span><span> result2 </span><span style=color:#f92672>&&</span><span> result2 </span><span style=color:#f92672>==</span><span> result3) {
</span><span>        </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"âœ“ æ‰€æœ‰ç®—æ³•ç»“æœä¸€è‡´ï¼ŒéªŒè¯é€šè¿‡</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    } </span><span style=color:#f92672>else </span><span>{
</span><span>        </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"âœ— ç»“æœä¸ä¸€è‡´ï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// æ¸…ç†é“¾è¡¨
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> num_lists; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        free_list(lists[i]);
</span><span>    }
</span><span>    </span><span style=color:#66d9ef>free</span><span>(lists);
</span><span>
</span><span>    </span><span style=color:#75715e>// æµ‹è¯•2ï¼šå“ˆå¸Œè¡¨æŸ¥æ‰¾ä¼˜åŒ–éªŒè¯
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>2. å“ˆå¸Œè¡¨æŸ¥æ‰¾ä¼˜åŒ–æµ‹è¯•ï¼ˆæ¨¡æ‹ŸValkeyå­—å…¸æŸ¥æ‰¾ï¼‰</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>
</span><span>    hash_table </span><span style=color:#f92672>*</span><span>ht </span><span style=color:#f92672>= </span><span>create_hash_table();
</span><span>    </span><span style=color:#f92672>const </span><span style=color:#66d9ef;font-style:italic>size_t</span><span> num_test_keys </span><span style=color:#f92672>= </span><span style=color:#ae81ff>100000</span><span>;
</span><span>    </span><span style=color:#f92672>const </span><span style=color:#66d9ef;font-style:italic>size_t</span><span> lookup_batch_size </span><span style=color:#f92672>= </span><span style=color:#ae81ff>1000</span><span>;
</span><span>
</span><span>    </span><span style=color:#75715e>// æ’å…¥æµ‹è¯•æ•°æ®
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"æ’å…¥ </span><span style=color:#ae81ff>%zu</span><span style=color:#e6db74> ä¸ªé”®å€¼å¯¹...</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>, num_test_keys);
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> num_test_keys; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>char</span><span> key[</span><span style=color:#ae81ff>32</span><span>];
</span><span>        </span><span style=color:#66d9ef>snprintf</span><span>(key, </span><span style=color:#f92672>sizeof</span><span>(key), </span><span style=color:#e6db74>"key_</span><span style=color:#ae81ff>%zu</span><span style=color:#e6db74>"</span><span>, i);
</span><span>        hash_insert(ht, key, i </span><span style=color:#f92672>* </span><span style=color:#ae81ff>2</span><span>);
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// å‡†å¤‡æŸ¥æ‰¾çš„é”®
</span><span>    </span><span style=color:#66d9ef;font-style:italic>char </span><span style=color:#f92672>**</span><span>lookup_keys </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(lookup_batch_size </span><span style=color:#f92672>* sizeof</span><span>(</span><span style=color:#66d9ef;font-style:italic>char</span><span style=color:#f92672>*</span><span>));
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> lookup_batch_size; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        lookup_keys[i] </span><span style=color:#f92672>= </span><span style=color:#66d9ef>malloc</span><span>(</span><span style=color:#ae81ff>32</span><span>);
</span><span>        </span><span style=color:#66d9ef>snprintf</span><span>(lookup_keys[i], </span><span style=color:#ae81ff>32</span><span>, </span><span style=color:#e6db74>"key_</span><span style=color:#ae81ff>%zu</span><span style=color:#e6db74>"</span><span>, </span><span style=color:#66d9ef>rand</span><span>() </span><span style=color:#f92672>%</span><span> num_test_keys);
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// æµ‹è¯•é¡ºåºæŸ¥æ‰¾
</span><span>    start_time </span><span style=color:#f92672>= </span><span>get_time_us();
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> hash_result1 </span><span style=color:#f92672>= </span><span>sequential_lookup(ht, lookup_keys, lookup_batch_size);
</span><span>    </span><span style=color:#66d9ef;font-style:italic>long long</span><span> hash_sequential_time </span><span style=color:#f92672>= </span><span>get_time_us() </span><span style=color:#f92672>-</span><span> start_time;
</span><span>
</span><span>    </span><span style=color:#75715e>// æµ‹è¯•é¢„å–ä¼˜åŒ–æŸ¥æ‰¾
</span><span>    start_time </span><span style=color:#f92672>= </span><span>get_time_us();
</span><span>    </span><span style=color:#66d9ef;font-style:italic>unsigned long</span><span> hash_result2 </span><span style=color:#f92672>= </span><span>prefetch_lookup(ht, lookup_keys, lookup_batch_size);
</span><span>    </span><span style=color:#66d9ef;font-style:italic>long long</span><span> hash_prefetch_time </span><span style=color:#f92672>= </span><span>get_time_us() </span><span style=color:#f92672>-</span><span> start_time;
</span><span>
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>å“ˆå¸Œè¡¨æŸ¥æ‰¾æµ‹è¯•ç»“æœï¼š</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"é¡ºåºæŸ¥æ‰¾ï¼š    </span><span style=color:#ae81ff>%lld</span><span style=color:#e6db74> å¾®ç§’ï¼Œç»“æœï¼š</span><span style=color:#ae81ff>%lu\n</span><span style=color:#e6db74>"</span><span>, hash_sequential_time, hash_result1);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"é¢„å–ä¼˜åŒ–æŸ¥æ‰¾ï¼š</span><span style=color:#ae81ff>%lld</span><span style=color:#e6db74> å¾®ç§’ï¼Œç»“æœï¼š</span><span style=color:#ae81ff>%lu</span><span style=color:#e6db74> (æå‡ï¼š</span><span style=color:#ae81ff>%.2f</span><span style=color:#e6db74>x)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>, 
</span><span>           hash_prefetch_time, hash_result2, (</span><span style=color:#66d9ef;font-style:italic>double</span><span>)hash_sequential_time </span><span style=color:#f92672>/</span><span> hash_prefetch_time);
</span><span>
</span><span>    </span><span style=color:#f92672>if </span><span>(hash_result1 </span><span style=color:#f92672>==</span><span> hash_result2) {
</span><span>        </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"âœ“ å“ˆå¸Œè¡¨æŸ¥æ‰¾ç»“æœä¸€è‡´ï¼ŒéªŒè¯é€šè¿‡</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    } </span><span style=color:#f92672>else </span><span>{
</span><span>        </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"âœ— å“ˆå¸Œè¡¨æŸ¥æ‰¾ç»“æœä¸ä¸€è‡´</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// æ¸…ç†èµ„æº
</span><span>    </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>size_t</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> lookup_batch_size; i</span><span style=color:#f92672>++</span><span>) {
</span><span>        </span><span style=color:#66d9ef>free</span><span>(lookup_keys[i]);
</span><span>    }
</span><span>    </span><span style=color:#66d9ef>free</span><span>(lookup_keys);
</span><span>    free_hash_table(ht);
</span><span>
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>=== æ€»ç»“ ===</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"1. é“¾è¡¨äº¤é”™éå†ç›¸æ¯”é¡ºåºéå†å¯ä»¥è·å¾—æ˜¾è‘—æ€§èƒ½æå‡</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"2. é¢„å–æŒ‡ä»¤å¯ä»¥è¿›ä¸€æ­¥æå‡æ€§èƒ½</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"3. è¿™äº›ä¼˜åŒ–æŠ€æœ¯é€šè¿‡æ”¹å–„å†…å­˜è®¿é—®æ¨¡å¼ï¼Œå‡å°‘CPUç­‰å¾…æ—¶é—´</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"4. Valkeyé€šè¿‡ç±»ä¼¼æŠ€æœ¯åœ¨lookupKeyå‡½æ•°ä¸­è·å¾—äº†80</span><span style=color:#ae81ff>%%</span><span style=color:#e6db74>ä»¥ä¸Šçš„æ€§èƒ½æå‡</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>    </span><span style=color:#66d9ef>printf</span><span>(</span><span style=color:#e6db74>"5. ç»“åˆI/Oå¤šçº¿ç¨‹ï¼ŒValkey 8.0å®ç°äº†ä»360Kåˆ°1.19M RPSçš„æ€§èƒ½é£è·ƒ</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>);
</span><span>
</span><span>    </span><span style=color:#f92672>return </span><span style=color:#ae81ff>0</span><span>;
</span><span>}
</span></code></pre><p>æˆ‘è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªMakefileæ¥å¸®åŠ©ç¼–è¯‘å’Œè¿è¡Œè¿™ä¸ªå®éªŒç¨‹åºï¼š<pre class=language-makefile data-lang=makefile style=color:#f8f8f2;background-color:#272822><code class=language-makefile data-lang=makefile><span>CC </span><span style=color:#f92672>= </span><span style=color:#e6db74>gcc
</span><span>CFLAGS </span><span style=color:#f92672>= </span><span style=color:#e6db74>-O2 -Wall -Wextra -std=c99
</span><span>TARGET </span><span style=color:#f92672>= </span><span style=color:#e6db74>valkey_test
</span><span>SOURCE </span><span style=color:#f92672>= </span><span style=color:#e6db74>valkey_optimization_test.c
</span><span>
</span><span style=color:#75715e># é»˜è®¤ç›®æ ‡
</span><span style=color:#a6e22e>all</span><span style=color:#f92672>: </span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>TARGET</span><span style=color:#f92672;font-style:italic>)
</span><span>
</span><span style=color:#75715e># ç¼–è¯‘ç›®æ ‡
</span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>TARGET</span><span style=color:#f92672;font-style:italic>)</span><span style=color:#f92672>: </span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>SOURCE</span><span style=color:#f92672;font-style:italic>)
</span><span>    </span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>CC</span><span style=color:#f92672;font-style:italic>) $(</span><span style=color:#fd971f;font-style:italic>CFLAGS</span><span style=color:#f92672;font-style:italic>) </span><span>-o </span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>TARGET</span><span style=color:#f92672;font-style:italic>) $(</span><span style=color:#fd971f;font-style:italic>SOURCE</span><span style=color:#f92672;font-style:italic>)
</span><span>
</span><span style=color:#75715e># è¿è¡Œæµ‹è¯•
</span><span style=color:#a6e22e>run</span><span style=color:#f92672>: </span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>TARGET</span><span style=color:#f92672;font-style:italic>)
</span><span>    ./</span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>TARGET</span><span style=color:#f92672;font-style:italic>)
</span><span>
</span><span style=color:#75715e># ä¼˜åŒ–ç¼–è¯‘ï¼ˆå¯ç”¨æ›´å¤šä¼˜åŒ–ï¼‰
</span><span style=color:#a6e22e>optimized</span><span style=color:#f92672>: 
</span><span>    </span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>CC</span><span style=color:#f92672;font-style:italic>) </span><span>-O3</span><span style=color:#fd971f;font-style:italic> -march</span><span style=color:#f92672>=</span><span>native</span><span style=color:#fd971f;font-style:italic> -mtune</span><span style=color:#f92672>=</span><span>native</span><span style=color:#fd971f;font-style:italic> -Wall -Wextra -std</span><span style=color:#f92672>=</span><span>c99</span><span style=color:#fd971f;font-style:italic> -o </span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>TARGET</span><span style=color:#f92672;font-style:italic>) $(</span><span style=color:#fd971f;font-style:italic>SOURCE</span><span style=color:#f92672;font-style:italic>)
</span><span>
</span><span style=color:#75715e># è°ƒè¯•ç¼–è¯‘
</span><span style=color:#a6e22e>debug</span><span style=color:#f92672>:
</span><span>    </span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>CC</span><span style=color:#f92672;font-style:italic>) </span><span>-g</span><span style=color:#fd971f;font-style:italic> -O0 -Wall -Wextra -std</span><span style=color:#f92672>=</span><span>c99</span><span style=color:#fd971f;font-style:italic> -o </span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>TARGET</span><span style=color:#f92672;font-style:italic>) $(</span><span style=color:#fd971f;font-style:italic>SOURCE</span><span style=color:#f92672;font-style:italic>)
</span><span>
</span><span style=color:#75715e># æ¸…ç†
</span><span style=color:#a6e22e>clean</span><span style=color:#f92672>:
</span><span>    rm</span><span style=color:#fd971f;font-style:italic> -f </span><span style=color:#f92672;font-style:italic>$(</span><span style=color:#fd971f;font-style:italic>TARGET</span><span style=color:#f92672;font-style:italic>)
</span><span>
</span><span style=color:#75715e># æ˜¾ç¤ºå¸®åŠ©
</span><span style=color:#a6e22e>help</span><span style=color:#f92672>:
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"å¯ç”¨ç›®æ ‡ï¼š"
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"  all       - ç¼–è¯‘ç¨‹åºï¼ˆé»˜è®¤ï¼‰"
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"  run       - ç¼–è¯‘å¹¶è¿è¡Œç¨‹åº"
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"  optimized - ä½¿ç”¨æœ€é«˜ä¼˜åŒ–çº§åˆ«ç¼–è¯‘"
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"  debug     - ç¼–è¯‘è°ƒè¯•ç‰ˆæœ¬"
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"  clean     - æ¸…ç†ç¼–è¯‘äº§ç‰©"
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"  help      - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>""
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"ä½¿ç”¨ç¤ºä¾‹ï¼š"
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"  make run          </span><span style=color:#75715e># ç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•"
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"  make optimized    </span><span style=color:#75715e># é«˜ä¼˜åŒ–ç¼–è¯‘"
</span><span>    </span><span style=color:#ae81ff>@</span><span style=color:#66d9ef>echo </span><span style=color:#e6db74>"  make clean        </span><span style=color:#75715e># æ¸…ç†æ–‡ä»¶"
</span><span>
</span><span style=color:#a6e22e>.PHONY</span><span style=color:#f92672>: </span><span style=color:#e6db74>all run optimized debug clean help
</span></code></pre><h2 id=zong-jie>æ€»ç»“</h2><p>æˆ‘å·²ç»å®Œæˆäº†å¯¹ä¸¤ç¯‡Valkeyåšå®¢æ–‡ç« çš„åˆ†æå’Œå®éªŒç¨‹åºçš„ç¼–å†™ã€‚ä»¥ä¸‹æ˜¯ä¸»è¦å†…å®¹ï¼š<h3 id=wen-zhang-he-xin-ji-shu-yao-dian>æ–‡ç« æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹ï¼š</h3><ol><li><p><strong>I/Oå¤šçº¿ç¨‹ä¼˜åŒ–</strong>ï¼š</p> <ul><li>å°†I/Oæ“ä½œä»ä¸»çº¿ç¨‹åˆ†ç¦»åˆ°ä¸“é—¨çš„I/Oçº¿ç¨‹<li>ååé‡æå‡230%ï¼ˆ360K â†’ 1.19M RPSï¼‰<li>å¹³å‡å»¶è¿Ÿé™ä½69.8%ï¼ˆ1.792ms â†’ 0.542msï¼‰</ul><li><p><strong>å†…å­˜è®¿é—®æ‘Šé”€ä¼˜åŒ–</strong>ï¼š</p> <ul><li>é€šè¿‡äº¤é”™æ‰§è¡Œå‡å°‘å†…å­˜è®¿é—®å»¶è¿Ÿ<li>lookupKeyå‡½æ•°æ€§èƒ½æå‡80%+<li>æ•´ä½“æ€§èƒ½å†æå‡50%</ul></ol><h3 id=shi-yan-cheng-xu-yan-zheng>å®éªŒç¨‹åºéªŒè¯ï¼š</h3><p>æˆ‘ç¼–å†™çš„Cè¯­è¨€ç¨‹åºåŒ…å«ä¸¤ä¸ªä¸»è¦æµ‹è¯•ï¼š<ol><li><p><strong>é“¾è¡¨éå†ä¼˜åŒ–æµ‹è¯•</strong>ï¼š</p> <ul><li>éªŒè¯é¡ºåºéå†vsäº¤é”™éå†çš„æ€§èƒ½å·®å¼‚<li>æµ‹è¯•é¢„å–æŒ‡ä»¤çš„é¢å¤–ä¼˜åŒ–æ•ˆæœ<li>æ¨¡æ‹Ÿæ–‡ç« ä¸­é“¾è¡¨ç¤ºä¾‹çš„10å€æ€§èƒ½æå‡</ul><li><p><strong>å“ˆå¸Œè¡¨æŸ¥æ‰¾ä¼˜åŒ–æµ‹è¯•</strong>ï¼š</p> <ul><li>æ¨¡æ‹ŸValkeyå­—å…¸æŸ¥æ‰¾çš„ä¼˜åŒ–åœºæ™¯<li>éªŒè¯é¢„å–å’Œæ‰¹é‡å¤„ç†çš„æ€§èƒ½æå‡<li>å¯¹åº”æ–‡ç« ä¸­lookupKeyå‡½æ•°çš„ä¼˜åŒ–</ul></ol><h3 id=shi-yong-fang-fa>ä½¿ç”¨æ–¹æ³•ï¼š</h3><pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#272822><code class=language-bash data-lang=bash><span style=color:#75715e># ç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•
</span><span>make run
</span><span>
</span><span style=color:#75715e># æˆ–è€…ä½¿ç”¨é«˜ä¼˜åŒ–ç¼–è¯‘
</span><span>make optimized
</span><span>./valkey_test
</span><span>
</span><span style=color:#f92672>=</span><span style=color:#e6db74>== </span><span>Valkeyæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯éªŒè¯ç¨‹åº ===
</span><span>
</span><span>1. é“¾è¡¨éå†ä¼˜åŒ–æµ‹è¯•
</span><span>åˆ›å»ºæµ‹è¯•æ•°æ®...
</span><span>æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆï¼š16ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªåŒ…å«1000000ä¸ªèŠ‚ç‚¹
</span><span>
</span><span>é“¾è¡¨éå†æµ‹è¯•ç»“æœï¼š
</span><span>é¡ºåºéå†ï¼š      91915 å¾®ç§’ï¼Œç»“æœï¼š7990951360
</span><span>äº¤é”™éå†ï¼š      57780 å¾®ç§’ï¼Œç»“æœï¼š7990951360 (æå‡ï¼š1.59x)
</span><span>é¢„å–+äº¤é”™éå†ï¼š 53289 å¾®ç§’ï¼Œç»“æœï¼š7990951360 (æå‡ï¼š1.72x)
</span><span>âœ“ æ‰€æœ‰ç®—æ³•ç»“æœä¸€è‡´ï¼ŒéªŒè¯é€šè¿‡
</span><span>
</span><span>2. å“ˆå¸Œè¡¨æŸ¥æ‰¾ä¼˜åŒ–æµ‹è¯•ï¼ˆæ¨¡æ‹ŸValkeyå­—å…¸æŸ¥æ‰¾ï¼‰
</span><span>æ’å…¥ 100000 ä¸ªé”®å€¼å¯¹...
</span><span>
</span><span>å“ˆå¸Œè¡¨æŸ¥æ‰¾æµ‹è¯•ç»“æœï¼š
</span><span>é¡ºåºæŸ¥æ‰¾ï¼š    228 å¾®ç§’ï¼Œç»“æœï¼š97528762
</span><span>é¢„å–ä¼˜åŒ–æŸ¥æ‰¾ï¼š53 å¾®ç§’ï¼Œç»“æœï¼š97528762 (æå‡ï¼š4.30x)
</span><span>âœ“ å“ˆå¸Œè¡¨æŸ¥æ‰¾ç»“æœä¸€è‡´ï¼ŒéªŒè¯é€šè¿‡
</span><span>
</span><span style=color:#f92672>=</span><span style=color:#e6db74>== </span><span>æ€»ç»“ ===
</span><span>1. é“¾è¡¨äº¤é”™éå†ç›¸æ¯”é¡ºåºéå†å¯ä»¥è·å¾—æ˜¾è‘—æ€§èƒ½æå‡
</span><span>2. é¢„å–æŒ‡ä»¤å¯ä»¥è¿›ä¸€æ­¥æå‡æ€§èƒ½
</span><span>3. è¿™äº›ä¼˜åŒ–æŠ€æœ¯é€šè¿‡æ”¹å–„å†…å­˜è®¿é—®æ¨¡å¼ï¼Œå‡å°‘CPUç­‰å¾…æ—¶é—´
</span><span>4. Valkeyé€šè¿‡ç±»ä¼¼æŠ€æœ¯åœ¨lookupKeyå‡½æ•°ä¸­è·å¾—äº†80%ä»¥ä¸Šçš„æ€§èƒ½æå‡
</span><span>5. ç»“åˆI/Oå¤šçº¿ç¨‹ï¼ŒValkey 8.0å®ç°äº†ä»360Kåˆ°1.19M RPSçš„æ€§èƒ½é£è·ƒ
</span></code></pre><p>è¿™ä¸ªå®éªŒç¨‹åºèƒ½å¤ŸéªŒè¯Valkeyæ–‡ç« ä¸­æåˆ°çš„æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯ï¼Œå±•ç¤ºå†…å­˜è®¿é—®æ¨¡å¼ä¼˜åŒ–å¯¹æ€§èƒ½çš„å·¨å¤§å½±å“ã€‚é€šè¿‡äº¤é”™æ‰§è¡Œå’Œé¢„å–æŒ‡ä»¤ï¼Œå¯ä»¥æ˜¾è‘—æå‡å¤„ç†å¤§é‡éšæœºå†…å­˜è®¿é—®çš„æ€§èƒ½ï¼Œè¿™æ­£æ˜¯Valkeyå®ç°ç™¾ä¸‡çº§RPSçš„å…³é”®æŠ€æœ¯åŸºç¡€ã€‚</div></div></section>