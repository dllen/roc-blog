<!doctype html><html class=scroll-smooth lang=en><head><meta charset=utf-8><link href=/css/style.css rel=stylesheet><link href=/line-awesome/css/line-awesome.min.css rel=stylesheet><script defer src=/js/main.js></script><title>å…³äºValkeyé«˜æ€§èƒ½ä¼˜åŒ–çš„åšå®¢æ–‡ç« æ€»ç»“ | ç å†œçš„è‡ªç•™åœ°</title><body class="bg-white dark:bg-slate-900 transition ease-in-out"><section><div class="sticky top-0 bg-slate-100 dark:bg-slate-800"><div class="container mx-auto px-auto xl:px-0 w-full xl:w-1/2 flex place-content-between py-16 xl:py-8 font-sans text-6xl xl:text-2xl text-slate-900 dark:text-slate-300"><div class=flex><a class="m-0 p-0 text-slate-900 hover:text-slate-700 dark:text-slate-300 dark:hover:text-slate-200" href=/blog/> /blog </a></div><div class="flex gap-4"><div class="hidden cursor-pointer" id=back-to-top><i class="las la-level-up-alt"></i></div><a href=/><i class="las la-home"></i></a><div class=cursor-pointer id=darkmode-toggle><div class="hidden dark:inline"><i class="las la-sun"></i></div><div class="inline dark:hidden"><i class="las la-moon"></i></div></div></div></div></div><div class="container mx-auto w-full xl:w-1/2 mb-16"><div class="mt-4 font-serif text-slate-600 dark:text-slate-500 text-4xl xl:text-base">2025-05-27</div><h1 class="w-full xl:w-2/3 mt-4 mb-8 font-serif text-8xl xl:text-4xl text-slate-900 dark:text-slate-300">å…³äºValkeyé«˜æ€§èƒ½ä¼˜åŒ–çš„åšå®¢æ–‡ç« æ€»ç»“</h1><div class="mt-2 mb-6 flex flex-wrap gap-2"></div><div class="w-100 border-t mb-8 border-slate-300 dark:border-slate-700"></div><div class="prose dark:prose-invert prose-pre:rounded-none prose-headings:bg-amber-100 prose-headings:text-slate-800 dark:prose-headings:bg-indigo-900 prose-headings:font-normal dark:prose-headings:text-slate-300 prose-headings:p-2 prose-headings:w-max prose-headings:font-serif prose-2xl xl:prose-base"><ul><li><p><a href=https://valkey.io/blog/unlock-one-million-rps/ rel=external>åŸæ–‡åœ°å€-1</a></p><li><p><a href=https://valkey.io/blog/unlock-one-million-rps-part2/ rel=external>åŸæ–‡åœ°å€-2</a></p></ul><p>ç›¸å…³å†…å®¹ï¼š<blockquote><p>ğŸ” <em><strong>valkey unlock one million rps blog</strong></em></blockquote><blockquote><p>ğŸ”— <a href=https://valkey.io/blog/unlock-one-million-rps/ rel=external>Valkey Â· Unlock 1 Mi</a> ğŸ”— <a href=https://valkey.io/blog/unlock-one-million-rps-part2/ rel=external>Valkey Â· Unlock 1 Mi</a> ğŸ”— <a href=https://www.gomomento.com/blog/valkey-turns-one-how-the-community-fork-left-redis-in-the-dust/ rel=external>Valkey Turns One: Ho</a> ğŸ”— <a href=https://valkey.io/blog/ rel=external>Valkey Â· List of blo</a> ğŸ”— <a href="https://news.ycombinator.com/item?id=41455072" rel=external>Unlock 1M RPS: Exper</a> ğŸ”— <a href=https://www.phoronix.com/news/Valkey-8.0-Released rel=external>Valkey 8.0 Released </a> ğŸ”— <a href=https://aws.amazon.com/blogs/database/amazon-elasticache-version-8-0-for-valkey-brings-faster-scaling-and-improved-memory-efficiency/ rel=external>Amazon ElastiCache v</a> ğŸ”— <a href=https://valkey.io/ rel=external>Valkey</a> ğŸ”— <a href="https://news.ycombinator.com/item?id=41556751" rel=external>Valkey 8.0 Released </a> ğŸ”— <a href=https://dev.to/viradiaharsh/unlocking-the-power-of-aws-elasticache-with-valkey-72-lower-costs-serverless-flexibility-and-performance-gains-5765 rel=external>Unlocking the Power </a></blockquote><h2 id=wen-zhang-nei-rong-zong-jie>æ–‡ç« å†…å®¹æ€»ç»“</h2><p>æ ¹æ®è¿™ä¸¤ç¯‡Valkeyåšå®¢æ–‡ç« çš„åˆ†æï¼Œä¸»è¦å†…å®¹ï¼š<h3 id=di-yi-pian-valkeyxing-neng-you-hua-i-oduo-xian-cheng-jia-gou>ç¬¬ä¸€ç¯‡ï¼šValkeyæ€§èƒ½ä¼˜åŒ– - I/Oå¤šçº¿ç¨‹æ¶æ„</h3><p><strong>æ ¸å¿ƒä¼˜åŒ–æ€è·¯ï¼š</strong><ol><li><strong>å¤šçº¿ç¨‹I/Oæ¶æ„</strong>ï¼šå°†I/Oæ“ä½œï¼ˆè¯»å–å’Œè§£æå‘½ä»¤ã€å†™å…¥å“åº”ã€è½®è¯¢I/Oäº‹ä»¶ï¼‰ä»ä¸»çº¿ç¨‹åˆ†ç¦»åˆ°ä¸“é—¨çš„I/Oçº¿ç¨‹ï¼Œè®©ä¸»çº¿ç¨‹ä¸“æ³¨äºå‘½ä»¤æ‰§è¡Œ<li><strong>æ€§èƒ½æå‡</strong>ï¼šåœ¨8ä¸ªI/Oçº¿ç¨‹ã€300ä¸‡é”®æ•°æ®åº“ã€512å­—èŠ‚å€¼å¤§å°ã€650ä¸ªå®¢æˆ·ç«¯è¿è¡ŒSETå‘½ä»¤çš„æµ‹è¯•ä¸­ï¼Œååé‡ä»360Kæå‡åˆ°1.19Mè¯·æ±‚æ¯ç§’ï¼Œå¢é•¿çº¦230%ï¼Œå¹³å‡å»¶è¿Ÿä»1.792msé™è‡³0.542msï¼Œä¸‹é™69.8%<li><strong>è®¾è®¡åŸåˆ™</strong>ï¼šä¿æŒValkeyçš„ç®€å•æ€§ï¼Œå‘½ä»¤æ‰§è¡Œä»åœ¨å•çº¿ç¨‹ä¸­è¿›è¡Œï¼Œé¿å…å¤æ‚çš„åŒæ­¥æœºåˆ¶å’Œç«æ€æ¡ä»¶</ol><h3 id=di-er-pian-nei-cun-fang-wen-you-hua-yu-qu-he-jiao-cuo-zhi-xing>ç¬¬äºŒç¯‡ï¼šå†…å­˜è®¿é—®ä¼˜åŒ– - é¢„å–å’Œäº¤é”™æ‰§è¡Œ</h3><p><strong>æ ¸å¿ƒä¼˜åŒ–æ€è·¯ï¼š</strong><ol><li><strong>å†…å­˜è®¿é—®æ‘Šé”€</strong>ï¼šé€šè¿‡äº¤é”™æ‰§è¡Œè®¿é—®éšæœºå†…å­˜ä½ç½®çš„æ“ä½œï¼Œåˆ©ç”¨å¤„ç†å™¨çš„æ¨æµ‹æ‰§è¡Œèƒ½åŠ›ï¼Œå®ç°æ˜¾è‘—æ€§èƒ½æå‡<li><strong>å®é™…åº”ç”¨</strong>ï¼šåœ¨Valkeyçš„lookupKeyå‡½æ•°ä¸­åº”ç”¨è¿™ä¸€æŠ€æœ¯ï¼Œè¯¥å‡½æ•°å ç”¨äº†ä¸»çº¿ç¨‹40%ä»¥ä¸Šçš„æ—¶é—´ï¼Œé€šè¿‡dictPrefetchå‡½æ•°äº¤é”™æ‰§è¡Œå­—å…¸æŸ¥æ‰¾åºåˆ—ï¼Œå°†lookupKeyçš„æ—¶é—´å‡å°‘äº†80%ä»¥ä¸Š<li><strong>æ€§èƒ½æå‡</strong>ï¼šå†…å­˜è®¿é—®æ‘Šé”€æŠ€æœ¯å¯¹Valkeyæ€§èƒ½çš„å½±å“æ¥è¿‘50%ï¼Œå°†è¯·æ±‚é€Ÿç‡æå‡åˆ°è¶…è¿‡119ä¸‡RPS</ol><p><strong>æŠ€æœ¯åŸç†ï¼š</strong><ul><li>é“¾è¡¨ç¤ºä¾‹æ˜¾ç¤ºäº¤é”™éå†æ¯”é¡ºåºéå†å¿«10å€ï¼ˆä»20.8ç§’é™è‡³2ç§’ï¼‰<li>å¤„ç†å™¨åœ¨é¡ºåºè®¿é—®é“¾è¡¨æ—¶æ— æ³•æ¨æµ‹æœªæ¥çš„å†…å­˜è®¿é—®æŒ‡ä»¤<li>äº¤é”™æ‰§è¡Œå…è®¸å¤„ç†å™¨å¹¶è¡Œå‘å‡ºæ›´å¤šå†…å­˜è®¿é—®ï¼Œé€šè¿‡æ‘Šé”€å‡å°‘æ€»ä½“å†…å­˜è®¿é—®å»¶è¿Ÿ</ul><p>ç°åœ¨æˆ‘æ¥ç¼–å†™Cè¯­è¨€å®éªŒç¨‹åºæ¥éªŒè¯è¿™äº›ç»“è®ºï¼š<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=c><span class=giallo-l><span style=color:#5e81ac;font-weight:700>#</span><span style=color:#81a1c1>include</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>stdio.h</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#5e81ac;font-weight:700>#</span><span style=color:#81a1c1>include</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>stdlib.h</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#5e81ac;font-weight:700>#</span><span style=color:#81a1c1>include</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>time.h</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#5e81ac;font-weight:700>#</span><span style=color:#81a1c1>include</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>string.h</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#5e81ac;font-weight:700>#</span><span style=color:#81a1c1>include</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>sys/time.h</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#5e81ac;font-weight:700>#</span><span style=color:#81a1c1>include</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>unistd.h</span><span style=color:#eceff4>></span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// é“¾è¡¨èŠ‚ç‚¹ç»“æ„</span></span>
<span class=giallo-l><span style=color:#81a1c1>typedef struct</span><span> list_node </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> val</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    struct</span><span> list_node </span><span style=color:#81a1c1>*</span><span>next</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span><span> list</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// åˆ›å»ºé“¾è¡¨</span></span>
<span class=giallo-l><span>list</span><span style=color:#81a1c1>*</span><span style=color:#88c0d0> create_list</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>size_t</span><span> size</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    if</span><span style=color:#eceff4> (</span><span>size </span><span style=color:#81a1c1>==</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> return NULL;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    list </span><span style=color:#81a1c1>*</span><span>head </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>sizeof</span><span style=color:#eceff4>(</span><span>list</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>    list </span><span style=color:#81a1c1>*</span><span>current </span><span style=color:#81a1c1>=</span><span> head</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>    head</span><span style=color:#81a1c1>-></span><span>val</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> rand</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> %</span><span style=color:#b48ead> 1000</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>size_t</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 1</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> size</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>        current</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>sizeof</span><span style=color:#eceff4>(</span><span>list</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        current </span><span style=color:#81a1c1>=</span><span> current</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        current</span><span style=color:#81a1c1>-></span><span>val</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> rand</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> %</span><span style=color:#b48ead> 1000</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span>    current</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1> = NULL;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    return</span><span> head</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// é‡Šæ”¾é“¾è¡¨</span></span>
<span class=giallo-l><span style=color:#81a1c1>void</span><span style=color:#88c0d0> free_list</span><span style=color:#eceff4>(</span><span>list </span><span style=color:#81a1c1>*</span><span>head</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    while</span><span style=color:#eceff4> (</span><span>head</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>        list </span><span style=color:#81a1c1>*</span><span>temp </span><span style=color:#81a1c1>=</span><span> head</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        head </span><span style=color:#81a1c1>=</span><span> head</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>        free</span><span style=color:#eceff4>(</span><span>temp</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// é¡ºåºéå†æ±‚å’Œï¼ˆåŸå§‹æ–¹æ³•ï¼‰</span></span>
<span class=giallo-l><span style=color:#81a1c1>unsigned long</span><span style=color:#88c0d0> sequential_sum</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>size_t</span><span> arr_size</span><span style=color:#eceff4>,</span><span> list </span><span style=color:#81a1c1>**</span><span>la</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>    list </span><span style=color:#81a1c1>*</span><span>lp</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> res </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> arr_size</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>        lp </span><span style=color:#81a1c1>=</span><span> la</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        while</span><span style=color:#eceff4> (</span><span>lp</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>            res </span><span style=color:#81a1c1>+=</span><span> lp</span><span style=color:#81a1c1>-></span><span>val</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>            lp </span><span style=color:#81a1c1>=</span><span> lp</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#81a1c1>    return</span><span> res</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// äº¤é”™éå†æ±‚å’Œï¼ˆä¼˜åŒ–æ–¹æ³•ï¼‰</span></span>
<span class=giallo-l><span style=color:#81a1c1>unsigned long</span><span style=color:#88c0d0> interleaved_sum</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>size_t</span><span> arr_size</span><span style=color:#eceff4>,</span><span> list </span><span style=color:#81a1c1>**</span><span>la</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>    list </span><span style=color:#81a1c1>**</span><span>lthreads </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span>arr_size </span><span style=color:#81a1c1>* sizeof</span><span style=color:#eceff4>(</span><span>list </span><span style=color:#81a1c1>*</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> res </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    int</span><span> n </span><span style=color:#81a1c1>=</span><span> arr_size</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // åˆå§‹åŒ–æ‰€æœ‰é“¾è¡¨çš„éå†æŒ‡é’ˆ</span></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> arr_size</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>        lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> =</span><span> la</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> == NULL</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span>            n</span><span style=color:#81a1c1>--;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // äº¤é”™éå†æ‰€æœ‰é“¾è¡¨</span></span>
<span class=giallo-l><span style=color:#81a1c1>    while</span><span style=color:#eceff4>(</span><span>n</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> arr_size</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> == NULL</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>                continue;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>            res </span><span style=color:#81a1c1>+=</span><span> lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>-></span><span>val</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>            lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> =</span><span> lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> == NULL</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span>                n</span><span style=color:#81a1c1>--;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>    free</span><span style=color:#eceff4>(</span><span>lthreads</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    return</span><span> res</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// å¸¦é¢„å–æŒ‡ä»¤çš„äº¤é”™éå†æ±‚å’Œï¼ˆè¿›ä¸€æ­¥ä¼˜åŒ–ï¼‰</span></span>
<span class=giallo-l><span style=color:#81a1c1>unsigned long</span><span style=color:#88c0d0> interleaved_sum_with_prefetch</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>size_t</span><span> arr_size</span><span style=color:#eceff4>,</span><span> list </span><span style=color:#81a1c1>**</span><span>la</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>    list </span><span style=color:#81a1c1>**</span><span>lthreads </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span>arr_size </span><span style=color:#81a1c1>* sizeof</span><span style=color:#eceff4>(</span><span>list </span><span style=color:#81a1c1>*</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> res </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    int</span><span> n </span><span style=color:#81a1c1>=</span><span> arr_size</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // åˆå§‹åŒ–æ‰€æœ‰é“¾è¡¨çš„éå†æŒ‡é’ˆ</span></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> arr_size</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>        lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> =</span><span> la</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> == NULL</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span>            n</span><span style=color:#81a1c1>--;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // äº¤é”™éå†æ‰€æœ‰é“¾è¡¨ï¼Œä½¿ç”¨é¢„å–æŒ‡ä»¤</span></span>
<span class=giallo-l><span style=color:#81a1c1>    while</span><span style=color:#eceff4>(</span><span>n</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> arr_size</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> == NULL</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>                continue;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>            res </span><span style=color:#81a1c1>+=</span><span> lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>-></span><span>val</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>            lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> =</span><span> lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]) {</span></span>
<span class=giallo-l><span style=color:#616e88>                // é¢„å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åˆ°ç¼“å­˜</span></span>
<span class=giallo-l><span style=color:#88c0d0>                __builtin_prefetch</span><span style=color:#eceff4>(</span><span>lthreads</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>],</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>                n</span><span style=color:#81a1c1>--;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>    free</span><span style=color:#eceff4>(</span><span>lthreads</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    return</span><span> res</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// è·å–å½“å‰æ—¶é—´ï¼ˆå¾®ç§’ï¼‰</span></span>
<span class=giallo-l><span style=color:#81a1c1>long long</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    struct</span><span> timeval tv</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    gettimeofday</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>tv</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> NULL</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    return</span><span> tv</span><span style=color:#eceff4>.</span><span>tv_sec</span><span style=color:#81a1c1> *</span><span style=color:#b48ead> 1000000</span><span style=color:#81a1c1>LL +</span><span> tv</span><span style=color:#eceff4>.</span><span>tv_usec</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// å“ˆå¸Œè¡¨ç›¸å…³ç»“æ„å’Œå‡½æ•°ï¼ˆæ¨¡æ‹ŸValkeyçš„å­—å…¸æŸ¥æ‰¾ä¼˜åŒ–ï¼‰</span></span>
<span class=giallo-l><span style=color:#5e81ac;font-weight:700>#</span><span style=color:#81a1c1>define</span><span style=color:#88c0d0> HASH_SIZE</span><span style=color:#b48ead> 1000003</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>typedef struct</span><span> hash_entry </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#81a1c1>    char *</span><span>key</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> value</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    struct</span><span> hash_entry </span><span style=color:#81a1c1>*</span><span>next</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span><span> hash_entry</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>typedef struct</span><span> hash_table </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span>    hash_entry </span><span style=color:#81a1c1>**</span><span>buckets</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    size_t</span><span> size</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span><span> hash_table</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// ç®€å•å“ˆå¸Œå‡½æ•°</span></span>
<span class=giallo-l><span style=color:#81a1c1>unsigned long</span><span style=color:#88c0d0> hash_func</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>const char *</span><span>key</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> hash </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 5381</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    int</span><span> c</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    while</span><span style=color:#eceff4> ((</span><span>c </span><span style=color:#81a1c1>= *</span><span>key</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>))</span></span>
<span class=giallo-l><span>        hash </span><span style=color:#81a1c1>=</span><span style=color:#eceff4> ((</span><span>hash </span><span style=color:#81a1c1>&lt;&lt;</span><span style=color:#b48ead> 5</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> +</span><span> hash</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> +</span><span> c</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    return</span><span> hash </span><span style=color:#81a1c1>%</span><span> HASH_SIZE</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// åˆ›å»ºå“ˆå¸Œè¡¨</span></span>
<span class=giallo-l><span>hash_table</span><span style=color:#81a1c1>*</span><span style=color:#88c0d0> create_hash_table</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span>    hash_table </span><span style=color:#81a1c1>*</span><span>ht </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>sizeof</span><span style=color:#eceff4>(</span><span>hash_table</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>    ht</span><span style=color:#81a1c1>-></span><span>size</span><span style=color:#81a1c1> =</span><span> HASH_SIZE</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>    ht</span><span style=color:#81a1c1>-></span><span>buckets</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> calloc</span><span style=color:#eceff4>(</span><span>HASH_SIZE</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> sizeof</span><span style=color:#eceff4>(</span><span>hash_entry</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    return</span><span> ht</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// æ’å…¥é”®å€¼å¯¹</span></span>
<span class=giallo-l><span style=color:#81a1c1>void</span><span style=color:#88c0d0> hash_insert</span><span style=color:#eceff4>(</span><span>hash_table </span><span style=color:#81a1c1>*</span><span>ht</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> const char *</span><span>key</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> unsigned long</span><span> value</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> index </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> hash_func</span><span style=color:#eceff4>(</span><span>key</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>    hash_entry </span><span style=color:#81a1c1>*</span><span>entry </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>sizeof</span><span style=color:#eceff4>(</span><span>hash_entry</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>    entry</span><span style=color:#81a1c1>-></span><span>key</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> strdup</span><span style=color:#eceff4>(</span><span>key</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>    entry</span><span style=color:#81a1c1>-></span><span>value</span><span style=color:#81a1c1> =</span><span> value</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>    entry</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1> =</span><span> ht</span><span style=color:#81a1c1>-></span><span>buckets</span><span style=color:#eceff4>[</span><span>index</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>    ht</span><span style=color:#81a1c1>-></span><span>buckets</span><span style=color:#eceff4>[</span><span>index</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> =</span><span> entry</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// é¡ºåºæŸ¥æ‰¾å¤šä¸ªé”®</span></span>
<span class=giallo-l><span style=color:#81a1c1>unsigned long</span><span style=color:#88c0d0> sequential_lookup</span><span style=color:#eceff4>(</span><span>hash_table </span><span style=color:#81a1c1>*</span><span>ht</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> char **</span><span>keys</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> size_t</span><span> num_keys</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> total </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>size_t</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> num_keys</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        unsigned long</span><span> index </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> hash_func</span><span style=color:#eceff4>(</span><span>keys</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>])</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        hash_entry </span><span style=color:#81a1c1>*</span><span>entry </span><span style=color:#81a1c1>=</span><span> ht</span><span style=color:#81a1c1>-></span><span>buckets</span><span style=color:#eceff4>[</span><span>index</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        while</span><span style=color:#eceff4> (</span><span>entry</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span style=color:#88c0d0>strcmp</span><span style=color:#eceff4>(</span><span>entry</span><span style=color:#81a1c1>-></span><span>key</span><span style=color:#eceff4>,</span><span> keys</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>])</span><span style=color:#81a1c1> ==</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>                total </span><span style=color:#81a1c1>+=</span><span> entry</span><span style=color:#81a1c1>-></span><span>value</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>                break;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span>            entry </span><span style=color:#81a1c1>=</span><span> entry</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    return</span><span> total</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// é¢„å–ä¼˜åŒ–çš„æ‰¹é‡æŸ¥æ‰¾</span></span>
<span class=giallo-l><span style=color:#81a1c1>unsigned long</span><span style=color:#88c0d0> prefetch_lookup</span><span style=color:#eceff4>(</span><span>hash_table </span><span style=color:#81a1c1>*</span><span>ht</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> char **</span><span>keys</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> size_t</span><span> num_keys</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> total </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>    hash_entry </span><span style=color:#81a1c1>**</span><span>entries </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span>num_keys </span><span style=color:#81a1c1>* sizeof</span><span style=color:#eceff4>(</span><span>hash_entry</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long *</span><span>indices </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span>num_keys </span><span style=color:#81a1c1>* sizeof</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>unsigned long</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // ç¬¬ä¸€é˜¶æ®µï¼šè®¡ç®—æ‰€æœ‰ç´¢å¼•å¹¶é¢„å–</span></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>size_t</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> num_keys</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>        indices</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> hash_func</span><span style=color:#eceff4>(</span><span>keys</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>])</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> =</span><span> ht</span><span style=color:#81a1c1>-></span><span>buckets</span><span style=color:#eceff4>[</span><span>indices</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]]</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]) {</span></span>
<span class=giallo-l><span style=color:#88c0d0>            __builtin_prefetch</span><span style=color:#eceff4>(</span><span>entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>],</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // ç¬¬äºŒé˜¶æ®µï¼šäº¤é”™æŸ¥æ‰¾</span></span>
<span class=giallo-l><span style=color:#81a1c1>    int</span><span> remaining </span><span style=color:#81a1c1>=</span><span> num_keys</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    while</span><span style=color:#eceff4> (</span><span>remaining </span><span style=color:#81a1c1>></span><span style=color:#b48ead> 0</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>size_t</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> num_keys</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> == NULL</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> continue;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span style=color:#88c0d0>strcmp</span><span style=color:#eceff4>(</span><span>entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>-></span><span>key</span><span style=color:#eceff4>,</span><span> keys</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>])</span><span style=color:#81a1c1> ==</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>                total </span><span style=color:#81a1c1>+=</span><span> entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>-></span><span>value</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>                entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> = NULL;</span><span style=color:#616e88>  // æ ‡è®°ä¸ºå·²æ‰¾åˆ°</span></span>
<span class=giallo-l><span>                remaining</span><span style=color:#81a1c1>--;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>                entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> =</span><span> entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>                if</span><span style=color:#eceff4> (</span><span>entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> == NULL</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>                    remaining</span><span style=color:#81a1c1>--;</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>                    __builtin_prefetch</span><span style=color:#eceff4>(</span><span>entries</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>],</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>    free</span><span style=color:#eceff4>(</span><span>entries</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    free</span><span style=color:#eceff4>(</span><span>indices</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    return</span><span> total</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// é‡Šæ”¾å“ˆå¸Œè¡¨</span></span>
<span class=giallo-l><span style=color:#81a1c1>void</span><span style=color:#88c0d0> free_hash_table</span><span style=color:#eceff4>(</span><span>hash_table </span><span style=color:#81a1c1>*</span><span>ht</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>size_t</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> ht</span><span style=color:#81a1c1>-></span><span>size</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>        hash_entry </span><span style=color:#81a1c1>*</span><span>entry </span><span style=color:#81a1c1>=</span><span> ht</span><span style=color:#81a1c1>-></span><span>buckets</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        while</span><span style=color:#eceff4> (</span><span>entry</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>            hash_entry </span><span style=color:#81a1c1>*</span><span>temp </span><span style=color:#81a1c1>=</span><span> entry</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>            entry </span><span style=color:#81a1c1>=</span><span> entry</span><span style=color:#81a1c1>-></span><span>next</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>            free</span><span style=color:#eceff4>(</span><span>temp</span><span style=color:#81a1c1>-></span><span>key</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>            free</span><span style=color:#eceff4>(</span><span>temp</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#88c0d0>    free</span><span style=color:#eceff4>(</span><span>ht</span><span style=color:#81a1c1>-></span><span>buckets</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    free</span><span style=color:#eceff4>(</span><span>ht</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>int</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>=== Valkeyæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯éªŒè¯ç¨‹åº ===</span><span style=color:#ebcb8b>\n\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // æµ‹è¯•1ï¼šé“¾è¡¨éå†ä¼˜åŒ–éªŒè¯</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>1. é“¾è¡¨éå†ä¼˜åŒ–æµ‹è¯•</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>åˆ›å»ºæµ‹è¯•æ•°æ®...</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    const size_t</span><span> num_lists </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 16</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    const size_t</span><span> list_size </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 1000000</span><span style=color:#81a1c1>;</span><span style=color:#616e88>  // ä¸ºäº†å¿«é€Ÿæµ‹è¯•ï¼Œä½¿ç”¨100ä¸‡è€Œé1000ä¸‡</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    list </span><span style=color:#81a1c1>**</span><span>lists </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span>num_lists </span><span style=color:#81a1c1>* sizeof</span><span style=color:#eceff4>(</span><span>list</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // åˆ›å»ºæµ‹è¯•é“¾è¡¨</span></span>
<span class=giallo-l><span style=color:#88c0d0>    srand</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>time</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>NULL</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>size_t</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> num_lists</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>        lists</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> create_list</span><span style=color:#eceff4>(</span><span>list_size</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆï¼š%zuä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªåŒ…å«%zuä¸ªèŠ‚ç‚¹</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>",</span><span> num_lists</span><span style=color:#eceff4>,</span><span> list_size</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // æµ‹è¯•é¡ºåºéå†</span></span>
<span class=giallo-l><span style=color:#81a1c1>    long long</span><span> start_time </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> result1 </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> sequential_sum</span><span style=color:#eceff4>(</span><span>num_lists</span><span style=color:#eceff4>,</span><span> lists</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    long long</span><span> sequential_time </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -</span><span> start_time</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // æµ‹è¯•äº¤é”™éå†</span></span>
<span class=giallo-l><span>    start_time </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> result2 </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> interleaved_sum</span><span style=color:#eceff4>(</span><span>num_lists</span><span style=color:#eceff4>,</span><span> lists</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    long long</span><span> interleaved_time </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -</span><span> start_time</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // æµ‹è¯•å¸¦é¢„å–çš„äº¤é”™éå†</span></span>
<span class=giallo-l><span>    start_time </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> result3 </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> interleaved_sum_with_prefetch</span><span style=color:#eceff4>(</span><span>num_lists</span><span style=color:#eceff4>,</span><span> lists</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    long long</span><span> prefetch_time </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -</span><span> start_time</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>\n</span><span style=color:#a3be8c>é“¾è¡¨éå†æµ‹è¯•ç»“æœï¼š</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>é¡ºåºéå†ï¼š      %lld å¾®ç§’ï¼Œç»“æœï¼š%lu</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>",</span><span> sequential_time</span><span style=color:#eceff4>,</span><span> result1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>äº¤é”™éå†ï¼š      %lld å¾®ç§’ï¼Œç»“æœï¼š%lu (æå‡ï¼š%.2fx)</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>",</span><span> </span></span>
<span class=giallo-l><span>           interleaved_time</span><span style=color:#eceff4>,</span><span> result2</span><span style=color:#eceff4>, (</span><span style=color:#81a1c1>double</span><span style=color:#eceff4>)</span><span>sequential_time </span><span style=color:#81a1c1>/</span><span> interleaved_time</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>é¢„å–+äº¤é”™éå†ï¼š %lld å¾®ç§’ï¼Œç»“æœï¼š%lu (æå‡ï¼š%.2fx)</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>",</span><span> </span></span>
<span class=giallo-l><span>           prefetch_time</span><span style=color:#eceff4>,</span><span> result3</span><span style=color:#eceff4>, (</span><span style=color:#81a1c1>double</span><span style=color:#eceff4>)</span><span>sequential_time </span><span style=color:#81a1c1>/</span><span> prefetch_time</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // éªŒè¯ç»“æœæ­£ç¡®æ€§</span></span>
<span class=giallo-l><span style=color:#81a1c1>    if</span><span style=color:#eceff4> (</span><span>result1 </span><span style=color:#81a1c1>==</span><span> result2 </span><span style=color:#81a1c1>&&</span><span> result2 </span><span style=color:#81a1c1>==</span><span> result3</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#88c0d0>        printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>âœ“ æ‰€æœ‰ç®—æ³•ç»“æœä¸€è‡´ï¼ŒéªŒè¯é€šè¿‡</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>        printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>âœ— ç»“æœä¸ä¸€è‡´ï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // æ¸…ç†é“¾è¡¨</span></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>size_t</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> num_lists</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#88c0d0>        free_list</span><span style=color:#eceff4>(</span><span>lists</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>])</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#88c0d0>    free</span><span style=color:#eceff4>(</span><span>lists</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // æµ‹è¯•2ï¼šå“ˆå¸Œè¡¨æŸ¥æ‰¾ä¼˜åŒ–éªŒè¯</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>\n</span><span style=color:#a3be8c>2. å“ˆå¸Œè¡¨æŸ¥æ‰¾ä¼˜åŒ–æµ‹è¯•ï¼ˆæ¨¡æ‹ŸValkeyå­—å…¸æŸ¥æ‰¾ï¼‰</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    hash_table </span><span style=color:#81a1c1>*</span><span>ht </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> create_hash_table</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    const size_t</span><span> num_test_keys </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 100000</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    const size_t</span><span> lookup_batch_size </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 1000</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // æ’å…¥æµ‹è¯•æ•°æ®</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>æ’å…¥ %zu ä¸ªé”®å€¼å¯¹...</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>",</span><span> num_test_keys</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>size_t</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> num_test_keys</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        char</span><span> key</span><span style=color:#eceff4>[</span><span style=color:#b48ead>32</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>        snprintf</span><span style=color:#eceff4>(</span><span>key</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> sizeof</span><span style=color:#eceff4>(</span><span>key</span><span style=color:#eceff4>), "</span><span style=color:#a3be8c>key_%zu</span><span style=color:#eceff4>",</span><span> i</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>        hash_insert</span><span style=color:#eceff4>(</span><span>ht</span><span style=color:#eceff4>,</span><span> key</span><span style=color:#eceff4>,</span><span> i </span><span style=color:#81a1c1>*</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // å‡†å¤‡æŸ¥æ‰¾çš„é”®</span></span>
<span class=giallo-l><span style=color:#81a1c1>    char **</span><span>lookup_keys </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span>lookup_batch_size </span><span style=color:#81a1c1>* sizeof</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>char*</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>size_t</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> lookup_batch_size</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span>        lookup_keys</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> malloc</span><span style=color:#eceff4>(</span><span style=color:#b48ead>32</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>        snprintf</span><span style=color:#eceff4>(</span><span>lookup_keys</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>],</span><span style=color:#b48ead> 32</span><span style=color:#eceff4>, "</span><span style=color:#a3be8c>key_%zu</span><span style=color:#eceff4>",</span><span style=color:#88c0d0> rand</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> %</span><span> num_test_keys</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // æµ‹è¯•é¡ºåºæŸ¥æ‰¾</span></span>
<span class=giallo-l><span>    start_time </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> hash_result1 </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> sequential_lookup</span><span style=color:#eceff4>(</span><span>ht</span><span style=color:#eceff4>,</span><span> lookup_keys</span><span style=color:#eceff4>,</span><span> lookup_batch_size</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    long long</span><span> hash_sequential_time </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -</span><span> start_time</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // æµ‹è¯•é¢„å–ä¼˜åŒ–æŸ¥æ‰¾</span></span>
<span class=giallo-l><span>    start_time </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    unsigned long</span><span> hash_result2 </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> prefetch_lookup</span><span style=color:#eceff4>(</span><span>ht</span><span style=color:#eceff4>,</span><span> lookup_keys</span><span style=color:#eceff4>,</span><span> lookup_batch_size</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    long long</span><span> hash_prefetch_time </span><span style=color:#81a1c1>=</span><span style=color:#88c0d0> get_time_us</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -</span><span> start_time</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>\n</span><span style=color:#a3be8c>å“ˆå¸Œè¡¨æŸ¥æ‰¾æµ‹è¯•ç»“æœï¼š</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>é¡ºåºæŸ¥æ‰¾ï¼š    %lld å¾®ç§’ï¼Œç»“æœï¼š%lu</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>",</span><span> hash_sequential_time</span><span style=color:#eceff4>,</span><span> hash_result1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>é¢„å–ä¼˜åŒ–æŸ¥æ‰¾ï¼š%lld å¾®ç§’ï¼Œç»“æœï¼š%lu (æå‡ï¼š%.2fx)</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>",</span><span> </span></span>
<span class=giallo-l><span>           hash_prefetch_time</span><span style=color:#eceff4>,</span><span> hash_result2</span><span style=color:#eceff4>, (</span><span style=color:#81a1c1>double</span><span style=color:#eceff4>)</span><span>hash_sequential_time </span><span style=color:#81a1c1>/</span><span> hash_prefetch_time</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    if</span><span style=color:#eceff4> (</span><span>hash_result1 </span><span style=color:#81a1c1>==</span><span> hash_result2</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#88c0d0>        printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>âœ“ å“ˆå¸Œè¡¨æŸ¥æ‰¾ç»“æœä¸€è‡´ï¼ŒéªŒè¯é€šè¿‡</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>        printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>âœ— å“ˆå¸Œè¡¨æŸ¥æ‰¾ç»“æœä¸ä¸€è‡´</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // æ¸…ç†èµ„æº</span></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>size_t</span><span> i </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> lookup_batch_size</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#88c0d0>        free</span><span style=color:#eceff4>(</span><span>lookup_keys</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>])</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#88c0d0>    free</span><span style=color:#eceff4>(</span><span>lookup_keys</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    free_hash_table</span><span style=color:#eceff4>(</span><span>ht</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>\n</span><span style=color:#a3be8c>=== æ€»ç»“ ===</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>1. é“¾è¡¨äº¤é”™éå†ç›¸æ¯”é¡ºåºéå†å¯ä»¥è·å¾—æ˜¾è‘—æ€§èƒ½æå‡</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>2. é¢„å–æŒ‡ä»¤å¯ä»¥è¿›ä¸€æ­¥æå‡æ€§èƒ½</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>3. è¿™äº›ä¼˜åŒ–æŠ€æœ¯é€šè¿‡æ”¹å–„å†…å­˜è®¿é—®æ¨¡å¼ï¼Œå‡å°‘CPUç­‰å¾…æ—¶é—´</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>4. Valkeyé€šè¿‡ç±»ä¼¼æŠ€æœ¯åœ¨lookupKeyå‡½æ•°ä¸­è·å¾—äº†80%%ä»¥ä¸Šçš„æ€§èƒ½æå‡</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>    printf</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>5. ç»“åˆI/Oå¤šçº¿ç¨‹ï¼ŒValkey 8.0å®ç°äº†ä»360Kåˆ°1.19M RPSçš„æ€§èƒ½é£è·ƒ</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    return</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>æˆ‘è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªMakefileæ¥å¸®åŠ©ç¼–è¯‘å’Œè¿è¡Œè¿™ä¸ªå®éªŒç¨‹åºï¼š<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=make><span class=giallo-l><span>CC</span><span style=color:#eceff4> =</span><span> gcc</span></span>
<span class=giallo-l><span>CFLAGS</span><span style=color:#eceff4> =</span><span> -O2 -Wall -Wextra -std=c99</span></span>
<span class=giallo-l><span>TARGET</span><span style=color:#eceff4> =</span><span> valkey_test</span></span>
<span class=giallo-l><span>SOURCE</span><span style=color:#eceff4> =</span><span> valkey_optimization_test.c</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88># é»˜è®¤ç›®æ ‡</span></span>
<span class=giallo-l><span style=color:#88c0d0>all</span><span style=color:#eceff4>:</span><span style=color:#81a1c1> $(</span><span>TARGET</span><span style=color:#81a1c1>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88># ç¼–è¯‘ç›®æ ‡</span></span>
<span class=giallo-l><span style=color:#81a1c1>$(</span><span>TARGET</span><span style=color:#81a1c1>)</span><span>: </span><span style=color:#81a1c1>$(</span><span>SOURCE</span><span style=color:#81a1c1>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>    $(</span><span>CC</span><span style=color:#81a1c1>) $(</span><span>CFLAGS</span><span style=color:#81a1c1>)</span><span> -o </span><span style=color:#81a1c1>$(</span><span>TARGET</span><span style=color:#81a1c1>) $(</span><span>SOURCE</span><span style=color:#81a1c1>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88># è¿è¡Œæµ‹è¯•</span></span>
<span class=giallo-l><span style=color:#88c0d0>run</span><span style=color:#eceff4>:</span><span style=color:#81a1c1> $(</span><span>TARGET</span><span style=color:#81a1c1>)</span></span>
<span class=giallo-l><span>    ./</span><span style=color:#81a1c1>$(</span><span>TARGET</span><span style=color:#81a1c1>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88># ä¼˜åŒ–ç¼–è¯‘ï¼ˆå¯ç”¨æ›´å¤šä¼˜åŒ–ï¼‰</span></span>
<span class=giallo-l><span style=color:#88c0d0>optimized</span><span style=color:#eceff4>:</span><span> </span></span>
<span class=giallo-l><span style=color:#81a1c1>    $(</span><span>CC</span><span style=color:#81a1c1>)</span><span> -O3 -march=native -mtune=native -Wall -Wextra -std=c99 -o </span><span style=color:#81a1c1>$(</span><span>TARGET</span><span style=color:#81a1c1>) $(</span><span>SOURCE</span><span style=color:#81a1c1>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88># è°ƒè¯•ç¼–è¯‘</span></span>
<span class=giallo-l><span style=color:#88c0d0>debug</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#81a1c1>    $(</span><span>CC</span><span style=color:#81a1c1>)</span><span> -g -O0 -Wall -Wextra -std=c99 -o </span><span style=color:#81a1c1>$(</span><span>TARGET</span><span style=color:#81a1c1>) $(</span><span>SOURCE</span><span style=color:#81a1c1>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88># æ¸…ç†</span></span>
<span class=giallo-l><span style=color:#88c0d0>clean</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span>    rm -f </span><span style=color:#81a1c1>$(</span><span>TARGET</span><span style=color:#81a1c1>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88># æ˜¾ç¤ºå¸®åŠ©</span></span>
<span class=giallo-l><span style=color:#88c0d0>help</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span>    @echo "å¯ç”¨ç›®æ ‡ï¼š"</span></span>
<span class=giallo-l><span>    @echo "  all       - ç¼–è¯‘ç¨‹åºï¼ˆé»˜è®¤ï¼‰"</span></span>
<span class=giallo-l><span>    @echo "  run       - ç¼–è¯‘å¹¶è¿è¡Œç¨‹åº"</span></span>
<span class=giallo-l><span>    @echo "  optimized - ä½¿ç”¨æœ€é«˜ä¼˜åŒ–çº§åˆ«ç¼–è¯‘"</span></span>
<span class=giallo-l><span>    @echo "  debug     - ç¼–è¯‘è°ƒè¯•ç‰ˆæœ¬"</span></span>
<span class=giallo-l><span>    @echo "  clean     - æ¸…ç†ç¼–è¯‘äº§ç‰©"</span></span>
<span class=giallo-l><span>    @echo "  help      - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"</span></span>
<span class=giallo-l><span>    @echo ""</span></span>
<span class=giallo-l><span>    @echo "ä½¿ç”¨ç¤ºä¾‹ï¼š"</span></span>
<span class=giallo-l><span>    @echo "  make run          </span><span style=color:#616e88># ç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•"</span></span>
<span class=giallo-l><span>    @echo "  make optimized    </span><span style=color:#616e88># é«˜ä¼˜åŒ–ç¼–è¯‘"</span></span>
<span class=giallo-l><span>    @echo "  make clean        </span><span style=color:#616e88># æ¸…ç†æ–‡ä»¶"</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>.PHONY</span><span style=color:#eceff4>:</span><span> all run optimized debug clean help</span></span></code></pre><h2 id=zong-jie>æ€»ç»“</h2><p>æˆ‘å·²ç»å®Œæˆäº†å¯¹ä¸¤ç¯‡Valkeyåšå®¢æ–‡ç« çš„åˆ†æå’Œå®éªŒç¨‹åºçš„ç¼–å†™ã€‚ä»¥ä¸‹æ˜¯ä¸»è¦å†…å®¹ï¼š<h3 id=wen-zhang-he-xin-ji-shu-yao-dian>æ–‡ç« æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹ï¼š</h3><ol><li><p><strong>I/Oå¤šçº¿ç¨‹ä¼˜åŒ–</strong>ï¼š</p> <ul><li>å°†I/Oæ“ä½œä»ä¸»çº¿ç¨‹åˆ†ç¦»åˆ°ä¸“é—¨çš„I/Oçº¿ç¨‹<li>ååé‡æå‡230%ï¼ˆ360K â†’ 1.19M RPSï¼‰<li>å¹³å‡å»¶è¿Ÿé™ä½69.8%ï¼ˆ1.792ms â†’ 0.542msï¼‰</ul><li><p><strong>å†…å­˜è®¿é—®æ‘Šé”€ä¼˜åŒ–</strong>ï¼š</p> <ul><li>é€šè¿‡äº¤é”™æ‰§è¡Œå‡å°‘å†…å­˜è®¿é—®å»¶è¿Ÿ<li>lookupKeyå‡½æ•°æ€§èƒ½æå‡80%+<li>æ•´ä½“æ€§èƒ½å†æå‡50%</ul></ol><h3 id=shi-yan-cheng-xu-yan-zheng>å®éªŒç¨‹åºéªŒè¯ï¼š</h3><p>æˆ‘ç¼–å†™çš„Cè¯­è¨€ç¨‹åºåŒ…å«ä¸¤ä¸ªä¸»è¦æµ‹è¯•ï¼š<ol><li><p><strong>é“¾è¡¨éå†ä¼˜åŒ–æµ‹è¯•</strong>ï¼š</p> <ul><li>éªŒè¯é¡ºåºéå†vsäº¤é”™éå†çš„æ€§èƒ½å·®å¼‚<li>æµ‹è¯•é¢„å–æŒ‡ä»¤çš„é¢å¤–ä¼˜åŒ–æ•ˆæœ<li>æ¨¡æ‹Ÿæ–‡ç« ä¸­é“¾è¡¨ç¤ºä¾‹çš„10å€æ€§èƒ½æå‡</ul><li><p><strong>å“ˆå¸Œè¡¨æŸ¥æ‰¾ä¼˜åŒ–æµ‹è¯•</strong>ï¼š</p> <ul><li>æ¨¡æ‹ŸValkeyå­—å…¸æŸ¥æ‰¾çš„ä¼˜åŒ–åœºæ™¯<li>éªŒè¯é¢„å–å’Œæ‰¹é‡å¤„ç†çš„æ€§èƒ½æå‡<li>å¯¹åº”æ–‡ç« ä¸­lookupKeyå‡½æ•°çš„ä¼˜åŒ–</ul></ol><h3 id=shi-yong-fang-fa>ä½¿ç”¨æ–¹æ³•ï¼š</h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#616e88># ç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•</span></span>
<span class=giallo-l><span style=color:#88c0d0>make</span><span style=color:#a3be8c> run</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88># æˆ–è€…ä½¿ç”¨é«˜ä¼˜åŒ–ç¼–è¯‘</span></span>
<span class=giallo-l><span style=color:#88c0d0>make</span><span style=color:#a3be8c> optimized</span></span>
<span class=giallo-l><span style=color:#88c0d0>./valkey_test</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#a3be8c>=== Valkeyæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯éªŒè¯ç¨‹åº ===</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>1.</span><span style=color:#a3be8c> é“¾è¡¨éå†ä¼˜åŒ–æµ‹è¯•</span></span>
<span class=giallo-l><span style=color:#88c0d0>åˆ›å»ºæµ‹è¯•æ•°æ®...</span></span>
<span class=giallo-l><span style=color:#88c0d0>æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆï¼š16ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªåŒ…å«1000000ä¸ªèŠ‚ç‚¹</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>é“¾è¡¨éå†æµ‹è¯•ç»“æœï¼š</span></span>
<span class=giallo-l><span style=color:#88c0d0>é¡ºåºéå†ï¼š</span><span style=color:#b48ead>      91915</span><span style=color:#a3be8c> å¾®ç§’ï¼Œç»“æœï¼š7990951360</span></span>
<span class=giallo-l><span style=color:#88c0d0>äº¤é”™éå†ï¼š</span><span style=color:#b48ead>      57780</span><span style=color:#a3be8c> å¾®ç§’ï¼Œç»“æœï¼š7990951360</span><span> (æå‡ï¼š1.59x)</span></span>
<span class=giallo-l><span style=color:#88c0d0>é¢„å–+äº¤é”™éå†ï¼š</span><span style=color:#b48ead> 53289</span><span style=color:#a3be8c> å¾®ç§’ï¼Œç»“æœï¼š7990951360</span><span> (æå‡ï¼š1.72x)</span></span>
<span class=giallo-l><span style=color:#88c0d0>âœ“</span><span style=color:#a3be8c> æ‰€æœ‰ç®—æ³•ç»“æœä¸€è‡´ï¼ŒéªŒè¯é€šè¿‡</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>2.</span><span style=color:#a3be8c> å“ˆå¸Œè¡¨æŸ¥æ‰¾ä¼˜åŒ–æµ‹è¯•ï¼ˆæ¨¡æ‹ŸValkeyå­—å…¸æŸ¥æ‰¾ï¼‰</span></span>
<span class=giallo-l><span style=color:#88c0d0>æ’å…¥</span><span style=color:#b48ead> 100000</span><span style=color:#a3be8c> ä¸ªé”®å€¼å¯¹...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>å“ˆå¸Œè¡¨æŸ¥æ‰¾æµ‹è¯•ç»“æœï¼š</span></span>
<span class=giallo-l><span style=color:#88c0d0>é¡ºåºæŸ¥æ‰¾ï¼š</span><span style=color:#b48ead>    228</span><span style=color:#a3be8c> å¾®ç§’ï¼Œç»“æœï¼š97528762</span></span>
<span class=giallo-l><span style=color:#88c0d0>é¢„å–ä¼˜åŒ–æŸ¥æ‰¾ï¼š53</span><span style=color:#a3be8c> å¾®ç§’ï¼Œç»“æœï¼š97528762</span><span> (æå‡ï¼š4.30x)</span></span>
<span class=giallo-l><span style=color:#88c0d0>âœ“</span><span style=color:#a3be8c> å“ˆå¸Œè¡¨æŸ¥æ‰¾ç»“æœä¸€è‡´ï¼ŒéªŒè¯é€šè¿‡</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#a3be8c>=== æ€»ç»“ ===</span></span>
<span class=giallo-l><span style=color:#88c0d0>1.</span><span style=color:#a3be8c> é“¾è¡¨äº¤é”™éå†ç›¸æ¯”é¡ºåºéå†å¯ä»¥è·å¾—æ˜¾è‘—æ€§èƒ½æå‡</span></span>
<span class=giallo-l><span style=color:#88c0d0>2.</span><span style=color:#a3be8c> é¢„å–æŒ‡ä»¤å¯ä»¥è¿›ä¸€æ­¥æå‡æ€§èƒ½</span></span>
<span class=giallo-l><span style=color:#88c0d0>3.</span><span style=color:#a3be8c> è¿™äº›ä¼˜åŒ–æŠ€æœ¯é€šè¿‡æ”¹å–„å†…å­˜è®¿é—®æ¨¡å¼ï¼Œå‡å°‘CPUç­‰å¾…æ—¶é—´</span></span>
<span class=giallo-l><span style=color:#88c0d0>4.</span><span style=color:#a3be8c> Valkeyé€šè¿‡ç±»ä¼¼æŠ€æœ¯åœ¨lookupKeyå‡½æ•°ä¸­è·å¾—äº†80%ä»¥ä¸Šçš„æ€§èƒ½æå‡</span></span>
<span class=giallo-l><span style=color:#88c0d0>5.</span><span style=color:#a3be8c> ç»“åˆI/Oå¤šçº¿ç¨‹ï¼ŒValkey 8.0å®ç°äº†ä»360Kåˆ°1.19M RPSçš„æ€§èƒ½é£è·ƒ</span></span></code></pre><p>è¿™ä¸ªå®éªŒç¨‹åºèƒ½å¤ŸéªŒè¯Valkeyæ–‡ç« ä¸­æåˆ°çš„æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯ï¼Œå±•ç¤ºå†…å­˜è®¿é—®æ¨¡å¼ä¼˜åŒ–å¯¹æ€§èƒ½çš„å·¨å¤§å½±å“ã€‚é€šè¿‡äº¤é”™æ‰§è¡Œå’Œé¢„å–æŒ‡ä»¤ï¼Œå¯ä»¥æ˜¾è‘—æå‡å¤„ç†å¤§é‡éšæœºå†…å­˜è®¿é—®çš„æ€§èƒ½ï¼Œè¿™æ­£æ˜¯Valkeyå®ç°ç™¾ä¸‡çº§RPSçš„å…³é”®æŠ€æœ¯åŸºç¡€ã€‚</div></div></section>