<!doctype html><html class=scroll-smooth lang=en><head><meta charset=utf-8><link href=/css/style.css rel=stylesheet><link href=/line-awesome/css/line-awesome.min.css rel=stylesheet><script defer src=/js/main.js></script><title>Java Double List 去除突刺点（异常值）的方法 | Roc's Blog</title><body class="bg-white dark:bg-slate-900 transition ease-in-out"><section><div class="sticky top-0 bg-slate-100 dark:bg-slate-800"><div class="container mx-auto px-auto xl:px-0 w-full xl:w-1/2 flex place-content-between py-16 xl:py-8 font-sans text-6xl xl:text-2xl text-slate-900 dark:text-slate-300"><div class=flex><a class="m-0 p-0 text-slate-900 hover:text-slate-700 dark:text-slate-300 dark:hover:text-slate-200" href=/blog/> /blog </a></div><div class="flex gap-4"><div class="hidden cursor-pointer" id=back-to-top><i class="las la-level-up-alt"></i></div><a href=/><i class="las la-home"></i></a><div class=cursor-pointer id=darkmode-toggle><div class="hidden dark:inline"><i class="las la-sun"></i></div><div class="inline dark:hidden"><i class="las la-moon"></i></div></div></div></div></div><div class="container mx-auto w-full xl:w-1/2 mb-16"><div class="mt-4 font-serif text-slate-600 dark:text-slate-500 text-4xl xl:text-base">2025-11-12</div><h1 class="w-full xl:w-2/3 mt-4 mb-8 font-serif text-8xl xl:text-4xl text-slate-900 dark:text-slate-300">Java Double List 去除突刺点（异常值）的方法</h1><div class="mt-2 mb-6 flex flex-wrap gap-2"></div><div class="w-100 border-t mb-8 border-slate-300 dark:border-slate-700"></div><div class="prose dark:prose-invert prose-pre:rounded-none prose-headings:bg-amber-100 prose-headings:text-slate-800 dark:prose-headings:bg-indigo-900 prose-headings:font-normal dark:prose-headings:text-slate-300 prose-headings:p-2 prose-headings:w-max prose-headings:font-serif prose-2xl xl:prose-base"><p>本文面向需要在 Java 中对 <code>List&lt;Double></code> 数据做“去除突刺点（异常值）”的工程实践，给出 4 类常用方法（统计学、移动窗口、相邻点距离与多方法融合），并提供完整可运行的代码与 JUnit 测试示例，帮助你在不同业务场景下快速选择与落地。<p>注意：异常值并非总是“错误”。许多业务的“尖峰”有可能是合理的事件。本文更像一套工具箱，你需要结合业务知识合理使用与调参。<h2 id=1-ji-yu-tong-ji-xue-fang-fa-de-yi-chang-zhi-jian-ce>1. 基于统计学方法的异常值检测</h2><h3 id=z-score-fang-fa>Z-Score 方法</h3><ul><li>思想：计算全局均值 <code>μ</code> 与标准差 <code>σ</code>，当某点 <code>x</code> 满足 <code>| (x-μ) / σ | > k</code>（常用阈值 <code>k=3</code>）时，判为异常。<li>适用：近似正态分布、峰值显著偏离整体均值的场景。</ul><h3 id=iqr-si-fen-wei-ju-fang-fa>IQR (四分位距) 方法</h3><ul><li>思想：计算 Q1、Q3 与 IQR=<code>Q3-Q1</code>，当点落在 <code>[Q1 - α·IQR, Q3 + α·IQR]</code> 之外（常用 <code>α=1.5</code> 或 <code>3.0</code>）判为异常。<li>适用：偏态分布或存在重尾时较稳健（受极端值影响较小）。</ul><h2 id=2-ji-yu-yi-dong-chuang-kou-de-yi-chang-zhi-jian-ce>2. 基于移动窗口的异常值检测</h2><h3 id=hua-dong-chuang-kou-z-score>滑动窗口 Z-Score</h3><ul><li>思想：用邻域窗口的均值与标准差代替全局统计，适合非平稳或趋势性数据。</ul><h3 id=yi-dong-ping-jun-fa>移动平均法</h3><ul><li>思想：用窗口均值/中位数做局部“期望值”，当当前点偏离窗口均值超过一定阈值即判异常。<li>常见阈值：绝对差超过 <code>β·σ_window</code> 或超过固定常数 <code>δ</code>。</ul><h2 id=3-ji-yu-xiang-lin-dian-ju-chi-de-yi-chang-zhi-jian-ce>3. 基于相邻点距离的异常值检测</h2><ul><li>思想：突刺常表现为与相邻点差值显著增大。可用固定阈值或鲁棒阈值（如差值的 <code>MAD</code> 或四分位距）来判断。</ul><h2 id=4-zong-he-duo-chong-fang-fa-de-yi-chang-zhi-jian-ce>4. 综合多种方法的异常值检测</h2><ul><li>思想：多模型投票或加权融合。只有当多个方法一致判定为异常时才去除，可降低误杀风险。</ul><h2 id=5-wan-zheng-dai-ma-outlierdetectors-java-ke-zhi-jie-fu-zhi-shi-yong>5. 完整代码：OutlierDetectors.java（可直接复制使用）</h2><pre class=language-java data-lang=java style=color:#f8f8f2;background-color:#272822><code class=language-java data-lang=java><span style=color:#f92672>import </span><span style=color:#66d9ef;font-style:italic>java</span><span>.</span><span style=color:#66d9ef;font-style:italic>util</span><span>.</span><span style=color:#f92672>*</span><span>;
</span><span style=color:#f92672>import </span><span style=color:#66d9ef;font-style:italic>java</span><span>.</span><span style=color:#66d9ef;font-style:italic>util</span><span>.</span><span style=color:#66d9ef;font-style:italic>stream</span><span>.</span><span style=color:#f92672>*</span><span>;
</span><span>
</span><span style=color:#f92672>public final </span><span style=color:#66d9ef;font-style:italic>class </span><span style=color:#a6e22e;text-decoration:underline>OutlierDetectors </span><span>{
</span><span>
</span><span>    </span><span style=color:#f92672>private </span><span style=color:#a6e22e>OutlierDetectors</span><span>() {}
</span><span>
</span><span>    </span><span style=color:#75715e>// ===================== 公共工具与预处理 =====================
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#a6e22e>dropNullAndNaN</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>) {
</span><span>        </span><span style=color:#f92672>if </span><span>(data </span><span style=color:#f92672>== </span><span style=color:#ae81ff>null</span><span>) </span><span style=color:#f92672>return </span><span style=color:#66d9ef;font-style:italic>Collections</span><span>.emptyList();
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> cleaned </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>(data.size());
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>Double</span><span> d </span><span style=color:#f92672>:</span><span> data) {
</span><span>            </span><span style=color:#f92672>if </span><span>(d </span><span style=color:#f92672>!= </span><span style=color:#ae81ff>null </span><span style=color:#f92672>&& !</span><span>d.isNaN() </span><span style=color:#f92672>&& !</span><span>d.isInfinite()) {
</span><span>                cleaned.add(d);
</span><span>            }
</span><span>        }
</span><span>        </span><span style=color:#f92672>return</span><span> cleaned;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#a6e22e>mean</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>) {
</span><span>        </span><span style=color:#f92672>if </span><span>(data.isEmpty()) </span><span style=color:#f92672>return </span><span style=color:#ae81ff>0.0</span><span>;
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> s </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0.0</span><span>;
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>double</span><span> v </span><span style=color:#f92672>:</span><span> data) s </span><span style=color:#f92672>+=</span><span> v;
</span><span>        </span><span style=color:#f92672>return</span><span> s </span><span style=color:#f92672>/</span><span> data.size();
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// 样本标准差（n-1），窗口过小则回退为 0
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#a6e22e>sampleStd</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>int</span><span> n </span><span style=color:#f92672>=</span><span> data.size();
</span><span>        </span><span style=color:#f92672>if </span><span>(n </span><span style=color:#f92672>&lt;= </span><span style=color:#ae81ff>1</span><span>) </span><span style=color:#f92672>return </span><span style=color:#ae81ff>0.0</span><span>;
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> mu </span><span style=color:#f92672>= </span><span>mean(data);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> sumSq </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0.0</span><span>;
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>double</span><span> v </span><span style=color:#f92672>:</span><span> data) {
</span><span>            </span><span style=color:#66d9ef;font-style:italic>double</span><span> d </span><span style=color:#f92672>=</span><span> v </span><span style=color:#f92672>-</span><span> mu;
</span><span>            sumSq </span><span style=color:#f92672>+=</span><span> d </span><span style=color:#f92672>*</span><span> d;
</span><span>        }
</span><span>        </span><span style=color:#f92672>return </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.sqrt(sumSq </span><span style=color:#f92672>/ </span><span>(n </span><span style=color:#f92672>- </span><span style=color:#ae81ff>1</span><span>));
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#a6e22e>median</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>) {
</span><span>        </span><span style=color:#f92672>if </span><span>(data.isEmpty()) </span><span style=color:#f92672>return </span><span style=color:#ae81ff>0.0</span><span>;
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> sorted </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>(data);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>Collections</span><span>.sort(sorted);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>int</span><span> n </span><span style=color:#f92672>=</span><span> sorted.size();
</span><span>        </span><span style=color:#f92672>if </span><span>(n </span><span style=color:#f92672>% </span><span style=color:#ae81ff>2 </span><span style=color:#f92672>== </span><span style=color:#ae81ff>1</span><span>) </span><span style=color:#f92672>return</span><span> sorted.get(n </span><span style=color:#f92672>/ </span><span style=color:#ae81ff>2</span><span>);
</span><span>        </span><span style=color:#f92672>return </span><span>(sorted.get(n </span><span style=color:#f92672>/ </span><span style=color:#ae81ff>2 </span><span style=color:#f92672>- </span><span style=color:#ae81ff>1</span><span>) </span><span style=color:#f92672>+</span><span> sorted.get(n </span><span style=color:#f92672>/ </span><span style=color:#ae81ff>2</span><span>)) </span><span style=color:#f92672>/ </span><span style=color:#ae81ff>2.0</span><span>;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>double</span><span style=color:#f92672>[] </span><span style=color:#a6e22e>quartiles</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>) {
</span><span>        </span><span style=color:#75715e>// 简单实现，适用于一般场景；严谨场景可使用更精细的分位数算法
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> sorted </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>(data);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>Collections</span><span>.sort(sorted);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>int</span><span> n </span><span style=color:#f92672>=</span><span> sorted.size();
</span><span>        </span><span style=color:#f92672>if </span><span>(n </span><span style=color:#f92672>== </span><span style=color:#ae81ff>0</span><span>) </span><span style=color:#f92672>return new </span><span style=color:#66d9ef;font-style:italic>double</span><span>[]{</span><span style=color:#ae81ff>0</span><span>, </span><span style=color:#ae81ff>0</span><span>, </span><span style=color:#ae81ff>0</span><span>};
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> q2 </span><span style=color:#f92672>= </span><span>median(sorted);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> lower </span><span style=color:#f92672>=</span><span> sorted.subList(</span><span style=color:#ae81ff>0</span><span>, n </span><span style=color:#f92672>/ </span><span style=color:#ae81ff>2</span><span>);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> upper </span><span style=color:#f92672>=</span><span> sorted.subList((n </span><span style=color:#f92672>% </span><span style=color:#ae81ff>2 </span><span style=color:#f92672>== </span><span style=color:#ae81ff>0 </span><span style=color:#f92672>?</span><span> n </span><span style=color:#f92672>/ </span><span style=color:#ae81ff>2 </span><span style=color:#f92672>:</span><span> n </span><span style=color:#f92672>/ </span><span style=color:#ae81ff>2 </span><span style=color:#f92672>+ </span><span style=color:#ae81ff>1</span><span>), n);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> q1 </span><span style=color:#f92672>= </span><span>median(lower);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> q3 </span><span style=color:#f92672>= </span><span>median(upper);
</span><span>        </span><span style=color:#f92672>return new </span><span style=color:#66d9ef;font-style:italic>double</span><span>[]{q1, q2, q3};
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#a6e22e>mad</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> med </span><span style=color:#f92672>= </span><span>median(data);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> dev </span><span style=color:#f92672>=</span><span> data.stream().map(</span><span style=color:#fd971f;font-style:italic>v </span><span style=color:#66d9ef;font-style:italic>-> Math</span><span>.abs(v </span><span style=color:#f92672>-</span><span> med)).collect(</span><span style=color:#66d9ef;font-style:italic>Collectors</span><span>.toList());
</span><span>        </span><span style=color:#f92672>return </span><span>median(dev);
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// 根据掩码移除异常值
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#a6e22e>removeByMask</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> </span><span style=color:#fd971f;font-style:italic>isOutlier</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> out </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>(data.size());
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> data.size(); i</span><span style=color:#f92672>++</span><span>) {
</span><span>            </span><span style=color:#f92672>if </span><span>(</span><span style=color:#f92672>!</span><span>isOutlier.get(i)) out.add(data.get(i));
</span><span>        }
</span><span>        </span><span style=color:#f92672>return</span><span> out;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// ===================== 1) 统计学：Z-Score =====================
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> </span><span style=color:#a6e22e>detectByZScore</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#fd971f;font-style:italic>k</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> cleaned </span><span style=color:#f92672>= </span><span>dropNullAndNaN(data);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> mu </span><span style=color:#f92672>= </span><span>mean(cleaned);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> std </span><span style=color:#f92672>= </span><span>sampleStd(cleaned);
</span><span>        </span><span style=color:#f92672>if </span><span>(std </span><span style=color:#f92672>== </span><span style=color:#ae81ff>0.0</span><span>) {
</span><span>            </span><span style=color:#75715e>// 如果方差为 0，则所有值都相同；默认无异常
</span><span>            </span><span style=color:#f92672>return </span><span style=color:#66d9ef;font-style:italic>Collections</span><span>.nCopies(data.size(), </span><span style=color:#ae81ff>false</span><span>);
</span><span>        }
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> mask </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>(data.size());
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>Double</span><span> x </span><span style=color:#f92672>:</span><span> data) {
</span><span>            </span><span style=color:#66d9ef;font-style:italic>boolean</span><span> out </span><span style=color:#f92672>= </span><span>(x </span><span style=color:#f92672>== </span><span style=color:#ae81ff>null </span><span style=color:#f92672>||</span><span> x.isNaN() </span><span style=color:#f92672>||</span><span> x.isInfinite()) </span><span style=color:#f92672>? </span><span style=color:#ae81ff>true </span><span style=color:#f92672>: </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.abs((x </span><span style=color:#f92672>-</span><span> mu) </span><span style=color:#f92672>/</span><span> std) </span><span style=color:#f92672>></span><span> k;
</span><span>            mask.add(out);
</span><span>        }
</span><span>        </span><span style=color:#f92672>return</span><span> mask;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#a6e22e>removeByZScore</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#fd971f;font-style:italic>k</span><span>) {
</span><span>        </span><span style=color:#f92672>return </span><span>removeByMask(data, detectByZScore(data, k));
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// ===================== 1) 统计学：IQR =====================
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> </span><span style=color:#a6e22e>detectByIQR</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#fd971f;font-style:italic>alpha</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> cleaned </span><span style=color:#f92672>= </span><span>dropNullAndNaN(data);
</span><span>        </span><span style=color:#f92672>if </span><span>(cleaned.isEmpty()) </span><span style=color:#f92672>return </span><span style=color:#66d9ef;font-style:italic>Collections</span><span>.nCopies(data.size(), </span><span style=color:#ae81ff>false</span><span>);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span style=color:#f92672>[]</span><span> qs </span><span style=color:#f92672>= </span><span>quartiles(cleaned);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> q1 </span><span style=color:#f92672>=</span><span> qs[</span><span style=color:#ae81ff>0</span><span>], q3 </span><span style=color:#f92672>=</span><span> qs[</span><span style=color:#ae81ff>2</span><span>];
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> iqr </span><span style=color:#f92672>=</span><span> q3 </span><span style=color:#f92672>-</span><span> q1;
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> lo </span><span style=color:#f92672>=</span><span> q1 </span><span style=color:#f92672>-</span><span> alpha </span><span style=color:#f92672>*</span><span> iqr;
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> hi </span><span style=color:#f92672>=</span><span> q3 </span><span style=color:#f92672>+</span><span> alpha </span><span style=color:#f92672>*</span><span> iqr;
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> mask </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>(data.size());
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>Double</span><span> x </span><span style=color:#f92672>:</span><span> data) {
</span><span>            </span><span style=color:#66d9ef;font-style:italic>boolean</span><span> out </span><span style=color:#f92672>= </span><span>(x </span><span style=color:#f92672>== </span><span style=color:#ae81ff>null </span><span style=color:#f92672>||</span><span> x.isNaN() </span><span style=color:#f92672>||</span><span> x.isInfinite()) </span><span style=color:#f92672>? </span><span style=color:#ae81ff>true </span><span style=color:#f92672>: </span><span>(x </span><span style=color:#f92672>&lt;</span><span> lo </span><span style=color:#f92672>||</span><span> x </span><span style=color:#f92672>></span><span> hi);
</span><span>            mask.add(out);
</span><span>        }
</span><span>        </span><span style=color:#f92672>return</span><span> mask;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#a6e22e>removeByIQR</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#fd971f;font-style:italic>alpha</span><span>) {
</span><span>        </span><span style=color:#f92672>return </span><span>removeByMask(data, detectByIQR(data, alpha));
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// ===================== 2) 滑动窗口 Z-Score =====================
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> </span><span style=color:#a6e22e>detectBySlidingZScore</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>int </span><span style=color:#fd971f;font-style:italic>window</span><span>, </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#fd971f;font-style:italic>k</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>int</span><span> n </span><span style=color:#f92672>=</span><span> data.size();
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> mask </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>(</span><span style=color:#66d9ef;font-style:italic>Collections</span><span>.nCopies(n, </span><span style=color:#ae81ff>false</span><span>));
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> n; i</span><span style=color:#f92672>++</span><span>) {
</span><span>            </span><span style=color:#66d9ef;font-style:italic>int</span><span> start </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.max(</span><span style=color:#ae81ff>0</span><span>, i </span><span style=color:#f92672>-</span><span> window);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>int</span><span> end </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.min(n, i </span><span style=color:#f92672>+</span><span> window </span><span style=color:#f92672>+ </span><span style=color:#ae81ff>1</span><span>);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> neigh </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>();
</span><span>            </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> j </span><span style=color:#f92672>=</span><span> start; j </span><span style=color:#f92672>&lt;</span><span> end; j</span><span style=color:#f92672>++</span><span>) {
</span><span>                </span><span style=color:#66d9ef;font-style:italic>Double</span><span> v </span><span style=color:#f92672>=</span><span> data.get(j);
</span><span>                </span><span style=color:#f92672>if </span><span>(v </span><span style=color:#f92672>!= </span><span style=color:#ae81ff>null </span><span style=color:#f92672>&& !</span><span>v.isNaN() </span><span style=color:#f92672>&& !</span><span>v.isInfinite()) neigh.add(v);
</span><span>            }
</span><span>            </span><span style=color:#66d9ef;font-style:italic>double</span><span> mu </span><span style=color:#f92672>= </span><span>mean(neigh);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>double</span><span> std </span><span style=color:#f92672>= </span><span>sampleStd(neigh);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>Double</span><span> x </span><span style=color:#f92672>=</span><span> data.get(i);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>boolean</span><span> out </span><span style=color:#f92672>= </span><span>(x </span><span style=color:#f92672>== </span><span style=color:#ae81ff>null </span><span style=color:#f92672>||</span><span> x.isNaN() </span><span style=color:#f92672>||</span><span> x.isInfinite()) </span><span style=color:#f92672>? </span><span style=color:#ae81ff>true </span><span style=color:#f92672>: </span><span>(std </span><span style=color:#f92672>== </span><span style=color:#ae81ff>0.0 </span><span style=color:#f92672>? </span><span style=color:#ae81ff>false </span><span style=color:#f92672>: </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.abs((x </span><span style=color:#f92672>-</span><span> mu) </span><span style=color:#f92672>/</span><span> std) </span><span style=color:#f92672>></span><span> k);
</span><span>            mask.set(i, out);
</span><span>        }
</span><span>        </span><span style=color:#f92672>return</span><span> mask;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#a6e22e>removeBySlidingZScore</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>int </span><span style=color:#fd971f;font-style:italic>window</span><span>, </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#fd971f;font-style:italic>k</span><span>) {
</span><span>        </span><span style=color:#f92672>return </span><span>removeByMask(data, detectBySlidingZScore(data, window, k));
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// ===================== 2) 移动平均法 =====================
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> </span><span style=color:#a6e22e>detectByMovingAverage</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>int </span><span style=color:#fd971f;font-style:italic>window</span><span>, </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#fd971f;font-style:italic>beta</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>int</span><span> n </span><span style=color:#f92672>=</span><span> data.size();
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> mask </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>(</span><span style=color:#66d9ef;font-style:italic>Collections</span><span>.nCopies(n, </span><span style=color:#ae81ff>false</span><span>));
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> n; i</span><span style=color:#f92672>++</span><span>) {
</span><span>            </span><span style=color:#66d9ef;font-style:italic>int</span><span> start </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.max(</span><span style=color:#ae81ff>0</span><span>, i </span><span style=color:#f92672>-</span><span> window);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>int</span><span> end </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.min(n, i </span><span style=color:#f92672>+</span><span> window </span><span style=color:#f92672>+ </span><span style=color:#ae81ff>1</span><span>);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> neigh </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>();
</span><span>            </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> j </span><span style=color:#f92672>=</span><span> start; j </span><span style=color:#f92672>&lt;</span><span> end; j</span><span style=color:#f92672>++</span><span>) {
</span><span>                </span><span style=color:#66d9ef;font-style:italic>Double</span><span> v </span><span style=color:#f92672>=</span><span> data.get(j);
</span><span>                </span><span style=color:#f92672>if </span><span>(v </span><span style=color:#f92672>!= </span><span style=color:#ae81ff>null </span><span style=color:#f92672>&& !</span><span>v.isNaN() </span><span style=color:#f92672>&& !</span><span>v.isInfinite()) neigh.add(v);
</span><span>            }
</span><span>            </span><span style=color:#66d9ef;font-style:italic>double</span><span> mu </span><span style=color:#f92672>= </span><span>mean(neigh);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>double</span><span> std </span><span style=color:#f92672>= </span><span>sampleStd(neigh);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>Double</span><span> x </span><span style=color:#f92672>=</span><span> data.get(i);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>boolean</span><span> out </span><span style=color:#f92672>= </span><span>(x </span><span style=color:#f92672>== </span><span style=color:#ae81ff>null </span><span style=color:#f92672>||</span><span> x.isNaN() </span><span style=color:#f92672>||</span><span> x.isInfinite()) </span><span style=color:#f92672>? </span><span style=color:#ae81ff>true </span><span style=color:#f92672>: </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.abs(x </span><span style=color:#f92672>-</span><span> mu) </span><span style=color:#f92672>></span><span> beta </span><span style=color:#f92672>* </span><span>(std </span><span style=color:#f92672>== </span><span style=color:#ae81ff>0.0 </span><span style=color:#f92672>? </span><span style=color:#ae81ff>1.0 </span><span style=color:#f92672>:</span><span> std);
</span><span>            mask.set(i, out);
</span><span>        }
</span><span>        </span><span style=color:#f92672>return</span><span> mask;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#a6e22e>removeByMovingAverage</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>int </span><span style=color:#fd971f;font-style:italic>window</span><span>, </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#fd971f;font-style:italic>beta</span><span>) {
</span><span>        </span><span style=color:#f92672>return </span><span>removeByMask(data, detectByMovingAverage(data, window, beta));
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// ===================== 3) 相邻点距离 =====================
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> </span><span style=color:#a6e22e>detectByNeighborDistance</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#fd971f;font-style:italic>threshold</span><span>, </span><span style=color:#66d9ef;font-style:italic>boolean </span><span style=color:#fd971f;font-style:italic>robust</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>int</span><span> n </span><span style=color:#f92672>=</span><span> data.size();
</span><span>        </span><span style=color:#f92672>if </span><span>(n </span><span style=color:#f92672>== </span><span style=color:#ae81ff>0</span><span>) </span><span style=color:#f92672>return </span><span style=color:#66d9ef;font-style:italic>Collections</span><span>.emptyList();
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> diffs </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>();
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>1</span><span>; i </span><span style=color:#f92672>&lt;</span><span> n; i</span><span style=color:#f92672>++</span><span>) {
</span><span>            </span><span style=color:#66d9ef;font-style:italic>Double</span><span> a </span><span style=color:#f92672>=</span><span> data.get(i </span><span style=color:#f92672>- </span><span style=color:#ae81ff>1</span><span>), b </span><span style=color:#f92672>=</span><span> data.get(i);
</span><span>            </span><span style=color:#f92672>if </span><span>(a </span><span style=color:#f92672>== </span><span style=color:#ae81ff>null </span><span style=color:#f92672>||</span><span> b </span><span style=color:#f92672>== </span><span style=color:#ae81ff>null </span><span style=color:#f92672>||</span><span> a.isNaN() </span><span style=color:#f92672>||</span><span> b.isNaN() </span><span style=color:#f92672>||</span><span> a.isInfinite() </span><span style=color:#f92672>||</span><span> b.isInfinite()) </span><span style=color:#f92672>continue</span><span>;
</span><span>            diffs.add(</span><span style=color:#66d9ef;font-style:italic>Math</span><span>.abs(b </span><span style=color:#f92672>-</span><span> a));
</span><span>        }
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> base;
</span><span>        </span><span style=color:#f92672>if </span><span>(robust) {
</span><span>            </span><span style=color:#66d9ef;font-style:italic>double</span><span> m </span><span style=color:#f92672>= </span><span>median(diffs);
</span><span>            </span><span style=color:#66d9ef;font-style:italic>double</span><span> mdev </span><span style=color:#f92672>= </span><span>mad(diffs);
</span><span>            base </span><span style=color:#f92672>=</span><span> m </span><span style=color:#f92672>+ </span><span style=color:#ae81ff>3.0 </span><span style=color:#f92672>* </span><span>(mdev </span><span style=color:#f92672>== </span><span style=color:#ae81ff>0.0 </span><span style=color:#f92672>? </span><span style=color:#ae81ff>1.0 </span><span style=color:#f92672>:</span><span> mdev);
</span><span>        } </span><span style=color:#f92672>else </span><span>{
</span><span>            base </span><span style=color:#f92672>=</span><span> diffs.isEmpty() </span><span style=color:#f92672>?</span><span> threshold </span><span style=color:#f92672>: </span><span>mean(diffs) </span><span style=color:#f92672>+ </span><span style=color:#ae81ff>3.0 </span><span style=color:#f92672>* </span><span>sampleStd(diffs);
</span><span>        }
</span><span>        </span><span style=color:#66d9ef;font-style:italic>double</span><span> th </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.max(threshold, base); </span><span style=color:#75715e>// 使用用户阈值与数据驱动阈值的较大者
</span><span>
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> mask </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>(</span><span style=color:#66d9ef;font-style:italic>Collections</span><span>.nCopies(n, </span><span style=color:#ae81ff>false</span><span>));
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> n; i</span><span style=color:#f92672>++</span><span>) {
</span><span>            </span><span style=color:#66d9ef;font-style:italic>Double</span><span> x </span><span style=color:#f92672>=</span><span> data.get(i);
</span><span>            </span><span style=color:#f92672>if </span><span>(x </span><span style=color:#f92672>== </span><span style=color:#ae81ff>null </span><span style=color:#f92672>||</span><span> x.isNaN() </span><span style=color:#f92672>||</span><span> x.isInfinite()) { mask.set(i, </span><span style=color:#ae81ff>true</span><span>); </span><span style=color:#f92672>continue</span><span>; }
</span><span>            </span><span style=color:#66d9ef;font-style:italic>double</span><span> left </span><span style=color:#f92672>= </span><span>(i </span><span style=color:#f92672>> </span><span style=color:#ae81ff>0 </span><span style=color:#f92672>&&</span><span> data.get(i </span><span style=color:#f92672>- </span><span style=color:#ae81ff>1</span><span>) </span><span style=color:#f92672>!= </span><span style=color:#ae81ff>null </span><span style=color:#f92672>&& !</span><span>data.get(i </span><span style=color:#f92672>- </span><span style=color:#ae81ff>1</span><span>).isNaN() </span><span style=color:#f92672>&& !</span><span>data.get(i </span><span style=color:#f92672>- </span><span style=color:#ae81ff>1</span><span>).isInfinite()) </span><span style=color:#f92672>? </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.abs(x </span><span style=color:#f92672>-</span><span> data.get(i </span><span style=color:#f92672>- </span><span style=color:#ae81ff>1</span><span>)) </span><span style=color:#f92672>: </span><span style=color:#ae81ff>0.0</span><span>;
</span><span>            </span><span style=color:#66d9ef;font-style:italic>double</span><span> right </span><span style=color:#f92672>= </span><span>(i </span><span style=color:#f92672>&lt;</span><span> n </span><span style=color:#f92672>- </span><span style=color:#ae81ff>1 </span><span style=color:#f92672>&&</span><span> data.get(i </span><span style=color:#f92672>+ </span><span style=color:#ae81ff>1</span><span>) </span><span style=color:#f92672>!= </span><span style=color:#ae81ff>null </span><span style=color:#f92672>&& !</span><span>data.get(i </span><span style=color:#f92672>+ </span><span style=color:#ae81ff>1</span><span>).isNaN() </span><span style=color:#f92672>&& !</span><span>data.get(i </span><span style=color:#f92672>+ </span><span style=color:#ae81ff>1</span><span>).isInfinite()) </span><span style=color:#f92672>? </span><span style=color:#66d9ef;font-style:italic>Math</span><span>.abs(x </span><span style=color:#f92672>-</span><span> data.get(i </span><span style=color:#f92672>+ </span><span style=color:#ae81ff>1</span><span>)) </span><span style=color:#f92672>: </span><span style=color:#ae81ff>0.0</span><span>;
</span><span>            </span><span style=color:#66d9ef;font-style:italic>boolean</span><span> out </span><span style=color:#f92672>=</span><span> left </span><span style=color:#f92672>></span><span> th </span><span style=color:#f92672>&&</span><span> right </span><span style=color:#f92672>></span><span> th; </span><span style=color:#75715e>// 两侧距离都大更像“尖刺”
</span><span>            mask.set(i, out);
</span><span>        }
</span><span>        </span><span style=color:#f92672>return</span><span> mask;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#a6e22e>removeByNeighborDistance</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>double </span><span style=color:#fd971f;font-style:italic>threshold</span><span>, </span><span style=color:#66d9ef;font-style:italic>boolean </span><span style=color:#fd971f;font-style:italic>robust</span><span>) {
</span><span>        </span><span style=color:#f92672>return </span><span>removeByMask(data, detectByNeighborDistance(data, threshold, robust));
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// ===================== 4) 多方法融合（投票） =====================
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>class </span><span style=color:#a6e22e;text-decoration:underline>CombinedParams </span><span>{
</span><span>        </span><span style=color:#f92672>public </span><span style=color:#66d9ef;font-style:italic>double </span><span>zK </span><span style=color:#f92672>= </span><span style=color:#ae81ff>3.0</span><span>;            </span><span style=color:#75715e>// 全局 Z-Score 阈值
</span><span>        </span><span style=color:#f92672>public </span><span style=color:#66d9ef;font-style:italic>double </span><span>iqrAlpha </span><span style=color:#f92672>= </span><span style=color:#ae81ff>1.5</span><span>;      </span><span style=color:#75715e>// IQR 系数
</span><span>        </span><span style=color:#f92672>public </span><span style=color:#66d9ef;font-style:italic>int </span><span>slideWindow </span><span style=color:#f92672>= </span><span style=color:#ae81ff>5</span><span>;        </span><span style=color:#75715e>// 滑动窗口大小（左右各 window）
</span><span>        </span><span style=color:#f92672>public </span><span style=color:#66d9ef;font-style:italic>double </span><span>slideK </span><span style=color:#f92672>= </span><span style=color:#ae81ff>3.0</span><span>;        </span><span style=color:#75715e>// 滑动 Z-Score 阈值
</span><span>        </span><span style=color:#f92672>public </span><span style=color:#66d9ef;font-style:italic>double </span><span>maBeta </span><span style=color:#f92672>= </span><span style=color:#ae81ff>3.0</span><span>;        </span><span style=color:#75715e>// 移动均值偏差倍数
</span><span>        </span><span style=color:#f92672>public </span><span style=color:#66d9ef;font-style:italic>double </span><span>neighborThreshold </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0.0</span><span>; </span><span style=color:#75715e>// 最小固定距离阈值
</span><span>        </span><span style=color:#f92672>public </span><span style=color:#66d9ef;font-style:italic>boolean </span><span>neighborRobust </span><span style=color:#f92672>= </span><span style=color:#ae81ff>true</span><span>;  </span><span style=color:#75715e>// 使用鲁棒阈值
</span><span>        </span><span style=color:#f92672>public </span><span style=color:#66d9ef;font-style:italic>int </span><span>votesRequired </span><span style=color:#f92672>= </span><span style=color:#ae81ff>2</span><span>;      </span><span style=color:#75715e>// 至少多少方法判为异常
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> </span><span style=color:#a6e22e>detectByCombined</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>CombinedParams </span><span style=color:#fd971f;font-style:italic>p</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> m1 </span><span style=color:#f92672>= </span><span>detectByZScore(data, p.zK);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> m2 </span><span style=color:#f92672>= </span><span>detectByIQR(data, p.iqrAlpha);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> m3 </span><span style=color:#f92672>= </span><span>detectBySlidingZScore(data, p.slideWindow, p.slideK);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> m4 </span><span style=color:#f92672>= </span><span>detectByMovingAverage(data, p.slideWindow, p.maBeta);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> m5 </span><span style=color:#f92672>= </span><span>detectByNeighborDistance(data, p.neighborThreshold, p.neighborRobust);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>int</span><span> n </span><span style=color:#f92672>=</span><span> data.size();
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Boolean</span><span>> out </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>ArrayList</span><span>&lt;>(</span><span style=color:#66d9ef;font-style:italic>Collections</span><span>.nCopies(n, </span><span style=color:#ae81ff>false</span><span>));
</span><span>        </span><span style=color:#f92672>for </span><span>(</span><span style=color:#66d9ef;font-style:italic>int</span><span> i </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>; i </span><span style=color:#f92672>&lt;</span><span> n; i</span><span style=color:#f92672>++</span><span>) {
</span><span>            </span><span style=color:#66d9ef;font-style:italic>int</span><span> votes </span><span style=color:#f92672>= </span><span style=color:#ae81ff>0</span><span>;
</span><span>            </span><span style=color:#f92672>if </span><span>(m1.get(i)) votes</span><span style=color:#f92672>++</span><span>;
</span><span>            </span><span style=color:#f92672>if </span><span>(m2.get(i)) votes</span><span style=color:#f92672>++</span><span>;
</span><span>            </span><span style=color:#f92672>if </span><span>(m3.get(i)) votes</span><span style=color:#f92672>++</span><span>;
</span><span>            </span><span style=color:#f92672>if </span><span>(m4.get(i)) votes</span><span style=color:#f92672>++</span><span>;
</span><span>            </span><span style=color:#f92672>if </span><span>(m5.get(i)) votes</span><span style=color:#f92672>++</span><span>;
</span><span>            out.set(i, votes </span><span style=color:#f92672>>=</span><span> p.votesRequired);
</span><span>        }
</span><span>        </span><span style=color:#f92672>return</span><span> out;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#a6e22e>removeByCombined</span><span>(</span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> </span><span style=color:#fd971f;font-style:italic>data</span><span>, </span><span style=color:#66d9ef;font-style:italic>CombinedParams </span><span style=color:#fd971f;font-style:italic>p</span><span>) {
</span><span>        </span><span style=color:#f92672>return </span><span>removeByMask(data, detectByCombined(data, p));
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#75715e>// ===================== 5) 演示用主程序 =====================
</span><span>    </span><span style=color:#f92672>public static </span><span style=color:#66d9ef;font-style:italic>void </span><span style=color:#a6e22e>main</span><span>(</span><span style=color:#66d9ef;font-style:italic>String</span><span style=color:#f92672>[] </span><span style=color:#fd971f;font-style:italic>args</span><span>) {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> raw </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Arrays</span><span>.asList(
</span><span>                </span><span style=color:#ae81ff>10.0</span><span>, </span><span style=color:#ae81ff>10.5</span><span>, </span><span style=color:#ae81ff>10.2</span><span>, </span><span style=color:#ae81ff>9.9</span><span>, </span><span style=color:#ae81ff>10.1</span><span>,
</span><span>                </span><span style=color:#ae81ff>45.0</span><span>, </span><span style=color:#75715e>// 突刺
</span><span>                </span><span style=color:#ae81ff>10.0</span><span>, </span><span style=color:#ae81ff>9.8</span><span>, </span><span style=color:#ae81ff>10.3</span><span>, </span><span style=color:#ae81ff>10.2</span><span>,
</span><span>                </span><span style=color:#f92672>-</span><span style=color:#ae81ff>30.0</span><span>, </span><span style=color:#75715e>// 负向突刺
</span><span>                </span><span style=color:#ae81ff>10.1</span><span>, </span><span style=color:#ae81ff>9.9</span><span>, </span><span style=color:#ae81ff>10.0
</span><span>        );
</span><span>
</span><span>        </span><span style=color:#66d9ef;font-style:italic>System</span><span>.out.println(</span><span style=color:#e6db74>"原始数据:  " </span><span style=color:#f92672>+</span><span> raw);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>System</span><span>.out.println(</span><span style=color:#e6db74>"Z-Score 清洗: " </span><span style=color:#f92672>+ </span><span>removeByZScore(raw, </span><span style=color:#ae81ff>3.0</span><span>));
</span><span>        </span><span style=color:#66d9ef;font-style:italic>System</span><span>.out.println(</span><span style=color:#e6db74>"IQR 清洗:     " </span><span style=color:#f92672>+ </span><span>removeByIQR(raw, </span><span style=color:#ae81ff>1.5</span><span>));
</span><span>        </span><span style=color:#66d9ef;font-style:italic>System</span><span>.out.println(</span><span style=color:#e6db74>"滑动Z 清洗:   " </span><span style=color:#f92672>+ </span><span>removeBySlidingZScore(raw, </span><span style=color:#ae81ff>3</span><span>, </span><span style=color:#ae81ff>3.0</span><span>));
</span><span>        </span><span style=color:#66d9ef;font-style:italic>System</span><span>.out.println(</span><span style=color:#e6db74>"移动均值 清洗: " </span><span style=color:#f92672>+ </span><span>removeByMovingAverage(raw, </span><span style=color:#ae81ff>3</span><span>, </span><span style=color:#ae81ff>3.0</span><span>));
</span><span>        </span><span style=color:#66d9ef;font-style:italic>System</span><span>.out.println(</span><span style=color:#e6db74>"相邻距离 清洗: " </span><span style=color:#f92672>+ </span><span>removeByNeighborDistance(raw, </span><span style=color:#ae81ff>0.0</span><span>, </span><span style=color:#ae81ff>true</span><span>));
</span><span>
</span><span>        </span><span style=color:#66d9ef;font-style:italic>CombinedParams</span><span> p </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>CombinedParams</span><span>();
</span><span>        p.votesRequired </span><span style=color:#f92672>= </span><span style=color:#ae81ff>2</span><span>; </span><span style=color:#75715e>// 至少两种方法判为异常才移除
</span><span>        </span><span style=color:#66d9ef;font-style:italic>System</span><span>.out.println(</span><span style=color:#e6db74>"融合清洗:     " </span><span style=color:#f92672>+ </span><span>removeByCombined(raw, p));
</span><span>    }
</span><span>}
</span></code></pre><h2 id=6-ce-shi-yong-li-junit-5>6. 测试用例（JUnit 5）</h2><pre class=language-java data-lang=java style=color:#f8f8f2;background-color:#272822><code class=language-java data-lang=java><span style=color:#f92672>import </span><span style=color:#66d9ef;font-style:italic>org</span><span>.</span><span style=color:#66d9ef;font-style:italic>junit</span><span>.</span><span style=color:#66d9ef;font-style:italic>jupiter</span><span>.</span><span style=color:#66d9ef;font-style:italic>api</span><span>.</span><span style=color:#66d9ef;font-style:italic>Test</span><span>;
</span><span style=color:#f92672>import static </span><span style=color:#66d9ef;font-style:italic>org</span><span>.</span><span style=color:#66d9ef;font-style:italic>junit</span><span>.</span><span style=color:#66d9ef;font-style:italic>jupiter</span><span>.</span><span style=color:#66d9ef;font-style:italic>api</span><span>.</span><span style=color:#66d9ef;font-style:italic>Assertions</span><span>.</span><span style=color:#f92672>*</span><span>;
</span><span style=color:#f92672>import </span><span style=color:#66d9ef;font-style:italic>java</span><span>.</span><span style=color:#66d9ef;font-style:italic>util</span><span>.</span><span style=color:#f92672>*</span><span>;
</span><span>
</span><span style=color:#f92672>public </span><span style=color:#66d9ef;font-style:italic>class </span><span style=color:#a6e22e;text-decoration:underline>OutlierDetectorsTest </span><span>{
</span><span>
</span><span>    @Test
</span><span>    </span><span style=color:#66d9ef;font-style:italic>void </span><span style=color:#a6e22e>zscore_removes_spikes</span><span>() {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> data </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Arrays</span><span>.asList(</span><span style=color:#ae81ff>10.0</span><span>, </span><span style=color:#ae81ff>10.2</span><span>, </span><span style=color:#ae81ff>10.1</span><span>, </span><span style=color:#ae81ff>50.0</span><span>, </span><span style=color:#ae81ff>9.9</span><span>, </span><span style=color:#ae81ff>10.0</span><span>);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> cleaned </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>OutlierDetectors</span><span>.removeByZScore(data, </span><span style=color:#ae81ff>3.0</span><span>);
</span><span>        assertFalse(cleaned.contains(</span><span style=color:#ae81ff>50.0</span><span>));
</span><span>        assertTrue(cleaned.size() </span><span style=color:#f92672>>= </span><span style=color:#ae81ff>4</span><span>);
</span><span>    }
</span><span>
</span><span>    @Test
</span><span>    </span><span style=color:#66d9ef;font-style:italic>void </span><span style=color:#a6e22e>iqr_handles_skewed</span><span>() {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> data </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Arrays</span><span>.asList(</span><span style=color:#ae81ff>1.0</span><span>, </span><span style=color:#ae81ff>1.1</span><span>, </span><span style=color:#ae81ff>1.2</span><span>, </span><span style=color:#ae81ff>5.0</span><span>, </span><span style=color:#ae81ff>1.0</span><span>, </span><span style=color:#ae81ff>0.9</span><span>);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> cleaned </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>OutlierDetectors</span><span>.removeByIQR(data, </span><span style=color:#ae81ff>1.5</span><span>);
</span><span>        assertFalse(cleaned.contains(</span><span style=color:#ae81ff>5.0</span><span>));
</span><span>    }
</span><span>
</span><span>    @Test
</span><span>    </span><span style=color:#66d9ef;font-style:italic>void </span><span style=color:#a6e22e>sliding_zscore_detects_local_spike</span><span>() {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> data </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Arrays</span><span>.asList(</span><span style=color:#ae81ff>10.0</span><span>, </span><span style=color:#ae81ff>10.1</span><span>, </span><span style=color:#ae81ff>30.0</span><span>, </span><span style=color:#ae81ff>10.2</span><span>, </span><span style=color:#ae81ff>10.1</span><span>);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> cleaned </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>OutlierDetectors</span><span>.removeBySlidingZScore(data, </span><span style=color:#ae81ff>2</span><span>, </span><span style=color:#ae81ff>2.5</span><span>);
</span><span>        assertFalse(cleaned.contains(</span><span style=color:#ae81ff>30.0</span><span>));
</span><span>    }
</span><span>
</span><span>    @Test
</span><span>    </span><span style=color:#66d9ef;font-style:italic>void </span><span style=color:#a6e22e>moving_average_removes_outliers</span><span>() {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> data </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Arrays</span><span>.asList(</span><span style=color:#ae81ff>100.0</span><span>, </span><span style=color:#ae81ff>100.1</span><span>, </span><span style=color:#ae81ff>99.9</span><span>, </span><span style=color:#ae81ff>400.0</span><span>, </span><span style=color:#ae81ff>100.0</span><span>);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> cleaned </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>OutlierDetectors</span><span>.removeByMovingAverage(data, </span><span style=color:#ae81ff>2</span><span>, </span><span style=color:#ae81ff>3.0</span><span>);
</span><span>        assertFalse(cleaned.contains(</span><span style=color:#ae81ff>400.0</span><span>));
</span><span>    }
</span><span>
</span><span>    @Test
</span><span>    </span><span style=color:#66d9ef;font-style:italic>void </span><span style=color:#a6e22e>neighbor_distance_catches_spike_between_flat_values</span><span>() {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> data </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Arrays</span><span>.asList(</span><span style=color:#ae81ff>10.0</span><span>, </span><span style=color:#ae81ff>10.0</span><span>, </span><span style=color:#ae81ff>50.0</span><span>, </span><span style=color:#ae81ff>10.0</span><span>, </span><span style=color:#ae81ff>10.0</span><span>);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> cleaned </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>OutlierDetectors</span><span>.removeByNeighborDistance(data, </span><span style=color:#ae81ff>0.0</span><span>, </span><span style=color:#ae81ff>true</span><span>);
</span><span>        assertFalse(cleaned.contains(</span><span style=color:#ae81ff>50.0</span><span>));
</span><span>    }
</span><span>
</span><span>    @Test
</span><span>    </span><span style=color:#66d9ef;font-style:italic>void </span><span style=color:#a6e22e>combined_voting_is_conservative</span><span>() {
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> data </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>Arrays</span><span>.asList(</span><span style=color:#ae81ff>10.0</span><span>, </span><span style=color:#ae81ff>10.1</span><span>, </span><span style=color:#ae81ff>11.0</span><span>, </span><span style=color:#ae81ff>10.2</span><span>, </span><span style=color:#ae81ff>10.0</span><span>);
</span><span>        </span><span style=color:#66d9ef;font-style:italic>OutlierDetectors</span><span>.</span><span style=color:#66d9ef;font-style:italic>CombinedParams</span><span> p </span><span style=color:#f92672>= new </span><span style=color:#66d9ef;font-style:italic>OutlierDetectors</span><span>.</span><span style=color:#66d9ef;font-style:italic>CombinedParams</span><span>();
</span><span>        p.votesRequired </span><span style=color:#f92672>= </span><span style=color:#ae81ff>2</span><span>;
</span><span>        </span><span style=color:#66d9ef;font-style:italic>List</span><span>&lt;</span><span style=color:#66d9ef;font-style:italic>Double</span><span>> cleaned </span><span style=color:#f92672>= </span><span style=color:#66d9ef;font-style:italic>OutlierDetectors</span><span>.removeByCombined(data, p);
</span><span>        </span><span style=color:#75715e>// 11.0 不一定被去除（取决于窗口与阈值），这里检查不发生误杀（示例）
</span><span>        assertTrue(cleaned.contains(</span><span style=color:#ae81ff>11.0</span><span>));
</span><span>    }
</span><span>}
</span></code></pre><h2 id=7-shi-ji-ying-yong-shi-li>7. 实际应用示例</h2><p>例如 IoT 设备的温度读数，每分钟一个点，偶尔出现硬件抖动导致的尖峰。建议：<ul><li>先用“滑动窗口 Z-Score（window=5，k=3）”检测局部异常。<li>再用“相邻点距离（robust=true）”做二次确认。<li>两者都判异常才移除（<code>votesRequired=2</code>）。</ul><p>这样可以兼顾对局部突变的敏感性与稳健性，降低误杀风险。<h2 id=8-xing-neng-you-hua-jian-yi>8. 性能优化建议</h2><ul><li>预计算滚动均值/方差（O(n)），避免重复遍历。<li>大数据量时优先选用 IQR/MAD 等一次扫描算法。<li>使用并行流或分块处理提升吞吐（注意线程安全）。<li>对近似实时流，优先滑窗方法，避免全量重算。<li>对多次查询的静态数据，缓存中间统计结果。</ul><h2 id=9-zhu-yi-shi-xiang-qiang-lie-tui-jian-shi-jian>9. 注意事项（强烈推荐实践）</h2><ul><li>数据预处理：在检测异常值之前，先过滤掉 NULL 值和 NaN 值。<li>参数选择：根据具体业务场景调整阈值（如 Z-Score 的 k、IQR 的 α、滑窗大小、β 等）。<li>数据分布：考虑数据分布特性，正态更适合 Z-Score，偏态/重尾用 IQR/MAD 更稳健。<li>性能考虑：大数据量时使用近似方法或并行处理；滚动统计更高效。<li>业务逻辑：结合业务知识判断哪些“异常值”实际上是合理的事件，不要轻易删除。</ul><h2 id=10-dai-ma-yun-xing-shuo-ming-ke-xuan>10. 代码运行说明（可选）</h2><ul><li>复制 <code>OutlierDetectors.java</code> 与测试到你的工程。<li>使用 Maven/Gradle 引入 JUnit 5 后运行测试。<li>或直接 <code>javac OutlierDetectors.java</code> 后运行 <code>java OutlierDetectors</code> 查看演示输出。</ul><p>以上方法可根据你的具体需求进行选择和调整，以有效去除 Double 列表中的突刺点。</div></div></section>