<!doctype html><html class=scroll-smooth lang=en><head><meta charset=utf-8><link href=/css/style.css rel=stylesheet><link href=/line-awesome/css/line-awesome.min.css rel=stylesheet><script defer src=/js/main.js></script><title>Java Double List 去除突刺点（异常值）的方法 | 码农的自留地</title><body class="bg-white dark:bg-slate-900 transition ease-in-out"><section><div class="sticky top-0 bg-slate-100 dark:bg-slate-800"><div class="container mx-auto px-auto xl:px-0 w-full xl:w-1/2 flex place-content-between py-16 xl:py-8 font-sans text-6xl xl:text-2xl text-slate-900 dark:text-slate-300"><div class=flex><a class="m-0 p-0 text-slate-900 hover:text-slate-700 dark:text-slate-300 dark:hover:text-slate-200" href=/blog/> /blog </a></div><div class="flex gap-4"><div class="hidden cursor-pointer" id=back-to-top><i class="las la-level-up-alt"></i></div><a href=/><i class="las la-home"></i></a><div class=cursor-pointer id=darkmode-toggle><div class="hidden dark:inline"><i class="las la-sun"></i></div><div class="inline dark:hidden"><i class="las la-moon"></i></div></div></div></div></div><div class="container mx-auto w-full xl:w-1/2 mb-16"><div class="mt-4 font-serif text-slate-600 dark:text-slate-500 text-4xl xl:text-base">2025-11-12</div><h1 class="w-full xl:w-2/3 mt-4 mb-8 font-serif text-8xl xl:text-4xl text-slate-900 dark:text-slate-300">Java Double List 去除突刺点（异常值）的方法</h1><div class="mt-2 mb-6 flex flex-wrap gap-2"></div><div class="w-100 border-t mb-8 border-slate-300 dark:border-slate-700"></div><div class="prose dark:prose-invert prose-pre:rounded-none prose-headings:bg-amber-100 prose-headings:text-slate-800 dark:prose-headings:bg-indigo-900 prose-headings:font-normal dark:prose-headings:text-slate-300 prose-headings:p-2 prose-headings:w-max prose-headings:font-serif prose-2xl xl:prose-base"><p>本文面向需要在 Java 中对 <code>List&lt;Double></code> 数据做“去除突刺点（异常值）”的工程实践，给出 4 类常用方法（统计学、移动窗口、相邻点距离与多方法融合），并提供完整可运行的代码与 JUnit 测试示例，帮助你在不同业务场景下快速选择与落地。<p>注意：异常值并非总是“错误”。许多业务的“尖峰”有可能是合理的事件。本文更像一套工具箱，你需要结合业务知识合理使用与调参。<h2 id=1-ji-yu-tong-ji-xue-fang-fa-de-yi-chang-zhi-jian-ce>1. 基于统计学方法的异常值检测</h2><h3 id=z-score-fang-fa>Z-Score 方法</h3><ul><li>思想：计算全局均值 <code>μ</code> 与标准差 <code>σ</code>，当某点 <code>x</code> 满足 <code>| (x-μ) / σ | > k</code>（常用阈值 <code>k=3</code>）时，判为异常。<li>适用：近似正态分布、峰值显著偏离整体均值的场景。</ul><h3 id=iqr-si-fen-wei-ju-fang-fa>IQR (四分位距) 方法</h3><ul><li>思想：计算 Q1、Q3 与 IQR=<code>Q3-Q1</code>，当点落在 <code>[Q1 - α·IQR, Q3 + α·IQR]</code> 之外（常用 <code>α=1.5</code> 或 <code>3.0</code>）判为异常。<li>适用：偏态分布或存在重尾时较稳健（受极端值影响较小）。</ul><h2 id=2-ji-yu-yi-dong-chuang-kou-de-yi-chang-zhi-jian-ce>2. 基于移动窗口的异常值检测</h2><h3 id=hua-dong-chuang-kou-z-score>滑动窗口 Z-Score</h3><ul><li>思想：用邻域窗口的均值与标准差代替全局统计，适合非平稳或趋势性数据。</ul><h3 id=yi-dong-ping-jun-fa>移动平均法</h3><ul><li>思想：用窗口均值/中位数做局部“期望值”，当当前点偏离窗口均值超过一定阈值即判异常。<li>常见阈值：绝对差超过 <code>β·σ_window</code> 或超过固定常数 <code>δ</code>。</ul><h2 id=3-ji-yu-xiang-lin-dian-ju-chi-de-yi-chang-zhi-jian-ce>3. 基于相邻点距离的异常值检测</h2><ul><li>思想：突刺常表现为与相邻点差值显著增大。可用固定阈值或鲁棒阈值（如差值的 <code>MAD</code> 或四分位距）来判断。</ul><h2 id=4-zong-he-duo-chong-fang-fa-de-yi-chang-zhi-jian-ce>4. 综合多种方法的异常值检测</h2><ul><li>思想：多模型投票或加权融合。只有当多个方法一致判定为异常时才去除，可降低误杀风险。</ul><h2 id=5-wan-zheng-dai-ma-outlierdetectors-java-ke-zhi-jie-fu-zhi-shi-yong>5. 完整代码：OutlierDetectors.java（可直接复制使用）</h2><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=java><span class=giallo-l><span style=color:#81a1c1>import</span><span style=color:#8fbcbb> java</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>util</span><span style=color:#eceff4>.</span><span style=color:#81a1c1>*;</span></span>
<span class=giallo-l><span style=color:#81a1c1>import</span><span style=color:#8fbcbb> java</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>util</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>stream</span><span style=color:#eceff4>.</span><span style=color:#81a1c1>*;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>public final class</span><span style=color:#8fbcbb> OutlierDetectors</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    private</span><span style=color:#88c0d0> OutlierDetectors</span><span style=color:#eceff4>() {}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // ===================== 公共工具与预处理 =====================</span></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span style=color:#88c0d0> dropNullAndNaN</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>data </span><span style=color:#81a1c1>== null</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> return</span><span> Collections</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>emptyList</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> cleaned</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>(</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>())</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>Double</span><span> d</span><span style=color:#81a1c1> :</span><span> data</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>d </span><span style=color:#81a1c1>!= null && !</span><span>d</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> && !</span><span>d</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>()) {</span></span>
<span class=giallo-l><span>                cleaned</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>add</span><span style=color:#eceff4>(</span><span>d</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span> cleaned</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static double</span><span style=color:#88c0d0> mean</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isEmpty</span><span style=color:#eceff4>())</span><span style=color:#81a1c1> return</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> s</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>double</span><span> v</span><span style=color:#81a1c1> :</span><span> data</span><span style=color:#eceff4>)</span><span> s </span><span style=color:#81a1c1>+=</span><span> v</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span> s </span><span style=color:#81a1c1>/</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // 样本标准差（n-1），窗口过小则回退为 0</span></span>
<span class=giallo-l><span style=color:#81a1c1>    public static double</span><span style=color:#88c0d0> sampleStd</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        int</span><span> n</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>n </span><span style=color:#81a1c1>&lt;=</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> return</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> mu</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> mean</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> sumSq</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>double</span><span> v</span><span style=color:#81a1c1> :</span><span> data</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            double</span><span> d</span><span style=color:#81a1c1> =</span><span> v </span><span style=color:#81a1c1>-</span><span> mu</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>            sumSq </span><span style=color:#81a1c1>+=</span><span> d </span><span style=color:#81a1c1>*</span><span> d</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>sqrt</span><span style=color:#eceff4>(</span><span>sumSq </span><span style=color:#81a1c1>/</span><span style=color:#eceff4> (</span><span>n </span><span style=color:#81a1c1>-</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static double</span><span style=color:#88c0d0> median</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isEmpty</span><span style=color:#eceff4>())</span><span style=color:#81a1c1> return</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> sorted</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>(</span><span>data</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        Collections</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>sort</span><span style=color:#eceff4>(</span><span>sorted</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        int</span><span> n</span><span style=color:#81a1c1> =</span><span> sorted</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>n </span><span style=color:#81a1c1>%</span><span style=color:#b48ead> 2</span><span style=color:#81a1c1> ==</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> return</span><span> sorted</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>n </span><span style=color:#81a1c1>/</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span style=color:#eceff4> (</span><span>sorted</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>n </span><span style=color:#81a1c1>/</span><span style=color:#b48ead> 2</span><span style=color:#81a1c1> -</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> +</span><span> sorted</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>n </span><span style=color:#81a1c1>/</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> /</span><span style=color:#b48ead> 2.0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static double</span><span style=color:#eceff4>[]</span><span style=color:#88c0d0> quartiles</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#616e88>        // 简单实现，适用于一般场景；严谨场景可使用更精细的分位数算法</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> sorted</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>(</span><span>data</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        Collections</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>sort</span><span style=color:#eceff4>(</span><span>sorted</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        int</span><span> n</span><span style=color:#81a1c1> =</span><span> sorted</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>n </span><span style=color:#81a1c1>==</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> return new double</span><span style=color:#eceff4>[]{</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>}</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> q2</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> median</span><span style=color:#eceff4>(</span><span>sorted</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> lower</span><span style=color:#81a1c1> =</span><span> sorted</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>subList</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span> n </span><span style=color:#81a1c1>/</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> upper</span><span style=color:#81a1c1> =</span><span> sorted</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>subList</span><span style=color:#eceff4>((</span><span>n </span><span style=color:#81a1c1>%</span><span style=color:#b48ead> 2</span><span style=color:#81a1c1> ==</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1> ?</span><span> n </span><span style=color:#81a1c1>/</span><span style=color:#b48ead> 2</span><span style=color:#81a1c1> :</span><span> n </span><span style=color:#81a1c1>/</span><span style=color:#b48ead> 2</span><span style=color:#81a1c1> +</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>),</span><span> n</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> q1</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> median</span><span style=color:#eceff4>(</span><span>lower</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> q3</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> median</span><span style=color:#eceff4>(</span><span>upper</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return new double</span><span style=color:#eceff4>[]{</span><span>q1</span><span style=color:#eceff4>,</span><span> q2</span><span style=color:#eceff4>,</span><span> q3</span><span style=color:#eceff4>}</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static double</span><span style=color:#88c0d0> mad</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> med</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> median</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> dev</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>stream</span><span style=color:#eceff4>().</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span>v </span><span style=color:#8fbcbb>-></span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>abs</span><span style=color:#eceff4>(</span><span>v </span><span style=color:#81a1c1>-</span><span> med</span><span style=color:#eceff4>)).</span><span style=color:#88c0d0>collect</span><span style=color:#eceff4>(</span><span>Collectors</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>toList</span><span style=color:#eceff4>())</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span style=color:#88c0d0> median</span><span style=color:#eceff4>(</span><span>dev</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // 根据掩码移除异常值</span></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span style=color:#88c0d0> removeByMask</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> isOutlier</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> out</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>(</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>())</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>!</span><span>isOutlier</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>))</span><span> out</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>add</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span> out</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // ===================== 1) 统计学：Z-Score =====================</span></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span style=color:#88c0d0> detectByZScore</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> double</span><span> k</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> cleaned</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> dropNullAndNaN</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> mu</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> mean</span><span style=color:#eceff4>(</span><span>cleaned</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> std</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> sampleStd</span><span style=color:#eceff4>(</span><span>cleaned</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>std </span><span style=color:#81a1c1>==</span><span style=color:#b48ead> 0.0</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#616e88>            // 如果方差为 0，则所有值都相同；默认无异常</span></span>
<span class=giallo-l><span style=color:#81a1c1>            return</span><span> Collections</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>nCopies</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>(),</span><span style=color:#81a1c1> false</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> mask</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>(</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>())</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>Double</span><span> x</span><span style=color:#81a1c1> :</span><span> data</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            boolean</span><span> out</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span>x </span><span style=color:#81a1c1>== null ||</span><span> x</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ||</span><span> x</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>())</span><span style=color:#81a1c1> ? true :</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>abs</span><span style=color:#eceff4>((</span><span>x </span><span style=color:#81a1c1>-</span><span> mu</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> /</span><span> std</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> ></span><span> k</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>            mask</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>add</span><span style=color:#eceff4>(</span><span>out</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span> mask</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span style=color:#88c0d0> removeByZScore</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> double</span><span> k</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span style=color:#88c0d0> removeByMask</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> detectByZScore</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> k</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // ===================== 1) 统计学：IQR =====================</span></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span style=color:#88c0d0> detectByIQR</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> double</span><span> alpha</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> cleaned</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> dropNullAndNaN</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>cleaned</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isEmpty</span><span style=color:#eceff4>())</span><span style=color:#81a1c1> return</span><span> Collections</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>nCopies</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>(),</span><span style=color:#81a1c1> false</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span style=color:#eceff4>[]</span><span> qs</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> quartiles</span><span style=color:#eceff4>(</span><span>cleaned</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> q1</span><span style=color:#81a1c1> =</span><span> qs</span><span style=color:#eceff4>[</span><span style=color:#b48ead>0</span><span style=color:#eceff4>],</span><span> q3 </span><span style=color:#81a1c1>=</span><span> qs</span><span style=color:#eceff4>[</span><span style=color:#b48ead>2</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> iqr</span><span style=color:#81a1c1> =</span><span> q3 </span><span style=color:#81a1c1>-</span><span> q1</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> lo</span><span style=color:#81a1c1> =</span><span> q1 </span><span style=color:#81a1c1>-</span><span> alpha </span><span style=color:#81a1c1>*</span><span> iqr</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> hi</span><span style=color:#81a1c1> =</span><span> q3 </span><span style=color:#81a1c1>+</span><span> alpha </span><span style=color:#81a1c1>*</span><span> iqr</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> mask</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>(</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>())</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>Double</span><span> x</span><span style=color:#81a1c1> :</span><span> data</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            boolean</span><span> out</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span>x </span><span style=color:#81a1c1>== null ||</span><span> x</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ||</span><span> x</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>())</span><span style=color:#81a1c1> ? true :</span><span style=color:#eceff4> (</span><span>x </span><span style=color:#81a1c1>&lt;</span><span> lo </span><span style=color:#81a1c1>||</span><span> x </span><span style=color:#81a1c1>></span><span> hi</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>            mask</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>add</span><span style=color:#eceff4>(</span><span>out</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span> mask</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span style=color:#88c0d0> removeByIQR</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> double</span><span> alpha</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span style=color:#88c0d0> removeByMask</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> detectByIQR</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> alpha</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // ===================== 2) 滑动窗口 Z-Score =====================</span></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span style=color:#88c0d0> detectBySlidingZScore</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> int</span><span> window</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> double</span><span> k</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        int</span><span> n</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> mask</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>(</span><span>Collections</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>nCopies</span><span style=color:#eceff4>(</span><span>n</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> false</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> n</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            int</span><span> start</span><span style=color:#81a1c1> =</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>max</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span> i </span><span style=color:#81a1c1>-</span><span> window</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            int</span><span> end</span><span style=color:#81a1c1> =</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>min</span><span style=color:#eceff4>(</span><span>n</span><span style=color:#eceff4>,</span><span> i </span><span style=color:#81a1c1>+</span><span> window </span><span style=color:#81a1c1>+</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> neigh</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> j</span><span style=color:#81a1c1> =</span><span> start</span><span style=color:#81a1c1>;</span><span> j </span><span style=color:#81a1c1>&lt;</span><span> end</span><span style=color:#81a1c1>;</span><span> j</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Double</span><span> v</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>j</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>                if</span><span style=color:#eceff4> (</span><span>v </span><span style=color:#81a1c1>!= null && !</span><span>v</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> && !</span><span>v</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>())</span><span> neigh</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>add</span><span style=color:#eceff4>(</span><span>v</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#81a1c1>            double</span><span> mu</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> mean</span><span style=color:#eceff4>(</span><span>neigh</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            double</span><span> std</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> sampleStd</span><span style=color:#eceff4>(</span><span>neigh</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Double</span><span> x</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            boolean</span><span> out</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span>x </span><span style=color:#81a1c1>== null ||</span><span> x</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ||</span><span> x</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>())</span><span style=color:#81a1c1> ? true :</span><span style=color:#eceff4> (</span><span>std </span><span style=color:#81a1c1>==</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1> ? false :</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>abs</span><span style=color:#eceff4>((</span><span>x </span><span style=color:#81a1c1>-</span><span> mu</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> /</span><span> std</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> ></span><span> k</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>            mask</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>set</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>,</span><span> out</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span> mask</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span style=color:#88c0d0> removeBySlidingZScore</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> int</span><span> window</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> double</span><span> k</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span style=color:#88c0d0> removeByMask</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> detectBySlidingZScore</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> window</span><span style=color:#eceff4>,</span><span> k</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // ===================== 2) 移动平均法 =====================</span></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span style=color:#88c0d0> detectByMovingAverage</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> int</span><span> window</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> double</span><span> beta</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        int</span><span> n</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> mask</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>(</span><span>Collections</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>nCopies</span><span style=color:#eceff4>(</span><span>n</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> false</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> n</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            int</span><span> start</span><span style=color:#81a1c1> =</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>max</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span> i </span><span style=color:#81a1c1>-</span><span> window</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            int</span><span> end</span><span style=color:#81a1c1> =</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>min</span><span style=color:#eceff4>(</span><span>n</span><span style=color:#eceff4>,</span><span> i </span><span style=color:#81a1c1>+</span><span> window </span><span style=color:#81a1c1>+</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> neigh</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> j</span><span style=color:#81a1c1> =</span><span> start</span><span style=color:#81a1c1>;</span><span> j </span><span style=color:#81a1c1>&lt;</span><span> end</span><span style=color:#81a1c1>;</span><span> j</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Double</span><span> v</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>j</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>                if</span><span style=color:#eceff4> (</span><span>v </span><span style=color:#81a1c1>!= null && !</span><span>v</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> && !</span><span>v</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>())</span><span> neigh</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>add</span><span style=color:#eceff4>(</span><span>v</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#81a1c1>            double</span><span> mu</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> mean</span><span style=color:#eceff4>(</span><span>neigh</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            double</span><span> std</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> sampleStd</span><span style=color:#eceff4>(</span><span>neigh</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Double</span><span> x</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            boolean</span><span> out</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span>x </span><span style=color:#81a1c1>== null ||</span><span> x</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ||</span><span> x</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>())</span><span style=color:#81a1c1> ? true :</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>abs</span><span style=color:#eceff4>(</span><span>x </span><span style=color:#81a1c1>-</span><span> mu</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> ></span><span> beta </span><span style=color:#81a1c1>*</span><span style=color:#eceff4> (</span><span>std </span><span style=color:#81a1c1>==</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1> ?</span><span style=color:#b48ead> 1.0</span><span style=color:#81a1c1> :</span><span> std</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>            mask</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>set</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>,</span><span> out</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span> mask</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span style=color:#88c0d0> removeByMovingAverage</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> int</span><span> window</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> double</span><span> beta</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span style=color:#88c0d0> removeByMask</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> detectByMovingAverage</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> window</span><span style=color:#eceff4>,</span><span> beta</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // ===================== 3) 相邻点距离 =====================</span></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span style=color:#88c0d0> detectByNeighborDistance</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> double</span><span> threshold</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> boolean</span><span> robust</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        int</span><span> n</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>n </span><span style=color:#81a1c1>==</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> return</span><span> Collections</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>emptyList</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> diffs</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 1</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> n</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Double</span><span> a</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i </span><span style=color:#81a1c1>-</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>),</span><span> b </span><span style=color:#81a1c1>=</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>a </span><span style=color:#81a1c1>== null ||</span><span> b </span><span style=color:#81a1c1>== null ||</span><span> a</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ||</span><span> b</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ||</span><span> a</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ||</span><span> b</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>())</span><span style=color:#81a1c1> continue;</span></span>
<span class=giallo-l><span>            diffs</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>add</span><span style=color:#eceff4>(</span><span>Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>abs</span><span style=color:#eceff4>(</span><span>b </span><span style=color:#81a1c1>-</span><span> a</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> base</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span style=color:#eceff4> (</span><span>robust</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            double</span><span> m</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> median</span><span style=color:#eceff4>(</span><span>diffs</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            double</span><span> mdev</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> mad</span><span style=color:#eceff4>(</span><span>diffs</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>            base </span><span style=color:#81a1c1>=</span><span> m </span><span style=color:#81a1c1>+</span><span style=color:#b48ead> 3.0</span><span style=color:#81a1c1> *</span><span style=color:#eceff4> (</span><span>mdev </span><span style=color:#81a1c1>==</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1> ?</span><span style=color:#b48ead> 1.0</span><span style=color:#81a1c1> :</span><span> mdev</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            base </span><span style=color:#81a1c1>=</span><span> diffs</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isEmpty</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ?</span><span> threshold </span><span style=color:#81a1c1>:</span><span style=color:#88c0d0> mean</span><span style=color:#eceff4>(</span><span>diffs</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> +</span><span style=color:#b48ead> 3.0</span><span style=color:#81a1c1> *</span><span style=color:#88c0d0> sampleStd</span><span style=color:#eceff4>(</span><span>diffs</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        double</span><span> th</span><span style=color:#81a1c1> =</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>max</span><span style=color:#eceff4>(</span><span>threshold</span><span style=color:#eceff4>,</span><span> base</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span><span style=color:#616e88> // 使用用户阈值与数据驱动阈值的较大者</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> mask</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>(</span><span>Collections</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>nCopies</span><span style=color:#eceff4>(</span><span>n</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> false</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> n</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Double</span><span> x</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>x </span><span style=color:#81a1c1>== null ||</span><span> x</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ||</span><span> x</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>()) {</span><span> mask</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>set</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> true</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>; continue;</span><span style=color:#eceff4> }</span></span>
<span class=giallo-l><span style=color:#81a1c1>            double</span><span> left</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span>i </span><span style=color:#81a1c1>></span><span style=color:#b48ead> 0</span><span style=color:#81a1c1> &&</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i </span><span style=color:#81a1c1>-</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> != null && !</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i </span><span style=color:#81a1c1>-</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>).</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> && !</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i </span><span style=color:#81a1c1>-</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>).</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>())</span><span style=color:#81a1c1> ?</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>abs</span><span style=color:#eceff4>(</span><span>x </span><span style=color:#81a1c1>-</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i </span><span style=color:#81a1c1>-</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> :</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            double</span><span> right</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span>i </span><span style=color:#81a1c1>&lt;</span><span> n </span><span style=color:#81a1c1>-</span><span style=color:#b48ead> 1</span><span style=color:#81a1c1> &&</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i </span><span style=color:#81a1c1>+</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> != null && !</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i </span><span style=color:#81a1c1>+</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>).</span><span style=color:#88c0d0>isNaN</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> && !</span><span>data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i </span><span style=color:#81a1c1>+</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>).</span><span style=color:#88c0d0>isInfinite</span><span style=color:#eceff4>())</span><span style=color:#81a1c1> ?</span><span> Math</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>abs</span><span style=color:#eceff4>(</span><span>x </span><span style=color:#81a1c1>-</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i </span><span style=color:#81a1c1>+</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> :</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            boolean</span><span> out</span><span style=color:#81a1c1> =</span><span> left </span><span style=color:#81a1c1>></span><span> th </span><span style=color:#81a1c1>&&</span><span> right </span><span style=color:#81a1c1>></span><span> th</span><span style=color:#81a1c1>;</span><span style=color:#616e88> // 两侧距离都大更像“尖刺”</span></span>
<span class=giallo-l><span>            mask</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>set</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>,</span><span> out</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span> mask</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span style=color:#88c0d0> removeByNeighborDistance</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> double</span><span> threshold</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> boolean</span><span> robust</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span style=color:#88c0d0> removeByMask</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> detectByNeighborDistance</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> threshold</span><span style=color:#eceff4>,</span><span> robust</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // ===================== 4) 多方法融合（投票） =====================</span></span>
<span class=giallo-l><span style=color:#81a1c1>    public static class</span><span style=color:#8fbcbb> CombinedParams</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        public double</span><span> zK</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 3.0</span><span style=color:#81a1c1>;</span><span style=color:#616e88>            // 全局 Z-Score 阈值</span></span>
<span class=giallo-l><span style=color:#81a1c1>        public double</span><span> iqrAlpha</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 1.5</span><span style=color:#81a1c1>;</span><span style=color:#616e88>      // IQR 系数</span></span>
<span class=giallo-l><span style=color:#81a1c1>        public int</span><span> slideWindow</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 5</span><span style=color:#81a1c1>;</span><span style=color:#616e88>        // 滑动窗口大小（左右各 window）</span></span>
<span class=giallo-l><span style=color:#81a1c1>        public double</span><span> slideK</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 3.0</span><span style=color:#81a1c1>;</span><span style=color:#616e88>        // 滑动 Z-Score 阈值</span></span>
<span class=giallo-l><span style=color:#81a1c1>        public double</span><span> maBeta</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 3.0</span><span style=color:#81a1c1>;</span><span style=color:#616e88>        // 移动均值偏差倍数</span></span>
<span class=giallo-l><span style=color:#81a1c1>        public double</span><span> neighborThreshold</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0.0</span><span style=color:#81a1c1>;</span><span style=color:#616e88> // 最小固定距离阈值</span></span>
<span class=giallo-l><span style=color:#81a1c1>        public boolean</span><span> neighborRobust</span><span style=color:#81a1c1> = true;</span><span style=color:#616e88>  // 使用鲁棒阈值</span></span>
<span class=giallo-l><span style=color:#81a1c1>        public int</span><span> votesRequired</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 2</span><span style=color:#81a1c1>;</span><span style=color:#616e88>      // 至少多少方法判为异常</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span style=color:#88c0d0> detectByCombined</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> CombinedParams</span><span> p</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> m1</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> detectByZScore</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>.</span><span>zK</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> m2</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> detectByIQR</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>.</span><span>iqrAlpha</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> m3</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> detectBySlidingZScore</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>.</span><span>slideWindow</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>.</span><span>slideK</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> m4</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> detectByMovingAverage</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>.</span><span>slideWindow</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>.</span><span>maBeta</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> m5</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> detectByNeighborDistance</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>.</span><span>neighborThreshold</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>.</span><span>neighborRobust</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        int</span><span> n</span><span style=color:#81a1c1> =</span><span> data</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>></span><span> out</span><span style=color:#81a1c1> = new</span><span style=color:#8fbcbb> ArrayList</span><span style=color:#eceff4>&lt;>(</span><span>Collections</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>nCopies</span><span style=color:#eceff4>(</span><span>n</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> false</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>int</span><span> i</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span><span> i </span><span style=color:#81a1c1>&lt;</span><span> n</span><span style=color:#81a1c1>;</span><span> i</span><span style=color:#81a1c1>++</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            int</span><span> votes</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>m1</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>))</span><span> votes</span><span style=color:#81a1c1>++;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>m2</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>))</span><span> votes</span><span style=color:#81a1c1>++;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>m3</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>))</span><span> votes</span><span style=color:#81a1c1>++;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>m4</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>))</span><span> votes</span><span style=color:#81a1c1>++;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>m5</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>))</span><span> votes</span><span style=color:#81a1c1>++;</span></span>
<span class=giallo-l><span>            out</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>set</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>,</span><span> votes </span><span style=color:#81a1c1>>=</span><span> p</span><span style=color:#eceff4>.</span><span>votesRequired</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span> out</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    public static</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span style=color:#88c0d0> removeByCombined</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> CombinedParams</span><span> p</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        return</span><span style=color:#88c0d0> removeByMask</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> detectByCombined</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // ===================== 5) 演示用主程序 =====================</span></span>
<span class=giallo-l><span style=color:#81a1c1>    public static void</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>[]</span><span> args</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> raw</span><span style=color:#81a1c1> =</span><span> Arrays</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>asList</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#b48ead>                10.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.5</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.2</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 9.9</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.1</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#b48ead>                45.0</span><span style=color:#eceff4>,</span><span style=color:#616e88> // 突刺</span></span>
<span class=giallo-l><span style=color:#b48ead>                10.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 9.8</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.3</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.2</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>                -</span><span style=color:#b48ead>30.0</span><span style=color:#eceff4>,</span><span style=color:#616e88> // 负向突刺</span></span>
<span class=giallo-l><span style=color:#b48ead>                10.1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 9.9</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.0</span></span>
<span class=giallo-l><span style=color:#eceff4>        )</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>        System</span><span style=color:#eceff4>.</span><span>out</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>println</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>原始数据:  </span><span style=color:#eceff4>"</span><span style=color:#81a1c1> +</span><span> raw</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        System</span><span style=color:#eceff4>.</span><span>out</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>println</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>Z-Score 清洗: </span><span style=color:#eceff4>"</span><span style=color:#81a1c1> +</span><span style=color:#88c0d0> removeByZScore</span><span style=color:#eceff4>(</span><span>raw</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 3.0</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        System</span><span style=color:#eceff4>.</span><span>out</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>println</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>IQR 清洗:     </span><span style=color:#eceff4>"</span><span style=color:#81a1c1> +</span><span style=color:#88c0d0> removeByIQR</span><span style=color:#eceff4>(</span><span>raw</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1.5</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        System</span><span style=color:#eceff4>.</span><span>out</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>println</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>滑动Z 清洗:   </span><span style=color:#eceff4>"</span><span style=color:#81a1c1> +</span><span style=color:#88c0d0> removeBySlidingZScore</span><span style=color:#eceff4>(</span><span>raw</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 3</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 3.0</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        System</span><span style=color:#eceff4>.</span><span>out</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>println</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>移动均值 清洗: </span><span style=color:#eceff4>"</span><span style=color:#81a1c1> +</span><span style=color:#88c0d0> removeByMovingAverage</span><span style=color:#eceff4>(</span><span>raw</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 3</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 3.0</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        System</span><span style=color:#eceff4>.</span><span>out</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>println</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>相邻距离 清洗: </span><span style=color:#eceff4>"</span><span style=color:#81a1c1> +</span><span style=color:#88c0d0> removeByNeighborDistance</span><span style=color:#eceff4>(</span><span>raw</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 0.0</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> true</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>        CombinedParams</span><span> p</span><span style=color:#81a1c1> = new</span><span style=color:#88c0d0> CombinedParams</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        p</span><span style=color:#eceff4>.</span><span>votesRequired</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 2</span><span style=color:#81a1c1>;</span><span style=color:#616e88> // 至少两种方法判为异常才移除</span></span>
<span class=giallo-l><span>        System</span><span style=color:#eceff4>.</span><span>out</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>println</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>融合清洗:     </span><span style=color:#eceff4>"</span><span style=color:#81a1c1> +</span><span style=color:#88c0d0> removeByCombined</span><span style=color:#eceff4>(</span><span>raw</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><h2 id=6-ce-shi-yong-li-junit-5>6. 测试用例（JUnit 5）</h2><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=java><span class=giallo-l><span style=color:#81a1c1>import</span><span style=color:#8fbcbb> org</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>junit</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>jupiter</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>api</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>Test</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>import static</span><span style=color:#8fbcbb> org</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>junit</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>jupiter</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>api</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>Assertions</span><span style=color:#eceff4>.</span><span style=color:#81a1c1>*;</span></span>
<span class=giallo-l><span style=color:#81a1c1>import</span><span style=color:#8fbcbb> java</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>util</span><span style=color:#eceff4>.</span><span style=color:#81a1c1>*;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>public class</span><span style=color:#8fbcbb> OutlierDetectorsTest</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>    @</span><span style=color:#d08770>Test</span></span>
<span class=giallo-l><span style=color:#81a1c1>    void</span><span style=color:#88c0d0> zscore_removes_spikes</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#81a1c1> =</span><span> Arrays</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>asList</span><span style=color:#eceff4>(</span><span style=color:#b48ead>10.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.2</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 50.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 9.9</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.0</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> cleaned</span><span style=color:#81a1c1> =</span><span> OutlierDetectors</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>removeByZScore</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 3.0</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>        assertFalse</span><span style=color:#eceff4>(</span><span>cleaned</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>contains</span><span style=color:#eceff4>(</span><span style=color:#b48ead>50.0</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>        assertTrue</span><span style=color:#eceff4>(</span><span>cleaned</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> >=</span><span style=color:#b48ead> 4</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>    @</span><span style=color:#d08770>Test</span></span>
<span class=giallo-l><span style=color:#81a1c1>    void</span><span style=color:#88c0d0> iqr_handles_skewed</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#81a1c1> =</span><span> Arrays</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>asList</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1.1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1.2</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 5.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 0.9</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> cleaned</span><span style=color:#81a1c1> =</span><span> OutlierDetectors</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>removeByIQR</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1.5</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>        assertFalse</span><span style=color:#eceff4>(</span><span>cleaned</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>contains</span><span style=color:#eceff4>(</span><span style=color:#b48ead>5.0</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>    @</span><span style=color:#d08770>Test</span></span>
<span class=giallo-l><span style=color:#81a1c1>    void</span><span style=color:#88c0d0> sliding_zscore_detects_local_spike</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#81a1c1> =</span><span> Arrays</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>asList</span><span style=color:#eceff4>(</span><span style=color:#b48ead>10.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 30.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.2</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.1</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> cleaned</span><span style=color:#81a1c1> =</span><span> OutlierDetectors</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>removeBySlidingZScore</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 2.5</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>        assertFalse</span><span style=color:#eceff4>(</span><span>cleaned</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>contains</span><span style=color:#eceff4>(</span><span style=color:#b48ead>30.0</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>    @</span><span style=color:#d08770>Test</span></span>
<span class=giallo-l><span style=color:#81a1c1>    void</span><span style=color:#88c0d0> moving_average_removes_outliers</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#81a1c1> =</span><span> Arrays</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>asList</span><span style=color:#eceff4>(</span><span style=color:#b48ead>100.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 100.1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 99.9</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 400.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 100.0</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> cleaned</span><span style=color:#81a1c1> =</span><span> OutlierDetectors</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>removeByMovingAverage</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 3.0</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>        assertFalse</span><span style=color:#eceff4>(</span><span>cleaned</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>contains</span><span style=color:#eceff4>(</span><span style=color:#b48ead>400.0</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>    @</span><span style=color:#d08770>Test</span></span>
<span class=giallo-l><span style=color:#81a1c1>    void</span><span style=color:#88c0d0> neighbor_distance_catches_spike_between_flat_values</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#81a1c1> =</span><span> Arrays</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>asList</span><span style=color:#eceff4>(</span><span style=color:#b48ead>10.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 50.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.0</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> cleaned</span><span style=color:#81a1c1> =</span><span> OutlierDetectors</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>removeByNeighborDistance</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 0.0</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> true</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>        assertFalse</span><span style=color:#eceff4>(</span><span>cleaned</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>contains</span><span style=color:#eceff4>(</span><span style=color:#b48ead>50.0</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>    @</span><span style=color:#d08770>Test</span></span>
<span class=giallo-l><span style=color:#81a1c1>    void</span><span style=color:#88c0d0> combined_voting_is_conservative</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> data</span><span style=color:#81a1c1> =</span><span> Arrays</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>asList</span><span style=color:#eceff4>(</span><span style=color:#b48ead>10.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 11.0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.2</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10.0</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        OutlierDetectors</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>CombinedParams</span><span> p</span><span style=color:#81a1c1> = new</span><span> OutlierDetectors</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>CombinedParams</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span>        p</span><span style=color:#eceff4>.</span><span>votesRequired</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 2</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        List</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Double</span><span style=color:#eceff4>></span><span> cleaned</span><span style=color:#81a1c1> =</span><span> OutlierDetectors</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>removeByCombined</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>,</span><span> p</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#616e88>        // 11.0 不一定被去除（取决于窗口与阈值），这里检查不发生误杀（示例）</span></span>
<span class=giallo-l><span style=color:#88c0d0>        assertTrue</span><span style=color:#eceff4>(</span><span>cleaned</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>contains</span><span style=color:#eceff4>(</span><span style=color:#b48ead>11.0</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><h2 id=7-shi-ji-ying-yong-shi-li>7. 实际应用示例</h2><p>例如 IoT 设备的温度读数，每分钟一个点，偶尔出现硬件抖动导致的尖峰。建议：<ul><li>先用“滑动窗口 Z-Score（window=5，k=3）”检测局部异常。<li>再用“相邻点距离（robust=true）”做二次确认。<li>两者都判异常才移除（<code>votesRequired=2</code>）。</ul><p>这样可以兼顾对局部突变的敏感性与稳健性，降低误杀风险。<h2 id=8-xing-neng-you-hua-jian-yi>8. 性能优化建议</h2><ul><li>预计算滚动均值/方差（O(n)），避免重复遍历。<li>大数据量时优先选用 IQR/MAD 等一次扫描算法。<li>使用并行流或分块处理提升吞吐（注意线程安全）。<li>对近似实时流，优先滑窗方法，避免全量重算。<li>对多次查询的静态数据，缓存中间统计结果。</ul><h2 id=9-zhu-yi-shi-xiang-qiang-lie-tui-jian-shi-jian>9. 注意事项（强烈推荐实践）</h2><ul><li>数据预处理：在检测异常值之前，先过滤掉 NULL 值和 NaN 值。<li>参数选择：根据具体业务场景调整阈值（如 Z-Score 的 k、IQR 的 α、滑窗大小、β 等）。<li>数据分布：考虑数据分布特性，正态更适合 Z-Score，偏态/重尾用 IQR/MAD 更稳健。<li>性能考虑：大数据量时使用近似方法或并行处理；滚动统计更高效。<li>业务逻辑：结合业务知识判断哪些“异常值”实际上是合理的事件，不要轻易删除。</ul><h2 id=10-dai-ma-yun-xing-shuo-ming-ke-xuan>10. 代码运行说明（可选）</h2><ul><li>复制 <code>OutlierDetectors.java</code> 与测试到你的工程。<li>使用 Maven/Gradle 引入 JUnit 5 后运行测试。<li>或直接 <code>javac OutlierDetectors.java</code> 后运行 <code>java OutlierDetectors</code> 查看演示输出。</ul><p>以上方法可根据你的具体需求进行选择和调整，以有效去除 Double 列表中的突刺点。</div></div></section>