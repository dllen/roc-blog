## 目标
实现一个高性能、严格校验的 Prompt 抓取器，从网页或本地文档中提取以 34 个分号为边界标记的 Prompt，满足过滤、输出、错误处理与性能要求，并与现有脚本无缝集成。

## 识别与过滤规则
- 边界标记常量：`SEMIS_34 = ';' * 34`
- 边界匹配：整行匹配 `^\s*;{34}\s*$`（允许两侧空白），仅此视为有效“起始/结束”标记
- 抓取范围：在“起始标记”与“结束标记”之间的完整文本
- 过滤：
  - 不含任一有效标记的内容全部跳过
  - 仅保留成对标记间完整文本；出现奇数个标记（未闭合）视为无效并告警
  - 若文档中出现 `;{34}` 行，但不位于块的首/尾（例如仅有单个标记或标记嵌入非整行文本），视为无效并告警

## 提取器设计
- 状态机流式解析（满足 GB 级文件与内存限制）：
  - 状态：`OUTSIDE` 与 `INSIDE`
  - `OUTSIDE` 遇到标记行 → 切换 `INSIDE` 并开始采集
  - `INSIDE` 持续累积行；遇到下一标记行 → 结束块并产出 Prompt；随后继续寻找下一个块
  - 在 `INSIDE` 期间若再次遇到标记行则直接作为结束边界；块内部不允许额外边界行（除结束行）。如检测到块体内出现除结束边界外的标记（例如标记行后又存在非结束用途的同样标记），记告警并丢弃该块
- 精确性保障：
  - 只接受“整行仅 34 分号（可含空白）”作为边界；任何出现在行中部的分号序列均忽略
  - 保留块内文本的原始结构与空白（不修改、不截断）

## 输入源支持
- 文件：
  - 按字节流读取，分块（例如 8–16MB）+ 行缓冲，避免整文件加载
  - 编码自动识别：优先 `UTF-8`（严格），失败则尝试 `GBK`；若均失败，回退 `UTF-8` with replace 并给出告警
- 网页：
  - 下载 HTML（`requests` 或沿用现有 Selenium，按场景选择）
  - 解析正文文本（`BeautifulSoup`/简单正则剔除标签）；随后走同一状态机
  - 对动态页面（如 X/Twitter）保持与现有 `x_prompt_scraper.py` 集成：仅在抓到合法 Prompt 后写入 Markdown

## 性能与资源控制
- 流式分块 + 行级缓冲，解析过程 O(n)；常驻内存仅为当前块与少量缓冲
- 目标：
  - 内存占用 < 500MB（大文件场景）
  - 平均处理速度 ≥ 10MB/s（以纯文本解析为基准；网络 I/O 另计）
- 细节：
  - 预编译正则；减少字符串拷贝（尽量操作视图/缓冲）
  - 可选 `mmap` 路径（按文件系统与内存限制选择），默认流式更稳健

## 输出规范
- 返回 Prompt 列表（原文不改动）或写入文件：每个块去除边界标记行，仅保留中间正文
- 对于 Markdown 集成：直接将块原文放入 `## Prompt` 段落，确保 1:1 保真

## 错误处理与日志
- 多组标记：按出现顺序抓取所有有效块
- 未闭合块（奇数个标记）：记录 WARN（含位置与上下文摘要），该块丢弃
- 无任何匹配：返回空集合并 INFO 说明
- 标记不在边界（例如行中部或混入其他字符）：WARN 并忽略
- 输出统计：总字节、块数量、告警数量、耗时与吞吐

## 测试与验证
- 单元测试用例：
  - 正常：单块、双块、多块
  - 异常：奇数标记、行中部标记、跨块大小写/空白变体、极长块
  - 编码：UTF-8、GBK 与混合场景（错误字符处理）
  - 性能：生成 1GB 合成文件（含若干合法块），验证 <500MB 内存、≥10MB/s
- 集成测试：与 `x_prompt_scraper.py` 联动，仅在检测到合法 Prompt 时保存 Markdown

## 实现计划
- 新增模块：`boring/scripts/prompt_extractor.py`（核心解析与 CLI）
- 可选复用：在 `x_prompt_scraper.py` 中调用提取器，对推文正文进行过滤
- CLI 用法：
  - 文件：`python prompt_extractor.py --input /path/file.txt --encoding auto --out /path/outdir`
  - 网页：`python prompt_extractor.py --url https://example.com --out /path/outdir`
  - 输出：stdout（打印所有块）或写入独立文件（块序号命名）

## 交付物
- 解析库（函数：`extract_prompts_from_text`、`extract_prompts_stream`、`extract_prompts_from_html`）
- 命令行工具与使用说明
- 单元测试与性能基准脚本
- 与现有 X 抓取脚本的集成更新（仅保留合法 Prompt）

请确认是否按上述方案实施；确认后我将开始编码与集成，并提供测试报告与性能数据。